!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ionic/storage"),require("@auth0/angular-jwt"),require("@auth0/angular-jwt/src/jwthelper.service"),require("rxjs"),require("ng-common-library"),require("rxjs/operators"),require("@angular/platform-browser"),require("@angular/forms"),require("@angular/core"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("ng-login-library",["exports","@ionic/storage","@auth0/angular-jwt","@auth0/angular-jwt/src/jwthelper.service","rxjs","ng-common-library","rxjs/operators","@angular/platform-browser","@angular/forms","@angular/core","@angular/common/http"],t):t(e["ng-login-library"]={},e.i2,e.angularJwt,e.i3,e.rxjs,e.i5,e.rxjs.operators,e.ng.platformBrowser,e.ng.forms,e.ng.core,e.ng.common.http)}(this,function(e,t,o,n,s,r,i,l,a,g,c){"use strict";var u=function(){function e(){}return e.prototype.getAppid=function(){return this.appid},e.prototype.setAppid=function(e){this.appid=e},e.prototype.getTitle=function(){return this.title},e.prototype.setTitle=function(e){this.title=e},e.prototype.getLoginUrl=function(){return this.loginUrl},e.prototype.setLoginUrl=function(e){this.loginUrl=e},e.prototype.getLoginApiUrl=function(){return this.loginApiUrl},e.prototype.setLoginApiUrl=function(e){this.loginApiUrl=e},e.prototype.getLoginIpUrl=function(){return this.loginIpUrl},e.prototype.setLoginIpUrl=function(e){this.loginIpUrl=e},e.prototype.getLogoutUrl=function(){return this.logoutUrl},e.prototype.setLogoutUrl=function(e){this.logoutUrl=e},e.prototype.getLogoSrc=function(){return this.logoSrc},e.prototype.setLogoSrc=function(e){this.logoSrc=e},e.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=g.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),p=function(){function e(e,t,o,n,r){var i=this;this.http=e,this.storage=t,this.jwtHelper=o,this.loginConfigService=n,this.tokenService=r,this.currentUser=null,this.login$=new s.Subject,this.hideLogin=!0,this.JWT_USER_NAME="jwt_user",t.get(this.JWT_USER_NAME).then(function(e){i.setCurrentUser(e)})}return e.prototype.getCurrentUser=function(){return this.currentUser},e.prototype.setCurrentUser=function(e){this.currentUser=e},e.prototype.getLogoSrc=function(){return this.loginConfigService.getLogoSrc()},e.prototype.getLoginApiUrl=function(){return this.loginConfigService.getLoginApiUrl()},e.prototype.getLoginIpUrl=function(){return this.loginConfigService.getLoginIpUrl()},e.prototype.getLoginUrl=function(){return this.loginConfigService.getLoginUrl()},e.prototype.getLogoutUrl=function(){return this.loginConfigService.getLogoutUrl()},e.prototype.getTitle=function(){return this.loginConfigService.getTitle()},e.prototype.checkLogin=function(){var n=this;this.tokenService.token$.pipe(i.first()).subscribe(function(e){if(e){var t=n.jwtHelper.decodeToken(e);if(t){var o=new r.User;o.username=t.sub,o.firstname=t.firstname,o.lastname=t.lastname,o.roles=t.roles,o.appid=t.appid,n.storage.set(n.JWT_USER_NAME,o).then(function(){console.log("New user ["+n.getCurrentUser().username+"] added to storage.")}),n.setCurrentUser(o),n.login$.next(o)}else console.log("Invalid token received from server!"),n.clearLocalUser(),n.login$.next(null)}else n.login$.next(null),n.clearLocalUser()}),this.tokenService.checkToken()},e.prototype.logIn=function(e){e.appid=this.loginConfigService.getAppid(),this.subAndCheckToken(e,!0),this.tokenService.getToken(e)},e.prototype.subAndCheckToken=function(o,n){var r=this;this.tokenService.token$.pipe(i.first()).subscribe(function(e){if(e){var t=r.jwtHelper.decodeToken(e);t?t.sub!==o.username?(console.log("Invalid username in token received from server!"),r.setCurrentUser(null),n&&r.login$.next(null)):(o.firstname=t.firstname,o.lastname=t.lastname,o.roles=t.roles,r.storage.set(r.JWT_USER_NAME,o).then(function(){console.log("New user ["+r.getCurrentUser().username+"] added to storage.")}),r.setCurrentUser(o),r.login$.next(o)):(console.log("Invalid token received from server!"),r.setCurrentUser(null),n&&r.login$.next(null))}else console.log("Invalid token, not logged in."),r.clearLocalUser(),n&&r.login$.next(null)})},e.prototype.logOut=function(){this.getCurrentUser()&&this.getCurrentUser().username&&this.http.post(this.loginConfigService.getLogoutUrl(),this.getCurrentUser()).pipe(i.first()).subscribe(function(){console.log("Logged out")}),this.clearLocalUser()},e.prototype.clearLocalUser=function(){var e=null;this.getCurrentUser()&&this.getCurrentUser().username&&(e=this.getCurrentUser().username),this.setCurrentUser(null),this.hideLogin=!1,this.tokenService.clearToken(),this.storage.remove(this.JWT_USER_NAME).then(function(){e?console.log("User ["+e+"] removed from storage"):console.log("User removed from storage")})},e.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:c.HttpClient},{type:t.Storage},{type:o.JwtHelperService},{type:u},{type:r.TokenApiService}]},e.ngInjectableDef=g.defineInjectable({factory:function(){return new e(g.inject(c.HttpClient),g.inject(t.Storage),g.inject(n.JwtHelperService),g.inject(u),g.inject(r.TokenApiService))},token:e,providedIn:"root"}),e}(),f=function(){function e(e,t){this.http=e,this.loginService=t,this.loginIp$=new s.Subject,this.loginInfo=null}return e.prototype.getLoginIp=function(){var t=this;this.http.get(this.loginService.getLoginIpUrl()).subscribe(function(e){console.log("Got login ip: "+e),t.loginInfo=e,t.loginIp$.next(e)},function(e){console.log("Could not get login ip: "+e),t.loginInfo=null,t.loginIp$.next(null)})},e.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:c.HttpClient},{type:p}]},e.ngInjectableDef=g.defineInjectable({factory:function(){return new e(g.inject(c.HttpClient),g.inject(p))},token:e,providedIn:"root"}),e}(),d=function b(){this.uniqueDeviceIdentifier="--",this.copyRightInfo="Â© 2018 - PeraHealth, Inc.",this.versionInfo="--",this.patentInfo="| <strong>US Patent Nos.</strong> 8,092,380; 8,100,829; 8,355,925; 8,403,847 and 8,454,506; | <strong>Canadian Patent No.</strong> 2,599,387 and other Canadian and foreign patents pending."},h=function(){function e(e,t){this.loginService=e,this.loginLibraryIpService=t,this.NO_DICE="Error:  Username or password is incorrect",this.loginInfo=new d}return e.prototype.getUser=function(){return this.loginService.getCurrentUser()||this.loginService.setCurrentUser(new r.User),this.loginService.getCurrentUser()},e.prototype.ngOnInit=function(){var t=this;this.logoSrc=this.loginService.getLogoSrc(),this.loginLibraryIpService.loginIp$.pipe(i.first()).subscribe(function(e){e?t.loginInfo=e:console.log("Could not get Login Information from server, using defaults.")}),this.loginLibraryIpService.getLoginIp(),localStorage.removeItem("currentUser"),this.loginService.setCurrentUser(new r.User),this.errorMessage=null},e.prototype.login=function(){var t=this,o=this.getUser();o.username&&this.userPassword?(o.password=btoa(this.userPassword),this.loginService.login$.pipe(i.first()).subscribe(function(e){e?(o.password=null,t.errorMessage=null,t.userPassword=null):(o.password=null,t.userPassword=null,t.errorMessage=t.NO_DICE,t.loginErrored())}),this.loginService.logIn(o)):(this.errorMessage=this.NO_DICE,this.loginErrored())},e.prototype.loginErrored=function(){this.setFocusToUsernameField()},e.prototype.ngAfterViewInit=function(){this.setFocusToUsernameField()},e.prototype.setFocusToUsernameField=function(){this.vc&&this.vc.first&&this.vc.first.nativeElement&&this.vc.first.nativeElement.focus()},e.decorators=[{type:g.Component,args:[{selector:"phlib-login",template:'\x3c!-- Hide the component if the user is already logged in. --\x3e\n<div class="container" [hidden]="loginService.hideLogin">\n  <div class="card card-container">\n    <img id="profile-img" class="profile-img-card" src={{logoSrc}} />\n    <p id="login-subtitle" class="login-subtitle">\n        Log Into Your <strong>{{title}}</strong> Account\n    </p>\n\n    <form name="form-signin" (ngSubmit)="f.form.valid && login()" #f="ngForm" novalidate>\n      <div class="alert alert-danger" role="alert" *ngIf="errorMessage">{{errorMessage}}</div>\n      <span id="reauth-email" class="reauth-email"></span>\n      <div class="form-group" [ngClass]="{ \'has-error\': f.submitted && !username.valid }">\n        <label for="username">User Name</label>\n        <input #input autofocus type="text" class="form-control" id="username" name="username" [(ngModel)]="getUser().username" #username="ngModel" required />\n      </div>\n      <div class="form-group" [ngClass]="{ \'has-error\': f.submitted && !password.valid }">\n        <label for="password">Password</label>\n        <input type="password" class="form-control" id="password" name="password" autocomplete="off" [(ngModel)]="userPassword" #password="ngModel" required />\n      </div>\n      <div id="remember" class="checkbox">\n\n      </div>\n      <button [disabled]="username.invalid || password.invalid" class="btn btn-lg btn-primary btn-block btn-signin" type="submit">LOGIN</button>\n    </form>\n  </div>\n  <footer>\n    <div class="footer">\n      <span>{{loginInfo.copyRightInfo}} <strong>Version:</strong> {{loginInfo.versionInfo}}\n          | <strong>UDI: </strong>{{loginInfo.uniqueDeviceIdentifier}} <span [innerHtml]="loginInfo.patentInfo"></span>\n      </span>\n    </div>\n  </footer>\n</div>\n',encapsulation:g.ViewEncapsulation.None,styles:["body,html{height:100%;background:no-repeat #3b3b3b}.ph-login-button{display:none}.card-container.card{max-width:490px;height:500px;padding:33px 55px 0}.btn{font-weight:700;height:36px;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.card{background-color:#fff;padding:20px 25px 30px;margin:100px auto 25px;border-radius:4px;box-shadow:0 2px 2px rgba(0,0,0,.3)}.profile-img-card{width:100%;height:3.5em;margin:0 auto 10px;display:block}.login-subtitle{font-size:1.2em;font-weight:700;color:#999;font-family:Tahoma;margin:10px 0 20px;min-height:1em}.reauth-email{display:block;color:#404040;line-height:2;margin-bottom:10px;font-size:14px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;box-sizing:border-box}.form-signin #inputEmail,.form-signin #inputPassword{direction:ltr;height:44px;font-size:16px}label{color:#d9d9d9;text-transform:uppercase;font-weight:400;font-size:14px;font-family:Tahoma}.form-signin button,.form-signin input[type=email],.form-signin input[type=password],.form-signin input[type=text]{width:100%;display:block;margin-bottom:10px;z-index:1;position:relative;box-sizing:border-box}.form-control:focus{border-left-color:#fff;border-right-color:#fff;border-top-color:#fff;box-shadow:none;-webkit-box-shadow:none}.form-control{background-color:#fff;border-radius:0}.form-group input{border-top:none;border-left:none;border-right:none;box-shadow:none;margin-bottom:2em;font-size:1.2em}.btn.btn-signin{background-color:#999;display:block;margin-right:auto;margin-left:auto;padding:0;font-weight:700;font-size:14px;font-family:Tahoma;width:50%;height:36px;border-radius:3px;border:#666;transition:218ms}.forgot-password{color:#6891a2}.forgot-password:active,.forgot-password:focus,.forgot-password:hover{color:#0c6121}.footer{font-size:.7em;position:fixed;width:100%;bottom:0;left:0;padding-left:5px;background-color:#fff}"]}]}],e.ctorParameters=function(){return[{type:p},{type:f}]},e.propDecorators={vc:[{type:g.ViewChildren,args:["input"]}]},e}(),m=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[c.HttpClientModule,p,f,u]}},e.decorators=[{type:g.NgModule,args:[{imports:[l.BrowserModule,a.FormsModule],declarations:[h],exports:[h]}]}],e}();e.LoginService=p,e.LoginIpService=f,e.LoginConfigService=u,e.LoginComponent=h,e.LoginModule=m,e.LoginIp=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-login-library.umd.min.js.map