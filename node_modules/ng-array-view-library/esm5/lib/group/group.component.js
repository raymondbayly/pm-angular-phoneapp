/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, Input, Renderer2 } from '@angular/core';
import { ArrayViewService } from '../service/array-view.service';
import { BehaviorSubject } from 'rxjs';
import { map, tap } from 'rxjs/operators';
import { PeraGraphService } from './pera-graph/service/pera-graph.service';
import { PeragraphApiService } from 'ng-common-library';
import { FilterService } from "ng-filters-library";
var GroupComponent = /** @class */ (function () {
    function GroupComponent(arrayViewService, filterService, peraGraphService, peragraphApiService, ref, elementRef, renderer) {
        var _this = this;
        this.arrayViewService = arrayViewService;
        this.filterService = filterService;
        this.peraGraphService = peraGraphService;
        this.peragraphApiService = peragraphApiService;
        this.ref = ref;
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.showPeraGraphs = false;
        this.expanded = false;
        this.filterFunction = null;
        // Default number of rows - TODO possibly make this configurable, or remember the user's last selection and save it
        this.nonExpandedRows = 3;
        this.expandedRows = 6;
        this.currentNumberOfRowsDisplayed = this.nonExpandedRows;
        this.options$ = new BehaviorSubject(null);
        // Differentiate between a single click and a double click
        this.clickTimer = 0;
        this.preventSingleClick = false;
        this.style = { maxHeight: this.viewContainerMaxHeight };
        this.hideGroup = false;
        /**
         * Function to determine equality, given two indicies in the array (optional, default: (p,c) => p === c))
         *
         * @param prevDataIndex
         * @param curDataIndex
         * @return
         */
        this.equals = function (prevDataIndex, curDataIndex) {
            /** @type {?} */
            var curPeraGraph = _this.currentPeraGraphs[curDataIndex];
            /** @type {?} */
            var previousPeraGraph = (_this.previousPeraGraphs) ? _this.previousPeraGraphs[prevDataIndex] : null;
            /*
             Most browsers maintain the order of the fields so this should work in most cases and when it fails, it'll just return false so anything
             else is an optimization
             */
            return previousPeraGraph != null && curPeraGraph != null && JSON.stringify(previousPeraGraph) === JSON.stringify(curPeraGraph);
        };
    }
    // TODO break pieces out into a service as appropriate
    // TODO break pieces out into a service as appropriate
    /**
     * @return {?}
     */
    GroupComponent.prototype.ngOnInit = 
    // TODO break pieces out into a service as appropriate
    /**
     * @return {?}
     */
    function () {
        // Set the group information
        this.groupName = this.group.laneTitle;
        this.filterFunction = this.group.laneFunction;
        this.updatePeraGraphs();
        if (this.expanded) {
            this.currentNumberOfRowsDisplayed = this.expandedRows;
        }
        else {
            this.currentNumberOfRowsDisplayed = this.nonExpandedRows;
        }
    };
    /**
     * @return {?}
     */
    GroupComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        this.updateNumberOfItemsInViewport();
        // Identify the ideal width, and set both it and the height through ng-style on the viewport container
        this.updateViewPortPerCurrentRows();
        this.updatePeraGraphs();
        this.maintainGroupLength();
    };
    /**
     * @return {?}
     */
    GroupComponent.prototype.hideOrDisplayGroup = /**
     * @return {?}
     */
    function () {
        if (this.elementRef) {
            if (this.groupLength === 0) {
                this.renderer.setStyle(this.elementRef.nativeElement, 'display', 'none');
            }
            else {
                this.renderer.setStyle(this.elementRef.nativeElement, 'display', 'block');
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    GroupComponent.prototype.updatePeraGraphs = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.peraGraphs$ = this.filteredPeraGraphs$.pipe(map(function (peraGraphs) { return peraGraphs.filter(function (peraGraph) { return _this.matchesGroup(peraGraph); }); }), tap(function (peraGraphs) {
            // Used to determine equality for virtual scrolling
            _this.previousPeraGraphs = _this.currentPeraGraphs;
            _this.currentPeraGraphs = peraGraphs;
            // Specifies the number of graphs in a group
            _this.groupLength = peraGraphs.length;
            _this.hideOrDisplayGroup();
        }));
    };
    /**
     * When we're not displaying PeraGraphs, we don't pass the observable to the virtual scroll which typically populates the group length.
     * This function will conditionally get the group length through other means.
     */
    /**
     * When we're not displaying PeraGraphs, we don't pass the observable to the virtual scroll which typically populates the group length.
     * This function will conditionally get the group length through other means.
     * @return {?}
     */
    GroupComponent.prototype.maintainGroupLength = /**
     * When we're not displaying PeraGraphs, we don't pass the observable to the virtual scroll which typically populates the group length.
     * This function will conditionally get the group length through other means.
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.showPeraGraphs) {
            // If we're not showing peraGraphs, subscribe separately so that we can get the group length
            this.peraGraphs_length$ = this.filteredPeraGraphs$.pipe(map(function (peraGraphs) {
                return peraGraphs.filter(function (peraGraph) { return _this.matchesGroup(peraGraph); });
            })).subscribe(function (peraGraphs) {
                _this.groupLength = peraGraphs.length;
                _this.hideOrDisplayGroup();
                if (_this.ref) {
                    _this.ref.detectChanges();
                }
            });
        }
        else if (this.peraGraphs_length$ && !this.peraGraphs_length$.closed) {
            // If we're showing peraGraphs, there's no need for this subscription
            this.peraGraphs_length$.unsubscribe();
        }
    };
    /**
     * This function determines which graphs belong to this group
     *
     * @param peraGraph
     * @returns
     */
    /**
     * This function determines which graphs belong to this group
     *
     * @param {?} peraGraph
     * @return {?}
     */
    GroupComponent.prototype.matchesGroup = /**
     * This function determines which graphs belong to this group
     *
     * @param {?} peraGraph
     * @return {?}
     */
    function (peraGraph) {
        if (this.filterFunction) {
            return this.filterFunction(peraGraph);
        }
        return true;
    };
    /**
     * Called when the viewport is being resized manually
     *
     * @param event
     */
    /**
     * Called when the viewport is being resized manually
     *
     * @param {?} event
     * @return {?}
     */
    GroupComponent.prototype.onResizing = /**
     * Called when the viewport is being resized manually
     *
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // Set the height according to the event
        this.viewContainerMaxHeight = event.rectangle.height + 'px';
        // Set the number of rows that should be displayed according to the new height
        this.currentNumberOfRowsDisplayed = Math.ceil(event.rectangle.height / this.peraGraphHeight);
        this.updateViewPortPerCurrentRows();
    };
    /**
     * Called when the header is clicked
     */
    /**
     * Called when the header is clicked
     * @return {?}
     */
    GroupComponent.prototype.click = /**
     * Called when the header is clicked
     * @return {?}
     */
    function () {
        var _this = this;
        this.preventSingleClick = false;
        // @ts-ignore
        this.clickTimer = setTimeout(function () {
            if (!_this.preventSingleClick) {
                _this.toggleShow();
                if (_this.ref) {
                    _this.ref.detectChanges();
                }
            }
        }, 200);
    };
    /**
     * Called when the header is double clicked
     */
    /**
     * Called when the header is double clicked
     * @return {?}
     */
    GroupComponent.prototype.doubleClick = /**
     * Called when the header is double clicked
     * @return {?}
     */
    function () {
        clearTimeout(this.clickTimer);
        this.preventSingleClick = true;
        this.toggleExpand();
    };
    /**
     * Updates the height/width of the viewport container as well as the height/width/number of items in the viewport
     */
    /**
     * Updates the height/width of the viewport container as well as the height/width/number of items in the viewport
     * @return {?}
     */
    GroupComponent.prototype.updateViewPortPerCurrentRows = /**
     * Updates the height/width of the viewport container as well as the height/width/number of items in the viewport
     * @return {?}
     */
    function () {
        if (this.expanded) {
            this.currentNumberOfRowsDisplayed = this.expandedRows;
        }
        else {
            this.currentNumberOfRowsDisplayed = this.nonExpandedRows;
        }
        // Set the height of the container from the number of rows that should be displayed
        this.viewContainerMaxHeight = this.getViewPortHeightFromRowsAsString(this.currentNumberOfRowsDisplayed);
        this.setStyle(this.viewContainerMaxHeight);
        // Update the options so that the correct number of rows are displayed in the viewport
        this.updateNumberOfItemsInViewport();
    };
    /**
     * Toggles whether or not any PeraGraphs are shown in the group
     */
    /**
     * Toggles whether or not any PeraGraphs are shown in the group
     * @return {?}
     */
    GroupComponent.prototype.toggleShow = /**
     * Toggles whether or not any PeraGraphs are shown in the group
     * @return {?}
     */
    function () {
        // Switch from removing the element from the DOM via ngIf to using the hidden attribute once it's rendered once
        this.hideGroup = (this.showPeraGraphs) ? !this.hideGroup : false;
        this.arrayViewService.tokenRefresh$.next();
        // If we have never displayed PeraGraphs in this group
        if (!this.showPeraGraphs) {
            // Start rendering graphs for the first time
            this.startRenderingPeraGraphs();
        }
    };
    /**
     * This function toggles expansion of the viewport height
     */
    /**
     * This function toggles expansion of the viewport height
     * @return {?}
     */
    GroupComponent.prototype.toggleExpand = /**
     * This function toggles expansion of the viewport height
     * @return {?}
     */
    function () {
        this.arrayViewService.tokenRefresh$.next();
        this.expanded = !this.expanded;
        // Update the number of rows being displayed according to the current expanded status
        this.currentNumberOfRowsDisplayed = (this.expanded) ? this.expandedRows : this.nonExpandedRows;
        // Update the viewport
        this.updateViewPortPerCurrentRows();
        // If we're not showing graphs, show them
        if (!this.showPeraGraphs || this.hideGroup) {
            this.hideGroup = false;
            // If we have never displayed peragraphs in this group
            if (!this.showPeraGraphs) {
                // Start rendering graphs for the first time
                this.startRenderingPeraGraphs();
            }
        }
    };
    /**
     * If ngIf is currently evaluating to false, trigger a change and update the view container
     */
    /**
     * If ngIf is currently evaluating to false, trigger a change and update the view container
     * @return {?}
     */
    GroupComponent.prototype.startRenderingPeraGraphs = /**
     * If ngIf is currently evaluating to false, trigger a change and update the view container
     * @return {?}
     */
    function () {
        this.showPeraGraphs = true;
        this.updateViewPortPerCurrentRows();
        if (this.ref) {
            this.ref.detectChanges();
        }
    };
    /**
     * Updates item size and the number of rows being rendered
     */
    /**
     * Updates item size and the number of rows being rendered
     * @return {?}
     */
    GroupComponent.prototype.updateNumberOfItemsInViewport = /**
     * Updates item size and the number of rows being rendered
     * @return {?}
     */
    function () {
        this.options$.next({
            itemHeight: this.peraGraphHeight,
            itemWidth: this.peraGraphWidth,
            numAdditionalRows: this.getNumberOfRowsToRender()
        });
    };
    /**
     * Applies a buffer to the number of rows being displayed to improve scrolling performance
     *
     * @returns
     */
    /**
     * Applies a buffer to the number of rows being displayed to improve scrolling performance
     *
     * @return {?}
     */
    GroupComponent.prototype.getNumberOfRowsToRender = /**
     * Applies a buffer to the number of rows being displayed to improve scrolling performance
     *
     * @return {?}
     */
    function () {
        /** @type {?} */
        var additionalRowsToRender = (this.arrayViewService.isDisplayingTiles()) ? 100 : 2;
        return this.currentNumberOfRowsDisplayed + additionalRowsToRender;
    };
    /**
     * Set the height and width of the viewport container
     *
     * @param height
     */
    /**
     * Set the height and width of the viewport container
     *
     * @param {?} height
     * @return {?}
     */
    GroupComponent.prototype.setStyle = /**
     * Set the height and width of the viewport container
     *
     * @param {?} height
     * @return {?}
     */
    function (height) {
        this.style = {
            maxHeight: height,
            width: this.scrollContainerWidth
        };
    };
    /**
     * Returns the ideal viewport height for the number of rows passed to the function
     *
     * @param rows
     * @returns
     */
    /**
     * Returns the ideal viewport height for the number of rows passed to the function
     *
     * @param {?} rows
     * @return {?}
     */
    GroupComponent.prototype.getViewPortHeightFromRowsAsString = /**
     * Returns the ideal viewport height for the number of rows passed to the function
     *
     * @param {?} rows
     * @return {?}
     */
    function (rows) {
        return this.peraGraphHeight * rows + 'px';
    };
    /**
     * @return {?}
     */
    GroupComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.ref) {
            this.ref.detach();
            this.ref = null;
        }
        this.filterFunction = null;
    };
    GroupComponent.decorators = [
        { type: Component, args: [{
                    selector: 'phlib-group',
                    template: "<div class=\"clickable-header\">\n  <app-group-header\n    (click)=\"click()\"\n    (dblclick)=\"doubleClick()\"\n    [name]=\"groupName\"\n    [numberOfPatients]=\"groupLength\"\n    *ngIf=\"groupName\"\n  ></app-group-header>\n</div>\n\n<od-virtualscroll class=\"ph-group\" *ngIf=\"showPeraGraphs\" [ngStyle]=\"style\"\n                  mwlResizable [resizeEdges]=\"{bottom: true}\"\n                  (resizing)=\"onResizing($event)\" [resizeCursorPrecision]=\"8\" [vsData]=\"peraGraphs$\"\n                  [vsOptions]=\"options$\" [vsEqualsFunc]=\"equals\" [hidden]=\"hideGroup\">\n  <ng-template let-peraGraph>\n    <phlib-pera-graph\n      [graph]=\"peraGraph\"\n      [peraGraphHeight]=\"peraGraphHeight\"\n      [peraGraphWidth]=\"peraGraphWidth\">\n      >\n    </phlib-pera-graph>\n  </ng-template>\n</od-virtualscroll>\n",
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: ["mwlResizable{box-sizing:border-box}.ph-group{margin-right:5vw;margin-left:5vw;overflow:auto;display:flex;justify-content:space-between}/deep/ .od-scroll-container{margin:0}.clickable-header{margin-right:8vw}"]
                }] }
    ];
    /** @nocollapse */
    GroupComponent.ctorParameters = function () { return [
        { type: ArrayViewService },
        { type: FilterService },
        { type: PeraGraphService },
        { type: PeragraphApiService },
        { type: ChangeDetectorRef },
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    GroupComponent.propDecorators = {
        showPeraGraphs: [{ type: Input }],
        expanded: [{ type: Input }],
        group: [{ type: Input }],
        peraGraphHeight: [{ type: Input }],
        peraGraphWidth: [{ type: Input }],
        scrollContainerWidth: [{ type: Input }],
        filteredPeraGraphs$: [{ type: Input }]
    };
    return GroupComponent;
}());
export { GroupComponent };
if (false) {
    /** @type {?} */
    GroupComponent.prototype.showPeraGraphs;
    /** @type {?} */
    GroupComponent.prototype.expanded;
    /** @type {?} */
    GroupComponent.prototype.group;
    /** @type {?} */
    GroupComponent.prototype.peraGraphHeight;
    /** @type {?} */
    GroupComponent.prototype.peraGraphWidth;
    /** @type {?} */
    GroupComponent.prototype.scrollContainerWidth;
    /** @type {?} */
    GroupComponent.prototype.filteredPeraGraphs$;
    /** @type {?} */
    GroupComponent.prototype.groupName;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.filterFunction;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.nonExpandedRows;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.expandedRows;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.currentNumberOfRowsDisplayed;
    /** @type {?} */
    GroupComponent.prototype.peraGraphs$;
    /** @type {?} */
    GroupComponent.prototype.peraGraphs_length$;
    /** @type {?} */
    GroupComponent.prototype.options$;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.previousPeraGraphs;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.currentPeraGraphs;
    /** @type {?} */
    GroupComponent.prototype.groupLength;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.clickTimer;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.preventSingleClick;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.viewContainerMaxHeight;
    /** @type {?} */
    GroupComponent.prototype.style;
    /** @type {?} */
    GroupComponent.prototype.hideGroup;
    /**
     * Function to determine equality, given two indicies in the array (optional, default: (p,c) => p === c))
     *
     * \@param prevDataIndex
     * \@param curDataIndex
     * \@return
     * @type {?}
     */
    GroupComponent.prototype.equals;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.arrayViewService;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.peraGraphService;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.peragraphApiService;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.ref;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    GroupComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctYXJyYXktdmlldy1saWJyYXJ5LyIsInNvdXJjZXMiOlsibGliL2dyb3VwL2dyb3VwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUFFLFVBQVUsRUFDckIsS0FBSyxFQUdHLFNBQVMsRUFDcEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFDLGVBQWUsRUFBMkIsTUFBTSxNQUFNLENBQUM7QUFDL0QsT0FBTyxFQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QyxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSx5Q0FBeUMsQ0FBQztBQUV6RSxPQUFPLEVBQUMsbUJBQW1CLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUN0RCxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFFakQ7SUFzREksd0JBQW9CLGdCQUFrQyxFQUNsQyxhQUE0QixFQUM1QixnQkFBa0MsRUFDbEMsbUJBQXdDLEVBQ3hDLEdBQXNCLEVBQ3RCLFVBQXNCLEVBQ3RCLFFBQW1CO1FBTnZDLGlCQU9DO1FBUG1CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBQ3hDLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3RCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQW5EaEMsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFFOUIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQWNULG1C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QzVCLHNDQUF5Qjs7Ozs7SUFDekIsc0RBQTREOztJQUc1RCxxQ0FBaUQ7O0lBQ2pELDRDQUF3Qzs7SUFDeEMsa0NBQTJHOzs7OztJQUczRyw0Q0FBNkM7Ozs7O0lBQzdDLDJDQUE0Qzs7SUFHNUMscUNBQTJCOzs7OztJQUczQixvQ0FBdUI7Ozs7O0lBQ3ZCLDRDQUFtQzs7Ozs7SUFHbkMsZ0RBQXVDOztJQUN2QywrQkFBZ0U7O0lBRWhFLG1DQUF5Qjs7Ozs7Ozs7O0lBaUd6QixnQ0FRRTs7Ozs7SUF2R1UsMENBQTBDOzs7OztJQUMxQyx1Q0FBb0M7Ozs7O0lBQ3BDLDBDQUEwQzs7Ozs7SUFDMUMsNkNBQWdEOzs7OztJQUNoRCw2QkFBOEI7Ozs7O0lBQzlCLG9DQUE4Qjs7Ozs7SUFDOUIsa0NBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEhvc3RCaW5kaW5nLFxuICAgIElucHV0LFxuICAgIE9uQ2hhbmdlcyxcbiAgICBPbkRlc3Ryb3ksXG4gICAgT25Jbml0LCBSZW5kZXJlcjJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0FycmF5Vmlld1NlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2UvYXJyYXktdmlldy5zZXJ2aWNlJztcbmltcG9ydCB7QmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb259IGZyb20gJ3J4anMnO1xuaW1wb3J0IHttYXAsIHRhcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtSZXNpemVFdmVudH0gZnJvbSAnYW5ndWxhci1yZXNpemFibGUtZWxlbWVudCc7XG5pbXBvcnQge1BlcmFHcmFwaFNlcnZpY2V9IGZyb20gJy4vcGVyYS1ncmFwaC9zZXJ2aWNlL3BlcmEtZ3JhcGguc2VydmljZSc7XG5pbXBvcnQge1BlcmFHcmFwaH0gZnJvbSAnbmctY29tbW9uLWxpYnJhcnkvbGliL21vZGVsL1BlcmFHcmFwaCc7XG5pbXBvcnQge1BlcmFncmFwaEFwaVNlcnZpY2V9IGZyb20gJ25nLWNvbW1vbi1saWJyYXJ5JztcbmltcG9ydCB7RmlsdGVyU2VydmljZX0gZnJvbSBcIm5nLWZpbHRlcnMtbGlicmFyeVwiO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3BobGliLWdyb3VwJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZ3JvdXAuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2dyb3VwLmNvbXBvbmVudC5jc3MnXSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBHcm91cENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgc2hvd1BlcmFHcmFwaHMgPSBmYWxzZTtcbiAgICBASW5wdXQoKVxuICAgIGV4cGFuZGVkID0gZmFsc2U7XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgZ3JvdXA6IHsgbGFuZUZ1bmN0aW9uOiAocGVyYUdyYXBoOiBQZXJhR3JhcGgpID0+IGJvb2xlYW4sIGxhbmVUaXRsZTogc3RyaW5nIH07XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgcGVyYUdyYXBoSGVpZ2h0OiBudW1iZXI7XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgcGVyYUdyYXBoV2lkdGg6IG51bWJlcjtcbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBzY3JvbGxDb250YWluZXJXaWR0aDogc3RyaW5nO1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGZpbHRlcmVkUGVyYUdyYXBocyQ6IEJlaGF2aW9yU3ViamVjdDxQZXJhR3JhcGhbXT47XG5cbiAgICAvLyBHcm91cCBpbmZvcm1hdGlvblxuICAgIHB1YmxpYyBncm91cE5hbWU6IHN0cmluZztcbiAgICBwcml2YXRlIGZpbHRlckZ1bmN0aW9uID0gbnVsbDtcblxuICAgIC8vIERlZmF1bHQgbnVtYmVyIG9mIHJvd3MgLSBUT0RPIHBvc3NpYmx5IG1ha2UgdGhpcyBjb25maWd1cmFibGUsIG9yIHJlbWVtYmVyIHRoZSB1c2VyJ3MgbGFzdCBzZWxlY3Rpb24gYW5kIHNhdmUgaXRcbiAgICBwcml2YXRlIG5vbkV4cGFuZGVkUm93cyA9IDM7XG4gICAgcHJpdmF0ZSBleHBhbmRlZFJvd3MgPSA2O1xuICAgIHByaXZhdGUgY3VycmVudE51bWJlck9mUm93c0Rpc3BsYXllZCA9IHRoaXMubm9uRXhwYW5kZWRSb3dzO1xuXG4gICAgLy8gT2JzZXJ2YWJsZXNcbiAgICBwdWJsaWMgcGVyYUdyYXBocyQ6IE9ic2VydmFibGU8QXJyYXk8UGVyYUdyYXBoPj47XG4gICAgcHVibGljIHBlcmFHcmFwaHNfbGVuZ3RoJDogU3Vic2NyaXB0aW9uO1xuICAgIG9wdGlvbnMkID0gbmV3IEJlaGF2aW9yU3ViamVjdDx7IGl0ZW1IZWlnaHQ6IG51bWJlciwgaXRlbVdpZHRoOiBudW1iZXIsIG51bUFkZGl0aW9uYWxSb3dzOiBudW1iZXIgfT4obnVsbCk7XG5cbiAgICAvLyBNYWludGFpbmVkIHRvIGRldGVybWluZSBjaGFydCBlcXVhbGl0eVxuICAgIHByaXZhdGUgcHJldmlvdXNQZXJhR3JhcGhzOiBBcnJheTxQZXJhR3JhcGg+O1xuICAgIHByaXZhdGUgY3VycmVudFBlcmFHcmFwaHM6IEFycmF5PFBlcmFHcmFwaD47XG5cbiAgICAvLyBEaXNwbGF5ZWQgaW4gdGhlIGhlYWRlclxuICAgIHB1YmxpYyBncm91cExlbmd0aDogbnVtYmVyO1xuXG4gICAgLy8gRGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGEgc2luZ2xlIGNsaWNrIGFuZCBhIGRvdWJsZSBjbGlja1xuICAgIHByaXZhdGUgY2xpY2tUaW1lciA9IDA7XG4gICAgcHJpdmF0ZSBwcmV2ZW50U2luZ2xlQ2xpY2sgPSBmYWxzZTtcblxuICAgIC8vIEFsbG93cyBmb3Igc2ltcGxlIHJlc2l6aW5nIG9mIHRoZSB2aWV3cG9ydFxuICAgIHByaXZhdGUgdmlld0NvbnRhaW5lck1heEhlaWdodDogc3RyaW5nO1xuICAgIHB1YmxpYyBzdHlsZTogb2JqZWN0ID0ge21heEhlaWdodDogdGhpcy52aWV3Q29udGFpbmVyTWF4SGVpZ2h0fTtcblxuICAgIHB1YmxpYyBoaWRlR3JvdXAgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYXJyYXlWaWV3U2VydmljZTogQXJyYXlWaWV3U2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGZpbHRlclNlcnZpY2U6IEZpbHRlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBwZXJhR3JhcGhTZXJ2aWNlOiBQZXJhR3JhcGhTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcGVyYWdyYXBoQXBpU2VydmljZTogUGVyYWdyYXBoQXBpU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIH1cblxuICAgIC8vIFRPRE8gYnJlYWsgcGllY2VzIG91dCBpbnRvIGEgc2VydmljZSBhcyBhcHByb3ByaWF0ZVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIC8vIFNldCB0aGUgZ3JvdXAgaW5mb3JtYXRpb25cbiAgICAgICAgdGhpcy5ncm91cE5hbWUgPSB0aGlzLmdyb3VwLmxhbmVUaXRsZTtcbiAgICAgICAgdGhpcy5maWx0ZXJGdW5jdGlvbiA9IHRoaXMuZ3JvdXAubGFuZUZ1bmN0aW9uO1xuICAgICAgICB0aGlzLnVwZGF0ZVBlcmFHcmFwaHMoKTtcbiAgICAgICAgaWYgKHRoaXMuZXhwYW5kZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudE51bWJlck9mUm93c0Rpc3BsYXllZCA9IHRoaXMuZXhwYW5kZWRSb3dzXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnROdW1iZXJPZlJvd3NEaXNwbGF5ZWQgPSB0aGlzLm5vbkV4cGFuZGVkUm93cztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKCkge1xuICAgICAgICB0aGlzLnVwZGF0ZU51bWJlck9mSXRlbXNJblZpZXdwb3J0KCk7XG4gICAgICAgIC8vIElkZW50aWZ5IHRoZSBpZGVhbCB3aWR0aCwgYW5kIHNldCBib3RoIGl0IGFuZCB0aGUgaGVpZ2h0IHRocm91Z2ggbmctc3R5bGUgb24gdGhlIHZpZXdwb3J0IGNvbnRhaW5lclxuICAgICAgICB0aGlzLnVwZGF0ZVZpZXdQb3J0UGVyQ3VycmVudFJvd3MoKTtcbiAgICAgICAgdGhpcy51cGRhdGVQZXJhR3JhcGhzKCk7XG4gICAgICAgIHRoaXMubWFpbnRhaW5Hcm91cExlbmd0aCgpO1xuICAgIH1cblxuICAgIGhpZGVPckRpc3BsYXlHcm91cCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudFJlZikge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ3JvdXBMZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVBlcmFHcmFwaHMoKSB7XG4gICAgICAgIHRoaXMucGVyYUdyYXBocyQgPSB0aGlzLmZpbHRlcmVkUGVyYUdyYXBocyQucGlwZShcbiAgICAgICAgICAgIG1hcChwZXJhR3JhcGhzID0+IHBlcmFHcmFwaHMuZmlsdGVyKHBlcmFHcmFwaCA9PiB0aGlzLm1hdGNoZXNHcm91cChwZXJhR3JhcGgpKSksXG4gICAgICAgICAgICB0YXAocGVyYUdyYXBocyA9PiB7XG4gICAgICAgICAgICAgICAgLy8gVXNlZCB0byBkZXRlcm1pbmUgZXF1YWxpdHkgZm9yIHZpcnR1YWwgc2Nyb2xsaW5nXG4gICAgICAgICAgICAgICAgdGhpcy5wcmV2aW91c1BlcmFHcmFwaHMgPSB0aGlzLmN1cnJlbnRQZXJhR3JhcGhzO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBlcmFHcmFwaHMgPSBwZXJhR3JhcGhzO1xuICAgICAgICAgICAgICAgIC8vIFNwZWNpZmllcyB0aGUgbnVtYmVyIG9mIGdyYXBocyBpbiBhIGdyb3VwXG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cExlbmd0aCA9IHBlcmFHcmFwaHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZU9yRGlzcGxheUdyb3VwKCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2hlbiB3ZSdyZSBub3QgZGlzcGxheWluZyBQZXJhR3JhcGhzLCB3ZSBkb24ndCBwYXNzIHRoZSBvYnNlcnZhYmxlIHRvIHRoZSB2aXJ0dWFsIHNjcm9sbCB3aGljaCB0eXBpY2FsbHkgcG9wdWxhdGVzIHRoZSBncm91cCBsZW5ndGguXG4gICAgICogVGhpcyBmdW5jdGlvbiB3aWxsIGNvbmRpdGlvbmFsbHkgZ2V0IHRoZSBncm91cCBsZW5ndGggdGhyb3VnaCBvdGhlciBtZWFucy5cbiAgICAgKi9cbiAgICBtYWludGFpbkdyb3VwTGVuZ3RoKCkge1xuICAgICAgICBpZiAoIXRoaXMuc2hvd1BlcmFHcmFwaHMpIHtcbiAgICAgICAgICAgIC8vIElmIHdlJ3JlIG5vdCBzaG93aW5nIHBlcmFHcmFwaHMsIHN1YnNjcmliZSBzZXBhcmF0ZWx5IHNvIHRoYXQgd2UgY2FuIGdldCB0aGUgZ3JvdXAgbGVuZ3RoXG4gICAgICAgICAgICB0aGlzLnBlcmFHcmFwaHNfbGVuZ3RoJCA9IHRoaXMuZmlsdGVyZWRQZXJhR3JhcGhzJC5waXBlKG1hcChwZXJhR3JhcGhzID0+XG4gICAgICAgICAgICAgICAgcGVyYUdyYXBocy5maWx0ZXIocGVyYUdyYXBoID0+IHRoaXMubWF0Y2hlc0dyb3VwKHBlcmFHcmFwaCkpKSkuc3Vic2NyaWJlKChwZXJhR3JhcGhzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cExlbmd0aCA9IHBlcmFHcmFwaHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZU9yRGlzcGxheUdyb3VwKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVmKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBlcmFHcmFwaHNfbGVuZ3RoJCAmJiAhdGhpcy5wZXJhR3JhcGhzX2xlbmd0aCQuY2xvc2VkKSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSdyZSBzaG93aW5nIHBlcmFHcmFwaHMsIHRoZXJlJ3Mgbm8gbmVlZCBmb3IgdGhpcyBzdWJzY3JpcHRpb25cbiAgICAgICAgICAgIHRoaXMucGVyYUdyYXBoc19sZW5ndGgkLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIGRldGVybWluZXMgd2hpY2ggZ3JhcGhzIGJlbG9uZyB0byB0aGlzIGdyb3VwXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGVyYUdyYXBoXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBtYXRjaGVzR3JvdXAocGVyYUdyYXBoOiBQZXJhR3JhcGgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlckZ1bmN0aW9uKHBlcmFHcmFwaCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWFsaXR5LCBnaXZlbiB0d28gaW5kaWNpZXMgaW4gdGhlIGFycmF5IChvcHRpb25hbCwgZGVmYXVsdDogKHAsYykgPT4gcCA9PT0gYykpXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcHJldkRhdGFJbmRleFxuICAgICAqIEBwYXJhbSBjdXJEYXRhSW5kZXhcbiAgICAgKiBAcmV0dXJuc1xuICAgICAqL1xuICAgIGVxdWFscyA9IChwcmV2RGF0YUluZGV4OiBudW1iZXIsIGN1ckRhdGFJbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGN1clBlcmFHcmFwaCA9IHRoaXMuY3VycmVudFBlcmFHcmFwaHNbY3VyRGF0YUluZGV4XTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNQZXJhR3JhcGggPSAodGhpcy5wcmV2aW91c1BlcmFHcmFwaHMpID8gdGhpcy5wcmV2aW91c1BlcmFHcmFwaHNbcHJldkRhdGFJbmRleF0gOiBudWxsO1xuICAgICAgICAvKlxuICAgICAgICAgTW9zdCBicm93c2VycyBtYWludGFpbiB0aGUgb3JkZXIgb2YgdGhlIGZpZWxkcyBzbyB0aGlzIHNob3VsZCB3b3JrIGluIG1vc3QgY2FzZXMgYW5kIHdoZW4gaXQgZmFpbHMsIGl0J2xsIGp1c3QgcmV0dXJuIGZhbHNlIHNvIGFueXRoaW5nXG4gICAgICAgICBlbHNlIGlzIGFuIG9wdGltaXphdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHByZXZpb3VzUGVyYUdyYXBoICE9IG51bGwgJiYgY3VyUGVyYUdyYXBoICE9IG51bGwgJiYgSlNPTi5zdHJpbmdpZnkocHJldmlvdXNQZXJhR3JhcGgpID09PSBKU09OLnN0cmluZ2lmeShjdXJQZXJhR3JhcGgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgdmlld3BvcnQgaXMgYmVpbmcgcmVzaXplZCBtYW51YWxseVxuICAgICAqXG4gICAgICogQHBhcmFtIGV2ZW50XG4gICAgICovXG4gICAgb25SZXNpemluZyhldmVudDogUmVzaXplRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgLy8gU2V0IHRoZSBoZWlnaHQgYWNjb3JkaW5nIHRvIHRoZSBldmVudFxuICAgICAgICB0aGlzLnZpZXdDb250YWluZXJNYXhIZWlnaHQgPSBldmVudC5yZWN0YW5nbGUuaGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgLy8gU2V0IHRoZSBudW1iZXIgb2Ygcm93cyB0aGF0IHNob3VsZCBiZSBkaXNwbGF5ZWQgYWNjb3JkaW5nIHRvIHRoZSBuZXcgaGVpZ2h0XG4gICAgICAgIHRoaXMuY3VycmVudE51bWJlck9mUm93c0Rpc3BsYXllZCA9IE1hdGguY2VpbChldmVudC5yZWN0YW5nbGUuaGVpZ2h0IC8gdGhpcy5wZXJhR3JhcGhIZWlnaHQpO1xuICAgICAgICB0aGlzLnVwZGF0ZVZpZXdQb3J0UGVyQ3VycmVudFJvd3MoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgaGVhZGVyIGlzIGNsaWNrZWRcbiAgICAgKi9cbiAgICBjbGljaygpIHtcbiAgICAgICAgdGhpcy5wcmV2ZW50U2luZ2xlQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0aGlzLmNsaWNrVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5wcmV2ZW50U2luZ2xlQ2xpY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVNob3coKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMjAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgaGVhZGVyIGlzIGRvdWJsZSBjbGlja2VkXG4gICAgICovXG4gICAgZG91YmxlQ2xpY2soKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNsaWNrVGltZXIpO1xuICAgICAgICB0aGlzLnByZXZlbnRTaW5nbGVDbGljayA9IHRydWU7XG4gICAgICAgIHRoaXMudG9nZ2xlRXhwYW5kKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgaGVpZ2h0L3dpZHRoIG9mIHRoZSB2aWV3cG9ydCBjb250YWluZXIgYXMgd2VsbCBhcyB0aGUgaGVpZ2h0L3dpZHRoL251bWJlciBvZiBpdGVtcyBpbiB0aGUgdmlld3BvcnRcbiAgICAgKi9cbiAgICB1cGRhdGVWaWV3UG9ydFBlckN1cnJlbnRSb3dzKCkge1xuICAgICAgICBpZiAodGhpcy5leHBhbmRlZCkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TnVtYmVyT2ZSb3dzRGlzcGxheWVkID0gdGhpcy5leHBhbmRlZFJvd3NcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudE51bWJlck9mUm93c0Rpc3BsYXllZCA9IHRoaXMubm9uRXhwYW5kZWRSb3dzO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNldCB0aGUgaGVpZ2h0IG9mIHRoZSBjb250YWluZXIgZnJvbSB0aGUgbnVtYmVyIG9mIHJvd3MgdGhhdCBzaG91bGQgYmUgZGlzcGxheWVkXG4gICAgICAgIHRoaXMudmlld0NvbnRhaW5lck1heEhlaWdodCA9IHRoaXMuZ2V0Vmlld1BvcnRIZWlnaHRGcm9tUm93c0FzU3RyaW5nKHRoaXMuY3VycmVudE51bWJlck9mUm93c0Rpc3BsYXllZCk7XG4gICAgICAgIHRoaXMuc2V0U3R5bGUodGhpcy52aWV3Q29udGFpbmVyTWF4SGVpZ2h0KTtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBvcHRpb25zIHNvIHRoYXQgdGhlIGNvcnJlY3QgbnVtYmVyIG9mIHJvd3MgYXJlIGRpc3BsYXllZCBpbiB0aGUgdmlld3BvcnRcbiAgICAgICAgdGhpcy51cGRhdGVOdW1iZXJPZkl0ZW1zSW5WaWV3cG9ydCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZXMgd2hldGhlciBvciBub3QgYW55IFBlcmFHcmFwaHMgYXJlIHNob3duIGluIHRoZSBncm91cFxuICAgICAqL1xuICAgIHRvZ2dsZVNob3coKSB7XG4gICAgICAgIC8vIFN3aXRjaCBmcm9tIHJlbW92aW5nIHRoZSBlbGVtZW50IGZyb20gdGhlIERPTSB2aWEgbmdJZiB0byB1c2luZyB0aGUgaGlkZGVuIGF0dHJpYnV0ZSBvbmNlIGl0J3MgcmVuZGVyZWQgb25jZVxuICAgICAgICB0aGlzLmhpZGVHcm91cCA9ICh0aGlzLnNob3dQZXJhR3JhcGhzKSA/ICF0aGlzLmhpZGVHcm91cCA6IGZhbHNlO1xuICAgICAgICB0aGlzLmFycmF5Vmlld1NlcnZpY2UudG9rZW5SZWZyZXNoJC5uZXh0KCk7XG5cbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBuZXZlciBkaXNwbGF5ZWQgUGVyYUdyYXBocyBpbiB0aGlzIGdyb3VwXG4gICAgICAgIGlmICghdGhpcy5zaG93UGVyYUdyYXBocykge1xuICAgICAgICAgICAgLy8gU3RhcnQgcmVuZGVyaW5nIGdyYXBocyBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICAgICAgICAgIHRoaXMuc3RhcnRSZW5kZXJpbmdQZXJhR3JhcGhzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIHRvZ2dsZXMgZXhwYW5zaW9uIG9mIHRoZSB2aWV3cG9ydCBoZWlnaHRcbiAgICAgKi9cbiAgICB0b2dnbGVFeHBhbmQoKSB7XG4gICAgICAgIHRoaXMuYXJyYXlWaWV3U2VydmljZS50b2tlblJlZnJlc2gkLm5leHQoKTtcbiAgICAgICAgdGhpcy5leHBhbmRlZCA9ICF0aGlzLmV4cGFuZGVkO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIG51bWJlciBvZiByb3dzIGJlaW5nIGRpc3BsYXllZCBhY2NvcmRpbmcgdG8gdGhlIGN1cnJlbnQgZXhwYW5kZWQgc3RhdHVzXG4gICAgICAgIHRoaXMuY3VycmVudE51bWJlck9mUm93c0Rpc3BsYXllZCA9ICh0aGlzLmV4cGFuZGVkKSA/IHRoaXMuZXhwYW5kZWRSb3dzIDogdGhpcy5ub25FeHBhbmRlZFJvd3M7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgdmlld3BvcnRcbiAgICAgICAgdGhpcy51cGRhdGVWaWV3UG9ydFBlckN1cnJlbnRSb3dzKCk7XG4gICAgICAgIC8vIElmIHdlJ3JlIG5vdCBzaG93aW5nIGdyYXBocywgc2hvdyB0aGVtXG4gICAgICAgIGlmICghdGhpcy5zaG93UGVyYUdyYXBocyB8fCB0aGlzLmhpZGVHcm91cCkge1xuICAgICAgICAgICAgdGhpcy5oaWRlR3JvdXAgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgbmV2ZXIgZGlzcGxheWVkIHBlcmFncmFwaHMgaW4gdGhpcyBncm91cFxuICAgICAgICAgICAgaWYgKCF0aGlzLnNob3dQZXJhR3JhcGhzKSB7XG4gICAgICAgICAgICAgICAgLy8gU3RhcnQgcmVuZGVyaW5nIGdyYXBocyBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0UmVuZGVyaW5nUGVyYUdyYXBocygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgbmdJZiBpcyBjdXJyZW50bHkgZXZhbHVhdGluZyB0byBmYWxzZSwgdHJpZ2dlciBhIGNoYW5nZSBhbmQgdXBkYXRlIHRoZSB2aWV3IGNvbnRhaW5lclxuICAgICAqL1xuICAgIHN0YXJ0UmVuZGVyaW5nUGVyYUdyYXBocygpIHtcbiAgICAgICAgdGhpcy5zaG93UGVyYUdyYXBocyA9IHRydWU7XG4gICAgICAgIHRoaXMudXBkYXRlVmlld1BvcnRQZXJDdXJyZW50Um93cygpO1xuICAgICAgICBpZiAodGhpcy5yZWYpIHtcbiAgICAgICAgICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgaXRlbSBzaXplIGFuZCB0aGUgbnVtYmVyIG9mIHJvd3MgYmVpbmcgcmVuZGVyZWRcbiAgICAgKi9cbiAgICB1cGRhdGVOdW1iZXJPZkl0ZW1zSW5WaWV3cG9ydCgpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zJC5uZXh0KHtcbiAgICAgICAgICAgIGl0ZW1IZWlnaHQ6IHRoaXMucGVyYUdyYXBoSGVpZ2h0LFxuICAgICAgICAgICAgaXRlbVdpZHRoOiB0aGlzLnBlcmFHcmFwaFdpZHRoLFxuICAgICAgICAgICAgbnVtQWRkaXRpb25hbFJvd3M6IHRoaXMuZ2V0TnVtYmVyT2ZSb3dzVG9SZW5kZXIoKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGEgYnVmZmVyIHRvIHRoZSBudW1iZXIgb2Ygcm93cyBiZWluZyBkaXNwbGF5ZWQgdG8gaW1wcm92ZSBzY3JvbGxpbmcgcGVyZm9ybWFuY2VcbiAgICAgKlxuICAgICAqIEByZXR1cm5zXG4gICAgICovXG4gICAgZ2V0TnVtYmVyT2ZSb3dzVG9SZW5kZXIoKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgYWRkaXRpb25hbFJvd3NUb1JlbmRlciA9ICh0aGlzLmFycmF5Vmlld1NlcnZpY2UuaXNEaXNwbGF5aW5nVGlsZXMoKSkgPyAxMDAgOiAyO1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TnVtYmVyT2ZSb3dzRGlzcGxheWVkICsgYWRkaXRpb25hbFJvd3NUb1JlbmRlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGhlaWdodCBhbmQgd2lkdGggb2YgdGhlIHZpZXdwb3J0IGNvbnRhaW5lclxuICAgICAqXG4gICAgICogQHBhcmFtIGhlaWdodFxuICAgICAqL1xuICAgIHNldFN0eWxlKGhlaWdodDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc3R5bGUgPSB7XG4gICAgICAgICAgICBtYXhIZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLnNjcm9sbENvbnRhaW5lcldpZHRoXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgaWRlYWwgdmlld3BvcnQgaGVpZ2h0IGZvciB0aGUgbnVtYmVyIG9mIHJvd3MgcGFzc2VkIHRvIHRoZSBmdW5jdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIHJvd3NcbiAgICAgKiBAcmV0dXJuc1xuICAgICAqL1xuICAgIGdldFZpZXdQb3J0SGVpZ2h0RnJvbVJvd3NBc1N0cmluZyhyb3dzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5wZXJhR3JhcGhIZWlnaHQgKiByb3dzICsgJ3B4JztcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMucmVmKSB7XG4gICAgICAgICAgICB0aGlzLnJlZi5kZXRhY2goKTtcbiAgICAgICAgICAgIHRoaXMucmVmID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbHRlckZ1bmN0aW9uID0gbnVsbDtcbiAgICB9XG59XG4iXX0=