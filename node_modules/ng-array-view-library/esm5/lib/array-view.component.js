/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, Input, ViewChild } from '@angular/core';
import { ArrayViewService } from './service/array-view.service';
import { BehaviorSubject, combineLatest, of } from 'rxjs';
import { filter, first, map, mergeMap, tap } from 'rxjs/operators';
import { PeraGraphService } from './group/pera-graph/service/pera-graph.service';
import { ArrayViewConfigService } from './service/array-view-config.service';
import { PriorWarningsConfigService } from './service/prior-warnings/config/prior-warnings-config.service';
import { PriorWarningsApiService } from './service/prior-warnings/api/prior-warnings-api.service';
import { FlowsheetsApiService, PeragraphApiService } from 'ng-common-library';
import { FilterService, SortService, GroupService } from 'ng-filters-library';
var ArrayViewComponent = /** @class */ (function () {
    function ArrayViewComponent(arrayViewService, arrayViewConfigService, peragraphApiService, filterService, flowsheetsApiService, priorWarningsConfigService, priorWarningsApiService, peraGraphService, sortService, groupService, ref) {
        this.arrayViewService = arrayViewService;
        this.arrayViewConfigService = arrayViewConfigService;
        this.peragraphApiService = peragraphApiService;
        this.filterService = filterService;
        this.flowsheetsApiService = flowsheetsApiService;
        this.priorWarningsConfigService = priorWarningsConfigService;
        this.priorWarningsApiService = priorWarningsApiService;
        this.peraGraphService = peraGraphService;
        this.sortService = sortService;
        this.groupService = groupService;
        this.ref = ref;
        // collects all the peraGraphs from their input sources combines them, filters them, and then passes them onto the groups
        this.filteredPeraGraphs$ = new BehaviorSubject([]);
    }
    /**
     * @return {?}
     */
    ArrayViewComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.numGroupsDisplay = this.groupService.changeNumberOfGroupsToShow$;
        this.expandedSubject$ = this.groupService.expandGroups$;
        this.groups$ = this.groupService.groupSubject$;
        // Load the configuration for the array view and subscribe to the PeraGraphs and Flowsheet services.
        this.arrayViewConfigService.configurationLoaded$.pipe(filter(function (isReady) { return isReady; }), first()).subscribe(function () { return _this.initializeArrayView(); });
        this.updateBehaviorBasedOnInputs();
    };
    /**
     * @return {?}
     */
    ArrayViewComponent.prototype.initializeArrayView = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // Once we have the configuration, we can get the rest of the information that we need
        this.arrayViewService.calcCurrentTimestamp();
        // get all Peragraphs on an interval and push them into the peraGraphSubject to be filtered
        this.peraGraphSubscription = this.peragraphApiService.getPeraGraphInterval().subscribe(function (peraGraphs) {
            _this.peragraphApiService.getPeraGraphSubject().next(peraGraphs);
        });
        // uses combineLatest to update the array view when either new graphs are added (peraGraph Subject - sourced by peraGraphInterval and manual graph refreshes) or new filters are added (filterSubject)
        // and then filters before pushing to groups
        this.filteredPeraGraphsSubscription = combineLatest(this.peragraphApiService.getPeraGraphSubject(), this.filterService.filterSubject$).pipe(map(function (peraGraphsAndFilters) { return peraGraphsAndFilters[0].filter(function (peraGraph) {
            return _this.arrayViewService.filterPeragraph(peraGraph, _this.filterService.activeFilters);
        }); }), mergeMap(function (peraGraphs) { return _this.arrayViewService.addRIToPeraGraphs(peraGraphs); }), map(function (peraGraphs) { return peraGraphs.sort(function (peraGraphA, peraGraphB) { return _this.arrayViewService.sortGraphs(peraGraphA, peraGraphB, _this.sortService.activeSortFunction); }); }), tap(function (peraGraphs) {
            // if this iteration of the filtered graphs subject was triggered by the apply filters button
            // then recalculate and close the proper groups
            // if generated by refresh button or interval, don't reset the closed groups
            /** @type {?} */
            var groupDisplay = _this.arrayViewService.calculateNumberOfGroupsToShow(peraGraphs);
            if (_this.groupService.changeGroupsClosed) {
                _this.groupService.changeNumberOfGroupsToShow$.next(groupDisplay.groupsToShow);
                _this.groupService.changeGroupsClosed = false;
            }
            _this.groupService.expandGroups$.next(groupDisplay.expanded);
        })).subscribe(function (peraGraphs) {
            // Assign an index to the anonymous property of the PeraGraph - used by the Anonymous Patient chart title.
            /** @type {?} */
            var anonymousIndex = 1;
            peraGraphs.forEach(function (graph) {
                graph.anonymous = anonymousIndex;
                anonymousIndex++;
            });
            _this.filteredPeraGraphs$.next(peraGraphs);
            _this.arrayViewService.completedRefresh$.next();
            // Push the new Chart title selection through the Subject.
            _this.arrayViewService.chartTitleSubject$.next(_this.arrayViewService.selectedChartTitle);
        });
        // Whenever we get new FSCs (on an interval) push them out through the subject so the groups receive the updated map of FSCs
        this.flowSheetSubscription = this.flowsheetsApiService.getFlowSheetInterval().subscribe(function (flowsheets) { return _this.flowsheetsApiService.getFlowSheetSubject().next(flowsheets.body); });
        // Whenever we get new prior warnings (on an interval) push them out through the subject so the groups receive the updated map of warnings
        if (this.priorWarningsConfigService.getPriorWarningEndPoint()) {
            this.priorWarningSubscription = this.priorWarningsApiService.getPriorWarningInterval().subscribe(function (priorWarnings) { return _this.priorWarningsApiService.getPriorWarningSubject().next(priorWarnings.body); });
        }
    };
    /**
     * @return {?}
     */
    ArrayViewComponent.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
        if (this.scrollContainerWidth !== this.getScrollContainerWidth()) {
            this.scrollContainerWidth = this.getScrollContainerWidth();
            if (this.ref) {
                this.ref.detectChanges();
            }
        }
    };
    /**
     * Used to dynamically set the width of the scroll container (based on the width of the array view component)
     */
    /**
     * Used to dynamically set the width of the scroll container (based on the width of the array view component)
     * @return {?}
     */
    ArrayViewComponent.prototype.getScrollContainerWidth = /**
     * Used to dynamically set the width of the scroll container (based on the width of the array view component)
     * @return {?}
     */
    function () {
        /** @type {?} */
        var width = this.arrayViewElementRef.nativeElement.offsetWidth;
        // Ensure that the container has padding
        /** @type {?} */
        var padding = width * .11;
        // Get the number of graphs that we should be able to display in the window (taking the padding into account)
        /** @type {?} */
        var numGraphsInRow = Math.floor((width - padding) / this.arrayViewService.peraGraphWidth);
        // Return the width
        return numGraphsInRow * this.arrayViewService.peraGraphWidth + 'px';
    };
    /**
     * @return {?}
     */
    ArrayViewComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        this.updateBehaviorBasedOnInputs();
        // TODO update this when we add the ability to change the title/grouping/sorting
    };
    /**
     * Updates the fields in the array view service and in this component based on the input so that we see the desired behavior
     */
    /**
     * Updates the fields in the array view service and in this component based on the input so that we see the desired behavior
     * @private
     * @return {?}
     */
    ArrayViewComponent.prototype.updateBehaviorBasedOnInputs = /**
     * Updates the fields in the array view service and in this component based on the input so that we see the desired behavior
     * @private
     * @return {?}
     */
    function () {
        this.disableGroupsIfAppropriate();
        this.setPeraGraphSortingFunction();
        this.updatePeraGraphDimensions();
    };
    /**
     * If we pass in an explicit width/height, use them
     */
    /**
     * If we pass in an explicit width/height, use them
     * @private
     * @return {?}
     */
    ArrayViewComponent.prototype.updatePeraGraphDimensions = /**
     * If we pass in an explicit width/height, use them
     * @private
     * @return {?}
     */
    function () {
        if (this.peraGraphHeight && this.peraGraphWidth) {
            this.arrayViewService.peraGraphWidth = this.peraGraphWidth;
            this.arrayViewService.peraGraphHeight = this.peraGraphHeight;
            this.arrayViewService.refreshViewPort();
        }
    };
    /**
     * This sets the array view service's sorting function to the input passed to the array view component
     */
    /**
     * This sets the array view service's sorting function to the input passed to the array view component
     * @private
     * @return {?}
     */
    ArrayViewComponent.prototype.setPeraGraphSortingFunction = /**
     * This sets the array view service's sorting function to the input passed to the array view component
     * @private
     * @return {?}
     */
    function () {
        if (this.peraGraphSortingFunction) {
            this.arrayViewService.sortGraphs = this.peraGraphSortingFunction;
        }
    };
    /**
     * If groups are disabled or absent, add a single group that will catch all graphs and not display a header
     */
    /**
     * If groups are disabled or absent, add a single group that will catch all graphs and not display a header
     * @private
     * @return {?}
     */
    ArrayViewComponent.prototype.disableGroupsIfAppropriate = /**
     * If groups are disabled or absent, add a single group that will catch all graphs and not display a header
     * @private
     * @return {?}
     */
    function () {
        // If groups are disabled or if we don't have groups
        if (this.disableGroups || this.groups$ == null) {
            this.groups$ = of([[null, function (peraGraph) {
                        return true;
                    }]]);
        }
    };
    // not sure if this is needed since we are using combinedLatest above but I left it just in case
    // public filterChanged() {
    //   // Get the current list of PeraGraphs without making another call
    //   let peraGraphs = this.peragraphApiService.getPeraGraphSubject().value;
    //   // Filter the list according to the updated matchesFilter function within the arrayView service
    //   peraGraphs = this.arrayViewService.filterPeragraphs(peraGraphs, this.filterService.activeFilters)
    //   // Publish result to all subscribing groups
    //   this.peragraphApiService.getPeraGraphSubject().next(peraGraphs);
    // }
    // not sure if this is needed since we are using combinedLatest above but I left it just in case
    // public filterChanged() {
    //   // Get the current list of PeraGraphs without making another call
    //   let peraGraphs = this.peragraphApiService.getPeraGraphSubject().value;
    //   // Filter the list according to the updated matchesFilter function within the arrayView service
    //   peraGraphs = this.arrayViewService.filterPeragraphs(peraGraphs, this.filterService.activeFilters)
    //   // Publish result to all subscribing groups
    //   this.peragraphApiService.getPeraGraphSubject().next(peraGraphs);
    // }
    /**
     * @return {?}
     */
    ArrayViewComponent.prototype.ngOnDestroy = 
    // not sure if this is needed since we are using combinedLatest above but I left it just in case
    // public filterChanged() {
    //   // Get the current list of PeraGraphs without making another call
    //   let peraGraphs = this.peragraphApiService.getPeraGraphSubject().value;
    //   // Filter the list according to the updated matchesFilter function within the arrayView service
    //   peraGraphs = this.arrayViewService.filterPeragraphs(peraGraphs, this.filterService.activeFilters)
    //   // Publish result to all subscribing groups
    //   this.peragraphApiService.getPeraGraphSubject().next(peraGraphs);
    // }
    /**
     * @return {?}
     */
    function () {
        if (this.ref) {
            this.ref.detach();
            this.ref = null;
        }
        if (this.peraGraphSubscription && !this.peraGraphSubscription.closed) {
            this.peraGraphSubscription.unsubscribe();
        }
        if (this.flowSheetSubscription && !this.flowSheetSubscription.closed) {
            this.flowSheetSubscription.unsubscribe();
        }
        if (this.priorWarningSubscription && !this.priorWarningSubscription.closed) {
            this.priorWarningSubscription.unsubscribe();
        }
        if (this.filteredPeraGraphsSubscription && !this.filteredPeraGraphs$.closed) {
            this.filteredPeraGraphsSubscription.unsubscribe();
        }
    };
    ArrayViewComponent.decorators = [
        { type: Component, args: [{
                    selector: 'phlib-array-view',
                    template: "<div class=\"array-view\" #arrayView>\n    <!--<button class=\"btn btn-outline-success my-2 my-sm-0\" (click)=\"arrayViewService.toggleTileView()\">Tile View</button>-->\n    <phlib-group *ngFor=\"let group of groups$ | async; let i = index\"\n                 [showPeraGraphs]=\"i < numGroupsDisplay.value\"\n                 [expanded]=\"expandedSubject$.value\"\n                 [group]=\"group\" [peraGraphWidth]=\"arrayViewService.peraGraphWidth\"\n                 [peraGraphHeight]=\"arrayViewService.peraGraphHeight\" [scrollContainerWidth]=\"scrollContainerWidth\"\n                 [filteredPeraGraphs$]=\"filteredPeraGraphs$\"\n    ></phlib-group>\n</div>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ArrayViewComponent.ctorParameters = function () { return [
        { type: ArrayViewService },
        { type: ArrayViewConfigService },
        { type: PeragraphApiService },
        { type: FilterService },
        { type: FlowsheetsApiService },
        { type: PriorWarningsConfigService },
        { type: PriorWarningsApiService },
        { type: PeraGraphService },
        { type: SortService },
        { type: GroupService },
        { type: ChangeDetectorRef }
    ]; };
    ArrayViewComponent.propDecorators = {
        peraGraphSortingFunction: [{ type: Input }],
        peraGraphTitleFunction: [{ type: Input }],
        disableGroups: [{ type: Input }],
        numGroupsDisplay: [{ type: Input }],
        peraGraphHeight: [{ type: Input }],
        peraGraphWidth: [{ type: Input }],
        arrayViewElementRef: [{ type: ViewChild, args: ['arrayView',] }]
    };
    return ArrayViewComponent;
}());
export { ArrayViewComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.peraGraphSubscription;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.flowSheetSubscription;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.priorWarningSubscription;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.filteredPeraGraphsSubscription;
    /** @type {?} */
    ArrayViewComponent.prototype.filteredPeraGraphs$;
    /** @type {?} */
    ArrayViewComponent.prototype.peraGraphSortingFunction;
    /** @type {?} */
    ArrayViewComponent.prototype.peraGraphTitleFunction;
    /** @type {?} */
    ArrayViewComponent.prototype.groups$;
    /** @type {?} */
    ArrayViewComponent.prototype.disableGroups;
    /** @type {?} */
    ArrayViewComponent.prototype.numGroupsDisplay;
    /** @type {?} */
    ArrayViewComponent.prototype.peraGraphHeight;
    /** @type {?} */
    ArrayViewComponent.prototype.peraGraphWidth;
    /** @type {?} */
    ArrayViewComponent.prototype.arrayViewElementRef;
    /** @type {?} */
    ArrayViewComponent.prototype.scrollContainerWidth;
    /** @type {?} */
    ArrayViewComponent.prototype.expandedSubject$;
    /** @type {?} */
    ArrayViewComponent.prototype.arrayViewService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.arrayViewConfigService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.peragraphApiService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.flowsheetsApiService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.priorWarningsConfigService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.priorWarningsApiService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.peraGraphService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.sortService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.groupService;
    /**
     * @type {?}
     * @private
     */
    ArrayViewComponent.prototype.ref;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJyYXktdmlldy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1hcnJheS12aWV3LWxpYnJhcnkvIiwic291cmNlcyI6WyJsaWIvYXJyYXktdmlldy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFFSCxpQkFBaUIsRUFDakIsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBSUwsU0FBUyxFQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQzlELE9BQU8sRUFBQyxlQUFlLEVBQUUsYUFBYSxFQUFFLEVBQUUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUN4RCxPQUFPLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLCtDQUErQyxDQUFDO0FBQy9FLE9BQU8sRUFBQyxzQkFBc0IsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBRTNFLE9BQU8sRUFBQywwQkFBMEIsRUFBQyxNQUFNLCtEQUErRCxDQUFDO0FBQ3pHLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLHlEQUF5RCxDQUFDO0FBQ2hHLE9BQU8sRUFBQyxvQkFBb0IsRUFBRSxtQkFBbUIsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQzVFLE9BQU8sRUFBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBQyxNQUFNLG9CQUFvQixDQUFDO0FBRTVFO0lBMENJLDRCQUFtQixnQkFBa0MsRUFDakMsc0JBQThDLEVBQzlDLG1CQUF3QyxFQUN4QyxhQUE0QixFQUM1QixvQkFBMEMsRUFDMUMsMEJBQXNELEVBQ3RELHVCQUFnRCxFQUNoRCxnQkFBa0MsRUFDbEMsV0FBd0IsRUFDeEIsWUFBMEIsRUFDMUIsR0FBc0I7UUFWdkIscUJBQWdCLEdBQWhC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TCxLQUFLO2tDQUdMLEtBQUs7aUNBR0wsS0FBSztzQ0FHTCxTQUFTLFNBQUMsV0FBVzs7SUFvTDFCLHlCQUFDO0NBQUEsQUF2TkQsSUF1TkM7U0FsTlksa0JBQWtCOzs7Ozs7SUFFM0IsbURBQThCOzs7OztJQUM5QixtREFBOEI7Ozs7O0lBQzlCLHNEQUFpQzs7Ozs7SUFDakMsNERBQXVDOztJQUd2QyxpREFBMkQ7O0lBRTNELHNEQUNvRjs7SUFFcEYsb0RBQ3FEOztJQUVyRCxxQ0FBUTs7SUFFUiwyQ0FDdUI7O0lBRXZCLDhDQUMwQzs7SUFFMUMsNkNBQ3dCOztJQUV4Qiw0Q0FDdUI7O0lBRXZCLGlEQUNnQzs7SUFFaEMsa0RBQTZCOztJQUU3Qiw4Q0FBMkM7O0lBRS9CLDhDQUF5Qzs7Ozs7SUFDekMsb0RBQXNEOzs7OztJQUN0RCxpREFBZ0Q7Ozs7O0lBQ2hELDJDQUFvQzs7Ozs7SUFDcEMsa0RBQWtEOzs7OztJQUNsRCx3REFBOEQ7Ozs7O0lBQzlELHFEQUF3RDs7Ozs7SUFDeEQsOENBQTBDOzs7OztJQUMxQyx5Q0FBZ0M7Ozs7O0lBQ2hDLDBDQUFrQzs7Ozs7SUFDbEMsaUNBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBBZnRlclZpZXdDaGVja2VkLFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBFbGVtZW50UmVmLFxuICAgIElucHV0LFxuICAgIE9uQ2hhbmdlcyxcbiAgICBPbkRlc3Ryb3ksXG4gICAgT25Jbml0LFxuICAgIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QXJyYXlWaWV3U2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlL2FycmF5LXZpZXcuc2VydmljZSc7XG5pbXBvcnQge0JlaGF2aW9yU3ViamVjdCwgY29tYmluZUxhdGVzdCwgb2Z9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtmaWx0ZXIsIGZpcnN0LCBtYXAsIG1lcmdlTWFwLCB0YXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7UGVyYUdyYXBoU2VydmljZX0gZnJvbSAnLi9ncm91cC9wZXJhLWdyYXBoL3NlcnZpY2UvcGVyYS1ncmFwaC5zZXJ2aWNlJztcbmltcG9ydCB7QXJyYXlWaWV3Q29uZmlnU2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlL2FycmF5LXZpZXctY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHtQZXJhR3JhcGh9IGZyb20gJ25nLWNvbW1vbi1saWJyYXJ5L2xpYi9tb2RlbC9QZXJhR3JhcGgnO1xuaW1wb3J0IHtQcmlvcldhcm5pbmdzQ29uZmlnU2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlL3ByaW9yLXdhcm5pbmdzL2NvbmZpZy9wcmlvci13YXJuaW5ncy1jb25maWcuc2VydmljZSc7XG5pbXBvcnQge1ByaW9yV2FybmluZ3NBcGlTZXJ2aWNlfSBmcm9tICcuL3NlcnZpY2UvcHJpb3Itd2FybmluZ3MvYXBpL3ByaW9yLXdhcm5pbmdzLWFwaS5zZXJ2aWNlJztcbmltcG9ydCB7Rmxvd3NoZWV0c0FwaVNlcnZpY2UsIFBlcmFncmFwaEFwaVNlcnZpY2V9IGZyb20gJ25nLWNvbW1vbi1saWJyYXJ5JztcbmltcG9ydCB7RmlsdGVyU2VydmljZSwgU29ydFNlcnZpY2UsIEdyb3VwU2VydmljZX0gZnJvbSAnbmctZmlsdGVycy1saWJyYXJ5JztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdwaGxpYi1hcnJheS12aWV3JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYXJyYXktdmlldy5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vYXJyYXktdmlldy5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQXJyYXlWaWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3Q2hlY2tlZCB7XG5cbiAgICBwcml2YXRlIHBlcmFHcmFwaFN1YnNjcmlwdGlvbjtcbiAgICBwcml2YXRlIGZsb3dTaGVldFN1YnNjcmlwdGlvbjtcbiAgICBwcml2YXRlIHByaW9yV2FybmluZ1N1YnNjcmlwdGlvbjtcbiAgICBwcml2YXRlIGZpbHRlcmVkUGVyYUdyYXBoc1N1YnNjcmlwdGlvbjtcblxuICAgIC8vIGNvbGxlY3RzIGFsbCB0aGUgcGVyYUdyYXBocyBmcm9tIHRoZWlyIGlucHV0IHNvdXJjZXMgY29tYmluZXMgdGhlbSwgZmlsdGVycyB0aGVtLCBhbmQgdGhlbiBwYXNzZXMgdGhlbSBvbnRvIHRoZSBncm91cHNcbiAgICBmaWx0ZXJlZFBlcmFHcmFwaHMkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxQZXJhR3JhcGhbXT4oW10pO1xuXG4gICAgQElucHV0KClcbiAgICBwZXJhR3JhcGhTb3J0aW5nRnVuY3Rpb246IChmaXJzdEdyYXBoOiBQZXJhR3JhcGgsIHNlY29uZEdyYXBoOiBQZXJhR3JhcGgpID0+IG51bWJlcjtcblxuICAgIEBJbnB1dCgpXG4gICAgcGVyYUdyYXBoVGl0bGVGdW5jdGlvbjogKGdyYXBoOiBQZXJhR3JhcGgpID0+IHN0cmluZztcblxuICAgIGdyb3VwcyQ7XG5cbiAgICBASW5wdXQoKVxuICAgIGRpc2FibGVHcm91cHM6IGJvb2xlYW47XG5cbiAgICBASW5wdXQoKVxuICAgIG51bUdyb3Vwc0Rpc3BsYXk6IEJlaGF2aW9yU3ViamVjdDxudW1iZXI+O1xuXG4gICAgQElucHV0KClcbiAgICBwZXJhR3JhcGhIZWlnaHQ6IG51bWJlcjtcblxuICAgIEBJbnB1dCgpXG4gICAgcGVyYUdyYXBoV2lkdGg6IG51bWJlcjtcblxuICAgIEBWaWV3Q2hpbGQoJ2FycmF5VmlldycpXG4gICAgYXJyYXlWaWV3RWxlbWVudFJlZjogRWxlbWVudFJlZjtcblxuICAgIHNjcm9sbENvbnRhaW5lcldpZHRoOiBzdHJpbmc7XG5cbiAgICBleHBhbmRlZFN1YmplY3QkOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj47XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgYXJyYXlWaWV3U2VydmljZTogQXJyYXlWaWV3U2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFycmF5Vmlld0NvbmZpZ1NlcnZpY2U6IEFycmF5Vmlld0NvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBwZXJhZ3JhcGhBcGlTZXJ2aWNlOiBQZXJhZ3JhcGhBcGlTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZmlsdGVyU2VydmljZTogRmlsdGVyU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGZsb3dzaGVldHNBcGlTZXJ2aWNlOiBGbG93c2hlZXRzQXBpU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHByaW9yV2FybmluZ3NDb25maWdTZXJ2aWNlOiBQcmlvcldhcm5pbmdzQ29uZmlnU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHByaW9yV2FybmluZ3NBcGlTZXJ2aWNlOiBQcmlvcldhcm5pbmdzQXBpU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHBlcmFHcmFwaFNlcnZpY2U6IFBlcmFHcmFwaFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBzb3J0U2VydmljZTogU29ydFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBncm91cFNlcnZpY2U6IEdyb3VwU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5udW1Hcm91cHNEaXNwbGF5ID0gdGhpcy5ncm91cFNlcnZpY2UuY2hhbmdlTnVtYmVyT2ZHcm91cHNUb1Nob3ckO1xuICAgICAgICB0aGlzLmV4cGFuZGVkU3ViamVjdCQgPSB0aGlzLmdyb3VwU2VydmljZS5leHBhbmRHcm91cHMkO1xuICAgICAgICB0aGlzLmdyb3VwcyQgPSB0aGlzLmdyb3VwU2VydmljZS5ncm91cFN1YmplY3QkO1xuICAgICAgICAvLyBMb2FkIHRoZSBjb25maWd1cmF0aW9uIGZvciB0aGUgYXJyYXkgdmlldyBhbmQgc3Vic2NyaWJlIHRvIHRoZSBQZXJhR3JhcGhzIGFuZCBGbG93c2hlZXQgc2VydmljZXMuXG4gICAgICAgIHRoaXMuYXJyYXlWaWV3Q29uZmlnU2VydmljZS5jb25maWd1cmF0aW9uTG9hZGVkJC5waXBlKGZpbHRlcigoaXNSZWFkeTogYm9vbGVhbikgPT4gaXNSZWFkeSksIGZpcnN0KCkpLnN1YnNjcmliZSgoKSA9PiB0aGlzLmluaXRpYWxpemVBcnJheVZpZXcoKSk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVCZWhhdmlvckJhc2VkT25JbnB1dHMoKTtcbiAgICB9XG5cbiAgICBpbml0aWFsaXplQXJyYXlWaWV3KCkge1xuXG4gICAgICAgIC8vIE9uY2Ugd2UgaGF2ZSB0aGUgY29uZmlndXJhdGlvbiwgd2UgY2FuIGdldCB0aGUgcmVzdCBvZiB0aGUgaW5mb3JtYXRpb24gdGhhdCB3ZSBuZWVkXG4gICAgICAgIHRoaXMuYXJyYXlWaWV3U2VydmljZS5jYWxjQ3VycmVudFRpbWVzdGFtcCgpO1xuXG4gICAgICAgIC8vIGdldCBhbGwgUGVyYWdyYXBocyBvbiBhbiBpbnRlcnZhbCBhbmQgcHVzaCB0aGVtIGludG8gdGhlIHBlcmFHcmFwaFN1YmplY3QgdG8gYmUgZmlsdGVyZWRcbiAgICAgICAgdGhpcy5wZXJhR3JhcGhTdWJzY3JpcHRpb24gPSB0aGlzLnBlcmFncmFwaEFwaVNlcnZpY2UuZ2V0UGVyYUdyYXBoSW50ZXJ2YWwoKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICBwZXJhR3JhcGhzID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBlcmFncmFwaEFwaVNlcnZpY2UuZ2V0UGVyYUdyYXBoU3ViamVjdCgpLm5leHQocGVyYUdyYXBocyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gdXNlcyBjb21iaW5lTGF0ZXN0IHRvIHVwZGF0ZSB0aGUgYXJyYXkgdmlldyB3aGVuIGVpdGhlciBuZXcgZ3JhcGhzIGFyZSBhZGRlZCAocGVyYUdyYXBoIFN1YmplY3QgLSBzb3VyY2VkIGJ5IHBlcmFHcmFwaEludGVydmFsIGFuZCBtYW51YWwgZ3JhcGggcmVmcmVzaGVzKSBvciBuZXcgZmlsdGVycyBhcmUgYWRkZWQgKGZpbHRlclN1YmplY3QpXG4gICAgICAgIC8vIGFuZCB0aGVuIGZpbHRlcnMgYmVmb3JlIHB1c2hpbmcgdG8gZ3JvdXBzXG4gICAgICAgIHRoaXMuZmlsdGVyZWRQZXJhR3JhcGhzU3Vic2NyaXB0aW9uID0gY29tYmluZUxhdGVzdCh0aGlzLnBlcmFncmFwaEFwaVNlcnZpY2UuZ2V0UGVyYUdyYXBoU3ViamVjdCgpLCB0aGlzLmZpbHRlclNlcnZpY2UuZmlsdGVyU3ViamVjdCQpLnBpcGUoXG4gICAgICAgICAgICBtYXAoKHBlcmFHcmFwaHNBbmRGaWx0ZXJzKSA9PiBwZXJhR3JhcGhzQW5kRmlsdGVyc1swXS5maWx0ZXIocGVyYUdyYXBoID0+XG4gICAgICAgICAgICB0aGlzLmFycmF5Vmlld1NlcnZpY2UuZmlsdGVyUGVyYWdyYXBoKHBlcmFHcmFwaCwgdGhpcy5maWx0ZXJTZXJ2aWNlLmFjdGl2ZUZpbHRlcnMpKVxuICAgICAgICApLCBtZXJnZU1hcCgocGVyYUdyYXBocykgPT4gdGhpcy5hcnJheVZpZXdTZXJ2aWNlLmFkZFJJVG9QZXJhR3JhcGhzKHBlcmFHcmFwaHMpXG4gICAgICAgICksIG1hcCgocGVyYUdyYXBoczogUGVyYUdyYXBoW10pID0+IHBlcmFHcmFwaHMuc29ydCgocGVyYUdyYXBoQTogUGVyYUdyYXBoLCBwZXJhR3JhcGhCOiBQZXJhR3JhcGgpID0+IHRoaXMuYXJyYXlWaWV3U2VydmljZS5zb3J0R3JhcGhzKHBlcmFHcmFwaEEsIHBlcmFHcmFwaEIsIHRoaXMuc29ydFNlcnZpY2UuYWN0aXZlU29ydEZ1bmN0aW9uKVxuICAgICAgICApKSwgdGFwKChwZXJhR3JhcGhzOiBQZXJhR3JhcGhbXSkgPT4ge1xuICAgICAgICAgICAgLy8gaWYgdGhpcyBpdGVyYXRpb24gb2YgdGhlIGZpbHRlcmVkIGdyYXBocyBzdWJqZWN0IHdhcyB0cmlnZ2VyZWQgYnkgdGhlIGFwcGx5IGZpbHRlcnMgYnV0dG9uXG4gICAgICAgICAgICAvLyB0aGVuIHJlY2FsY3VsYXRlIGFuZCBjbG9zZSB0aGUgcHJvcGVyIGdyb3Vwc1xuICAgICAgICAgICAgLy8gaWYgZ2VuZXJhdGVkIGJ5IHJlZnJlc2ggYnV0dG9uIG9yIGludGVydmFsLCBkb24ndCByZXNldCB0aGUgY2xvc2VkIGdyb3Vwc1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBEaXNwbGF5OiB7Z3JvdXBzVG9TaG93OiBudW1iZXIsIGV4cGFuZGVkOiBib29sZWFufSA9IHRoaXMuYXJyYXlWaWV3U2VydmljZS5jYWxjdWxhdGVOdW1iZXJPZkdyb3Vwc1RvU2hvdyhwZXJhR3JhcGhzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmdyb3VwU2VydmljZS5jaGFuZ2VHcm91cHNDbG9zZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3VwU2VydmljZS5jaGFuZ2VOdW1iZXJPZkdyb3Vwc1RvU2hvdyQubmV4dChncm91cERpc3BsYXkuZ3JvdXBzVG9TaG93KTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3VwU2VydmljZS5jaGFuZ2VHcm91cHNDbG9zZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBTZXJ2aWNlLmV4cGFuZEdyb3VwcyQubmV4dChncm91cERpc3BsYXkuZXhwYW5kZWQpO1xuICAgICAgICB9KSkuc3Vic2NyaWJlKChwZXJhR3JhcGhzOiBQZXJhR3JhcGhbXSkgPT4ge1xuICAgICAgICAgICAgLy8gQXNzaWduIGFuIGluZGV4IHRvIHRoZSBhbm9ueW1vdXMgcHJvcGVydHkgb2YgdGhlIFBlcmFHcmFwaCAtIHVzZWQgYnkgdGhlIEFub255bW91cyBQYXRpZW50IGNoYXJ0IHRpdGxlLlxuICAgICAgICAgICAgbGV0IGFub255bW91c0luZGV4ID0gMTtcbiAgICAgICAgICAgIHBlcmFHcmFwaHMuZm9yRWFjaChncmFwaCA9PiB7XG4gICAgICAgICAgICAgICAgZ3JhcGguYW5vbnltb3VzID0gYW5vbnltb3VzSW5kZXg7XG4gICAgICAgICAgICAgICAgYW5vbnltb3VzSW5kZXgrKztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFBlcmFHcmFwaHMkLm5leHQocGVyYUdyYXBocyk7XG4gICAgICAgICAgICB0aGlzLmFycmF5Vmlld1NlcnZpY2UuY29tcGxldGVkUmVmcmVzaCQubmV4dCgpO1xuXG4gICAgICAgICAgICAvLyBQdXNoIHRoZSBuZXcgQ2hhcnQgdGl0bGUgc2VsZWN0aW9uIHRocm91Z2ggdGhlIFN1YmplY3QuXG4gICAgICAgICAgICB0aGlzLmFycmF5Vmlld1NlcnZpY2UuY2hhcnRUaXRsZVN1YmplY3QkLm5leHQodGhpcy5hcnJheVZpZXdTZXJ2aWNlLnNlbGVjdGVkQ2hhcnRUaXRsZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdoZW5ldmVyIHdlIGdldCBuZXcgRlNDcyAob24gYW4gaW50ZXJ2YWwpIHB1c2ggdGhlbSBvdXQgdGhyb3VnaCB0aGUgc3ViamVjdCBzbyB0aGUgZ3JvdXBzIHJlY2VpdmUgdGhlIHVwZGF0ZWQgbWFwIG9mIEZTQ3NcbiAgICAgICAgdGhpcy5mbG93U2hlZXRTdWJzY3JpcHRpb24gPSB0aGlzLmZsb3dzaGVldHNBcGlTZXJ2aWNlLmdldEZsb3dTaGVldEludGVydmFsKCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgZmxvd3NoZWV0cyA9PiB0aGlzLmZsb3dzaGVldHNBcGlTZXJ2aWNlLmdldEZsb3dTaGVldFN1YmplY3QoKS5uZXh0KGZsb3dzaGVldHMuYm9keSkpO1xuXG4gICAgICAgIC8vIFdoZW5ldmVyIHdlIGdldCBuZXcgcHJpb3Igd2FybmluZ3MgKG9uIGFuIGludGVydmFsKSBwdXNoIHRoZW0gb3V0IHRocm91Z2ggdGhlIHN1YmplY3Qgc28gdGhlIGdyb3VwcyByZWNlaXZlIHRoZSB1cGRhdGVkIG1hcCBvZiB3YXJuaW5nc1xuICAgICAgICBpZiAodGhpcy5wcmlvcldhcm5pbmdzQ29uZmlnU2VydmljZS5nZXRQcmlvcldhcm5pbmdFbmRQb2ludCgpKSB7XG4gICAgICAgICAgICB0aGlzLnByaW9yV2FybmluZ1N1YnNjcmlwdGlvbiA9IHRoaXMucHJpb3JXYXJuaW5nc0FwaVNlcnZpY2UuZ2V0UHJpb3JXYXJuaW5nSW50ZXJ2YWwoKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgcHJpb3JXYXJuaW5ncyA9PiB0aGlzLnByaW9yV2FybmluZ3NBcGlTZXJ2aWNlLmdldFByaW9yV2FybmluZ1N1YmplY3QoKS5uZXh0KHByaW9yV2FybmluZ3MuYm9keSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdDaGVja2VkKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zY3JvbGxDb250YWluZXJXaWR0aCAhPT0gdGhpcy5nZXRTY3JvbGxDb250YWluZXJXaWR0aCgpKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbENvbnRhaW5lcldpZHRoID0gdGhpcy5nZXRTY3JvbGxDb250YWluZXJXaWR0aCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMucmVmKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNlZCB0byBkeW5hbWljYWxseSBzZXQgdGhlIHdpZHRoIG9mIHRoZSBzY3JvbGwgY29udGFpbmVyIChiYXNlZCBvbiB0aGUgd2lkdGggb2YgdGhlIGFycmF5IHZpZXcgY29tcG9uZW50KVxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRTY3JvbGxDb250YWluZXJXaWR0aCgpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuYXJyYXlWaWV3RWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgICAvLyBFbnN1cmUgdGhhdCB0aGUgY29udGFpbmVyIGhhcyBwYWRkaW5nXG4gICAgICAgIGNvbnN0IHBhZGRpbmcgPSB3aWR0aCAqIC4xMTtcbiAgICAgICAgLy8gR2V0IHRoZSBudW1iZXIgb2YgZ3JhcGhzIHRoYXQgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZGlzcGxheSBpbiB0aGUgd2luZG93ICh0YWtpbmcgdGhlIHBhZGRpbmcgaW50byBhY2NvdW50KVxuICAgICAgICBjb25zdCBudW1HcmFwaHNJblJvdyA9IE1hdGguZmxvb3IoKHdpZHRoIC0gcGFkZGluZykgLyB0aGlzLmFycmF5Vmlld1NlcnZpY2UucGVyYUdyYXBoV2lkdGgpO1xuICAgICAgICAvLyBSZXR1cm4gdGhlIHdpZHRoXG4gICAgICAgIHJldHVybiBudW1HcmFwaHNJblJvdyAqIHRoaXMuYXJyYXlWaWV3U2VydmljZS5wZXJhR3JhcGhXaWR0aCArICdweCc7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoKSB7XG4gICAgICAgIHRoaXMudXBkYXRlQmVoYXZpb3JCYXNlZE9uSW5wdXRzKCk7XG4gICAgICAgIC8vIFRPRE8gdXBkYXRlIHRoaXMgd2hlbiB3ZSBhZGQgdGhlIGFiaWxpdHkgdG8gY2hhbmdlIHRoZSB0aXRsZS9ncm91cGluZy9zb3J0aW5nXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgZmllbGRzIGluIHRoZSBhcnJheSB2aWV3IHNlcnZpY2UgYW5kIGluIHRoaXMgY29tcG9uZW50IGJhc2VkIG9uIHRoZSBpbnB1dCBzbyB0aGF0IHdlIHNlZSB0aGUgZGVzaXJlZCBiZWhhdmlvclxuICAgICAqL1xuICAgIHByaXZhdGUgdXBkYXRlQmVoYXZpb3JCYXNlZE9uSW5wdXRzKCkge1xuICAgICAgICB0aGlzLmRpc2FibGVHcm91cHNJZkFwcHJvcHJpYXRlKCk7XG4gICAgICAgIHRoaXMuc2V0UGVyYUdyYXBoU29ydGluZ0Z1bmN0aW9uKCk7XG4gICAgICAgIHRoaXMudXBkYXRlUGVyYUdyYXBoRGltZW5zaW9ucygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIElmIHdlIHBhc3MgaW4gYW4gZXhwbGljaXQgd2lkdGgvaGVpZ2h0LCB1c2UgdGhlbVxuICAgICAqL1xuICAgIHByaXZhdGUgdXBkYXRlUGVyYUdyYXBoRGltZW5zaW9ucygpIHtcbiAgICAgICAgaWYgKHRoaXMucGVyYUdyYXBoSGVpZ2h0ICYmIHRoaXMucGVyYUdyYXBoV2lkdGgpIHtcbiAgICAgICAgICAgIHRoaXMuYXJyYXlWaWV3U2VydmljZS5wZXJhR3JhcGhXaWR0aCA9IHRoaXMucGVyYUdyYXBoV2lkdGg7XG4gICAgICAgICAgICB0aGlzLmFycmF5Vmlld1NlcnZpY2UucGVyYUdyYXBoSGVpZ2h0ID0gdGhpcy5wZXJhR3JhcGhIZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLmFycmF5Vmlld1NlcnZpY2UucmVmcmVzaFZpZXdQb3J0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIHNldHMgdGhlIGFycmF5IHZpZXcgc2VydmljZSdzIHNvcnRpbmcgZnVuY3Rpb24gdG8gdGhlIGlucHV0IHBhc3NlZCB0byB0aGUgYXJyYXkgdmlldyBjb21wb25lbnRcbiAgICAgKi9cbiAgICBwcml2YXRlIHNldFBlcmFHcmFwaFNvcnRpbmdGdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMucGVyYUdyYXBoU29ydGluZ0Z1bmN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmFycmF5Vmlld1NlcnZpY2Uuc29ydEdyYXBocyA9IHRoaXMucGVyYUdyYXBoU29ydGluZ0Z1bmN0aW9uO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgZ3JvdXBzIGFyZSBkaXNhYmxlZCBvciBhYnNlbnQsIGFkZCBhIHNpbmdsZSBncm91cCB0aGF0IHdpbGwgY2F0Y2ggYWxsIGdyYXBocyBhbmQgbm90IGRpc3BsYXkgYSBoZWFkZXJcbiAgICAgKi9cbiAgICBwcml2YXRlIGRpc2FibGVHcm91cHNJZkFwcHJvcHJpYXRlKCkge1xuICAgICAgICAvLyBJZiBncm91cHMgYXJlIGRpc2FibGVkIG9yIGlmIHdlIGRvbid0IGhhdmUgZ3JvdXBzXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVHcm91cHMgfHwgdGhpcy5ncm91cHMkID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzJCA9IG9mKFtbbnVsbCwgZnVuY3Rpb24gKHBlcmFHcmFwaDogUGVyYUdyYXBoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gbm90IHN1cmUgaWYgdGhpcyBpcyBuZWVkZWQgc2luY2Ugd2UgYXJlIHVzaW5nIGNvbWJpbmVkTGF0ZXN0IGFib3ZlIGJ1dCBJIGxlZnQgaXQganVzdCBpbiBjYXNlXG4gICAgLy8gcHVibGljIGZpbHRlckNoYW5nZWQoKSB7XG4gICAgLy8gICAvLyBHZXQgdGhlIGN1cnJlbnQgbGlzdCBvZiBQZXJhR3JhcGhzIHdpdGhvdXQgbWFraW5nIGFub3RoZXIgY2FsbFxuICAgIC8vICAgbGV0IHBlcmFHcmFwaHMgPSB0aGlzLnBlcmFncmFwaEFwaVNlcnZpY2UuZ2V0UGVyYUdyYXBoU3ViamVjdCgpLnZhbHVlO1xuICAgIC8vICAgLy8gRmlsdGVyIHRoZSBsaXN0IGFjY29yZGluZyB0byB0aGUgdXBkYXRlZCBtYXRjaGVzRmlsdGVyIGZ1bmN0aW9uIHdpdGhpbiB0aGUgYXJyYXlWaWV3IHNlcnZpY2VcbiAgICAvLyAgIHBlcmFHcmFwaHMgPSB0aGlzLmFycmF5Vmlld1NlcnZpY2UuZmlsdGVyUGVyYWdyYXBocyhwZXJhR3JhcGhzLCB0aGlzLmZpbHRlclNlcnZpY2UuYWN0aXZlRmlsdGVycylcbiAgICAvLyAgIC8vIFB1Ymxpc2ggcmVzdWx0IHRvIGFsbCBzdWJzY3JpYmluZyBncm91cHNcbiAgICAvLyAgIHRoaXMucGVyYWdyYXBoQXBpU2VydmljZS5nZXRQZXJhR3JhcGhTdWJqZWN0KCkubmV4dChwZXJhR3JhcGhzKTtcbiAgICAvLyB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMucmVmKSB7XG4gICAgICAgICAgICB0aGlzLnJlZi5kZXRhY2goKTtcbiAgICAgICAgICAgIHRoaXMucmVmID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wZXJhR3JhcGhTdWJzY3JpcHRpb24gJiYgIXRoaXMucGVyYUdyYXBoU3Vic2NyaXB0aW9uLmNsb3NlZCkge1xuICAgICAgICAgICAgdGhpcy5wZXJhR3JhcGhTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5mbG93U2hlZXRTdWJzY3JpcHRpb24gJiYgIXRoaXMuZmxvd1NoZWV0U3Vic2NyaXB0aW9uLmNsb3NlZCkge1xuICAgICAgICAgICAgdGhpcy5mbG93U2hlZXRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcmlvcldhcm5pbmdTdWJzY3JpcHRpb24gJiYgIXRoaXMucHJpb3JXYXJuaW5nU3Vic2NyaXB0aW9uLmNsb3NlZCkge1xuICAgICAgICAgICAgdGhpcy5wcmlvcldhcm5pbmdTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5maWx0ZXJlZFBlcmFHcmFwaHNTdWJzY3JpcHRpb24gJiYgIXRoaXMuZmlsdGVyZWRQZXJhR3JhcGhzJC5jbG9zZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRQZXJhR3JhcGhzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=