!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("moment"),require("@angular/common"),require("@angular/common/http"),require("rxjs/operators"),require("ng-login-library"),require("rxjs"),require("moment-timezone"),require("highcharts-angular"),require("od-virtualscroll"),require("angular-resizable-element"),require("@angular/core"),require("ng-common-library"),require("@ng-bootstrap/ng-bootstrap"),require("ng-filters-library")):"function"==typeof define&&define.amd?define("ng-array-view-library",["exports","moment","@angular/common","@angular/common/http","rxjs/operators","ng-login-library","rxjs","moment-timezone","highcharts-angular","od-virtualscroll","angular-resizable-element","@angular/core","ng-common-library","@ng-bootstrap/ng-bootstrap","ng-filters-library"],t):t(e["ng-array-view-library"]={},e.moment_,e.ng.common,e.ng.common.http,e.rxjs.operators,e.i4,e.rxjs,e.moment_$1,e.highchartsAngular,e.odVirtualscroll,e.angularResizableElement,e.ng.core,e.i4$1,e.ngBootstrap,e.i3)}(this,function(e,t,r,i,a,n,l,o,s,p,h,c,u,g,d){"use strict";var f=function(){return(f=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function m(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}var y=function(){function e(){this.configurationLoaded$=new l.BehaviorSubject(!1),this.currentTimestamp=null,this.toolTipInfoEndPoint=null}return e.prototype.getToolTipInfoEndPoint=function(){return this.toolTipInfoEndPoint||console.warn("Tooltip endpoint is not set!"),this.toolTipInfoEndPoint},e.prototype.setToolTipInfoEndPoint=function(e){this.toolTipInfoEndPoint=e},e.prototype.getCurrentTimestamp=function(){return this.currentTimestamp},e.prototype.setCurrentTimestamp=function(e){this.currentTimestamp=e},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=c.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),v="Visit Number",b="Admission Date",S="Medical Record Number",w="Patient Name",x="Room Number",G="Anonymous",I=function(){function e(e,t,r,i,n,a,o,s,p){var h=this;this.http=e,this.configService=t,this.filterService=r,this.filterQueryRestService=i,this.flowsheetsApiService=n,this.peragraphApiService=a,this.sortService=o,this.groupService=s,this.dateService=p,this.titleChoices=[{description:v,returnFunc:function(e){return e.vnm}},{description:b,returnFunc:function(e){return e&&e.timeZone&&e.admitDate?h.dateService.getDateFormat(e.timeZone,e.admitDate,"MM/DD/YY HH:mm z"):""}},{description:S,returnFunc:function(e){return e.patient.medicalRecordNumber}},{description:w,returnFunc:function(e){return e.vipIndicator?e.patient.aliasLastName+", "+e.patient.aliasFirstName:e.displayName}},{description:x,returnFunc:function(e){return e.unitId+"-"+e.room+"-"+e.bed}},{description:G,returnFunc:function(e){return"Chart "+e.anonymous}}],this.selectedChartTitle={description:w,returnFunc:function(e){return e.displayName}},this.chartTitleSubject$=new l.BehaviorSubject(this.selectedChartTitle),this.maxGraphCountPerGroup=50,this.maxGraphsInDom=150,this.currentTimestamp=null,this.displayTiles=!1,this.peraGraphDefaultHeight=145,this.peraGraphDefaultWidth=185,this.peraGraphTileDefault=75,this.peraGraphHeight=this.peraGraphDefaultHeight,this.peraGraphWidth=this.peraGraphDefaultWidth,this.startedRefresh$=new l.Subject,this.completedRefresh$=new l.Subject,this.tokenRefresh$=new l.Subject}return e.prototype.filterPeragraph=function(e,t){if(0===Object.keys(t).length&&t.constructor===Object)return!0;for(var r in t)if(t.hasOwnProperty(r)&&!t[r](e))return!1;return!0},e.prototype.calculateNumberOfGroupsToShow=function(e){var t,r,i,n,a=0,o=0,s=0;try{for(var p=m(this.groupService.groupSubject$.value),h=p.next();!h.done;h=p.next()){var c=h.value,l=0,u=!0;try{for(var g=m(e),d=g.next();!d.done;d=g.next()){var f=d.value;if(c.laneFunction(f)&&(u&&(s++,u=!1),++l>=this.maxGraphCountPerGroup))break}}catch(y){i={error:y}}finally{try{d&&!d.done&&(n=g["return"])&&n.call(g)}finally{if(i)throw i.error}}if(a++,(o+=l)>this.maxGraphsInDom){a--;break}}}catch(v){t={error:v}}finally{try{h&&!h.done&&(r=p["return"])&&r.call(p)}finally{if(t)throw t.error}}return{groupsToShow:a,expanded:s<=1}},e.prototype.addRIToPeraGraphs=function(p){return"latestRi"===this.sortService.activeSortName?this.flowsheetsApiService.getAllRiScores().pipe(a.map(function(e){var t,r,i=e.body;try{for(var n=m(p),a=n.next();!a.done;a=n.next()){var o=a.value;e.body[o.visitId]&&(o.latestRi=i[o.visitId])}}catch(s){t={error:s}}finally{try{a&&!a.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}return p})):l.of(p)},e.prototype.sortGraphs=function(e,t,r){var i,n=function(e,t){var r=0;return e.displayName>t.displayName?r=1:e.displayName<t.displayName&&(r=-1),r};return this.sortService.nonStandardSortFunctionActive&&this.sortService.nonStandardSortFunction&&(r=this.sortService.nonStandardSortFunction),r?(0==(i=r(e,t))&&(i=n(e,t)),i):n(e,t)},e.prototype.calcCurrentTimestamp=function(){this.configService.getCurrentTimestamp()&&(this.currentTimestamp=this.configService.getCurrentTimestamp())},e.prototype.getCurrentTimestamp=function(){return this.currentTimestamp?this.currentTimestamp:Date.now()},e.prototype.isDisplayingTiles=function(){return this.displayTiles},e.prototype.toggleTileView=function(){this.displayTiles=!this.displayTiles,this.peraGraphHeight=this.displayTiles?this.peraGraphTileDefault:this.peraGraphDefaultHeight,this.peraGraphWidth=this.displayTiles?this.peraGraphTileDefault:this.peraGraphDefaultWidth,this.refreshViewPort()},e.prototype.refreshViewPort=function(){var e=this,t=this.peragraphApiService.getPeraGraphSubject().value;this.peragraphApiService.getPeraGraphSubject().next([]),setTimeout(function(){e.peragraphApiService.getPeraGraphSubject().next(t)},1)},e.prototype.refreshGraphs=function(e){var t=this;this.startedRefresh$.next(),e?l.forkJoin(this.filterQueryRestService.getFilteredVisits(this.filterService.getActiveServerFilterCriteria()),this.peragraphApiService.getAllPeragraphs()).subscribe(function(e){t.peragraphApiService.getPeraGraphSubject().next(e[1]),t.filterService.serverFilteredVisits=e[0],t.filterService.filterSubject$.next(t.filterService.activeFilters),t.completedRefresh$.next()}):this.peragraphApiService.getAllPeragraphs().subscribe(function(e){t.peragraphApiService.getPeraGraphSubject().next(e)}),this.flowsheetsApiService.getAllPeraGraphFlowSheets().subscribe(function(e){return t.flowsheetsApiService.getFlowSheetSubject().next(e.body)})},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:i.HttpClient},{type:y},{type:d.FilterService},{type:d.FilterQueryRestService},{type:u.FlowsheetsApiService},{type:u.PeragraphApiService},{type:d.SortService},{type:d.GroupService},{type:u.DateService}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(i.HttpClient),c.inject(y),c.inject(d.FilterService),c.inject(d.FilterQueryRestService),c.inject(u.FlowsheetsApiService),c.inject(u.PeragraphApiService),c.inject(d.SortService),c.inject(d.GroupService),c.inject(u.DateService))},token:e,providedIn:"root"}),e}(),D="#D51C19",P="#EE834C",C="#F6CC5D",T="#3185B8",R="#AAABAC",W=function(){function e(){this.graphClicked$=new l.Subject}return e.prototype.graphClickedEvent=function(e){this.closeToolTip(),this.graphClicked$.next(e)},e.prototype.getBackgroundColorByWarningAndRi=function(e,t,r){var i;if(e&&!r)switch(e.category){case"V":i=D;break;case"H":i=P;break;case"M":i=C}else i=t&&!r?T:R;return i},e.prototype.getRiScoreToDisplay=function(e){return e?e+"":"--"},e.prototype.closeToolTip=function(){this.tooltip&&this.tooltip.isOpen&&this.tooltip.close()},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),A=function(){function e(){}return e.prototype.setPriorWarningEndPoint=function(e){this.priorWarningEndPoint=e},e.prototype.getPriorWarningEndPoint=function(){return this.priorWarningEndPoint},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),V=function(){function e(e,t){this.http=e,this.priorWarningsConfigService=t,this.pollInstance$=l.timer(0,6e4),this._priorWarningSubject=new l.BehaviorSubject(null)}return e.prototype.getPriorWarningSubjectValue=function(){return this._priorWarningSubject.value},e.prototype.getPriorWarningSubject=function(){return this._priorWarningSubject},e.prototype.getPriorWarnings=function(){return this.http.get(this.priorWarningsConfigService.getPriorWarningEndPoint(),{observe:"response"})},e.prototype.getPriorWarningInterval=function(){var e=this;return this.pollInstance$.pipe(a.switchMap(function(){return e.getPriorWarnings()}))},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:i.HttpClient},{type:A}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(i.HttpClient),c.inject(A))},token:e,providedIn:"root"}),e}(),O=function(){function e(e,t,r,i,n,a,o,s,p,h,c){this.arrayViewService=e,this.arrayViewConfigService=t,this.peragraphApiService=r,this.filterService=i,this.flowsheetsApiService=n,this.priorWarningsConfigService=a,this.priorWarningsApiService=o,this.peraGraphService=s,this.sortService=p,this.groupService=h,this.ref=c,this.filteredPeraGraphs$=new l.BehaviorSubject([])}return e.prototype.ngOnInit=function(){var e=this;this.numGroupsDisplay=this.groupService.changeNumberOfGroupsToShow$,this.expandedSubject$=this.groupService.expandGroups$,this.groups$=this.groupService.groupSubject$,this.arrayViewConfigService.configurationLoaded$.pipe(a.filter(function(e){return e}),a.first()).subscribe(function(){return e.initializeArrayView()}),this.updateBehaviorBasedOnInputs()},e.prototype.initializeArrayView=function(){var r=this;this.arrayViewService.calcCurrentTimestamp(),this.peraGraphSubscription=this.peragraphApiService.getPeraGraphInterval().subscribe(function(e){r.peragraphApiService.getPeraGraphSubject().next(e)}),this.filteredPeraGraphsSubscription=l.combineLatest(this.peragraphApiService.getPeraGraphSubject(),this.filterService.filterSubject$).pipe(a.map(function(e){return e[0].filter(function(e){return r.arrayViewService.filterPeragraph(e,r.filterService.activeFilters)})}),a.mergeMap(function(e){return r.arrayViewService.addRIToPeraGraphs(e)}),a.map(function(e){return e.sort(function(e,t){return r.arrayViewService.sortGraphs(e,t,r.sortService.activeSortFunction)})}),a.tap(function(e){var t=r.arrayViewService.calculateNumberOfGroupsToShow(e);r.groupService.changeGroupsClosed&&(r.groupService.changeNumberOfGroupsToShow$.next(t.groupsToShow),r.groupService.changeGroupsClosed=!1),r.groupService.expandGroups$.next(t.expanded)})).subscribe(function(e){var t=1;e.forEach(function(e){e.anonymous=t,t++}),r.filteredPeraGraphs$.next(e),r.arrayViewService.completedRefresh$.next(),r.arrayViewService.chartTitleSubject$.next(r.arrayViewService.selectedChartTitle)}),this.flowSheetSubscription=this.flowsheetsApiService.getFlowSheetInterval().subscribe(function(e){return r.flowsheetsApiService.getFlowSheetSubject().next(e.body)}),this.priorWarningsConfigService.getPriorWarningEndPoint()&&(this.priorWarningSubscription=this.priorWarningsApiService.getPriorWarningInterval().subscribe(function(e){return r.priorWarningsApiService.getPriorWarningSubject().next(e.body)}))},e.prototype.ngAfterViewChecked=function(){this.scrollContainerWidth!==this.getScrollContainerWidth()&&(this.scrollContainerWidth=this.getScrollContainerWidth(),this.ref&&this.ref.detectChanges())},e.prototype.getScrollContainerWidth=function(){var e=this.arrayViewElementRef.nativeElement.offsetWidth,t=.11*e;return Math.floor((e-t)/this.arrayViewService.peraGraphWidth)*this.arrayViewService.peraGraphWidth+"px"},e.prototype.ngOnChanges=function(){this.updateBehaviorBasedOnInputs()},e.prototype.updateBehaviorBasedOnInputs=function(){this.disableGroupsIfAppropriate(),this.setPeraGraphSortingFunction(),this.updatePeraGraphDimensions()},e.prototype.updatePeraGraphDimensions=function(){this.peraGraphHeight&&this.peraGraphWidth&&(this.arrayViewService.peraGraphWidth=this.peraGraphWidth,this.arrayViewService.peraGraphHeight=this.peraGraphHeight,this.arrayViewService.refreshViewPort())},e.prototype.setPeraGraphSortingFunction=function(){this.peraGraphSortingFunction&&(this.arrayViewService.sortGraphs=this.peraGraphSortingFunction)},e.prototype.disableGroupsIfAppropriate=function(){(this.disableGroups||null==this.groups$)&&(this.groups$=l.of([[null,function(e){return!0}]]))},e.prototype.ngOnDestroy=function(){this.ref&&(this.ref.detach(),this.ref=null),this.peraGraphSubscription&&!this.peraGraphSubscription.closed&&this.peraGraphSubscription.unsubscribe(),this.flowSheetSubscription&&!this.flowSheetSubscription.closed&&this.flowSheetSubscription.unsubscribe(),this.priorWarningSubscription&&!this.priorWarningSubscription.closed&&this.priorWarningSubscription.unsubscribe(),this.filteredPeraGraphsSubscription&&!this.filteredPeraGraphs$.closed&&this.filteredPeraGraphsSubscription.unsubscribe()},e.decorators=[{type:c.Component,args:[{selector:"phlib-array-view",template:'<div class="array-view" #arrayView>\n    \x3c!--<button class="btn btn-outline-success my-2 my-sm-0" (click)="arrayViewService.toggleTileView()">Tile View</button>--\x3e\n    <phlib-group *ngFor="let group of groups$ | async; let i = index"\n                 [showPeraGraphs]="i < numGroupsDisplay.value"\n                 [expanded]="expandedSubject$.value"\n                 [group]="group" [peraGraphWidth]="arrayViewService.peraGraphWidth"\n                 [peraGraphHeight]="arrayViewService.peraGraphHeight" [scrollContainerWidth]="scrollContainerWidth"\n                 [filteredPeraGraphs$]="filteredPeraGraphs$"\n    ></phlib-group>\n</div>\n',styles:[""]}]}],e.ctorParameters=function(){return[{type:I},{type:y},{type:u.PeragraphApiService},{type:d.FilterService},{type:u.FlowsheetsApiService},{type:A},{type:V},{type:W},{type:d.SortService},{type:d.GroupService},{type:c.ChangeDetectorRef}]},e.propDecorators={peraGraphSortingFunction:[{type:c.Input}],peraGraphTitleFunction:[{type:c.Input}],disableGroups:[{type:c.Input}],numGroupsDisplay:[{type:c.Input}],peraGraphHeight:[{type:c.Input}],peraGraphWidth:[{type:c.Input}],arrayViewElementRef:[{type:c.ViewChild,args:["arrayView"]}]},e}(),k=function(){function e(e,t,r,i,n,a,o){var s=this;this.arrayViewService=e,this.filterService=t,this.peraGraphService=r,this.peragraphApiService=i,this.ref=n,this.elementRef=a,this.renderer=o,this.showPeraGraphs=!1,this.expanded=!1,this.filterFunction=null,this.nonExpandedRows=3,this.expandedRows=6,this.currentNumberOfRowsDisplayed=this.nonExpandedRows,this.options$=new l.BehaviorSubject(null),this.clickTimer=0,this.preventSingleClick=!1,this.style={maxHeight:this.viewContainerMaxHeight},this.hideGroup=!1,this.equals=function(e,t){var r=s.currentPeraGraphs[t],i=s.previousPeraGraphs?s.previousPeraGraphs[e]:null;return null!=i&&null!=r&&JSON.stringify(i)===JSON.stringify(r)}}return e.prototype.ngOnInit=function(){this.groupName=this.group.laneTitle,this.filterFunction=this.group.laneFunction,this.updatePeraGraphs(),this.expanded?this.currentNumberOfRowsDisplayed=this.expandedRows:this.currentNumberOfRowsDisplayed=this.nonExpandedRows},e.prototype.ngOnChanges=function(){this.updateNumberOfItemsInViewport(),this.updateViewPortPerCurrentRows(),this.updatePeraGraphs(),this.maintainGroupLength()},e.prototype.hideOrDisplayGroup=function(){this.elementRef&&(0===this.groupLength?this.renderer.setStyle(this.elementRef.nativeElement,"display","none"):this.renderer.setStyle(this.elementRef.nativeElement,"display","block"))},e.prototype.updatePeraGraphs=function(){var t=this;this.peraGraphs$=this.filteredPeraGraphs$.pipe(a.map(function(e){return e.filter(function(e){return t.matchesGroup(e)})}),a.tap(function(e){t.previousPeraGraphs=t.currentPeraGraphs,t.currentPeraGraphs=e,t.groupLength=e.length,t.hideOrDisplayGroup()}))},e.prototype.maintainGroupLength=function(){var t=this;this.showPeraGraphs?this.peraGraphs_length$&&!this.peraGraphs_length$.closed&&this.peraGraphs_length$.unsubscribe():this.peraGraphs_length$=this.filteredPeraGraphs$.pipe(a.map(function(e){return e.filter(function(e){return t.matchesGroup(e)})})).subscribe(function(e){t.groupLength=e.length,t.hideOrDisplayGroup(),t.ref&&t.ref.detectChanges()})},e.prototype.matchesGroup=function(e){return!this.filterFunction||this.filterFunction(e)},e.prototype.onResizing=function(e){this.viewContainerMaxHeight=e.rectangle.height+"px",this.currentNumberOfRowsDisplayed=Math.ceil(e.rectangle.height/this.peraGraphHeight),this.updateViewPortPerCurrentRows()},e.prototype.click=function(){var e=this;this.preventSingleClick=!1,this.clickTimer=setTimeout(function(){e.preventSingleClick||(e.toggleShow(),e.ref&&e.ref.detectChanges())},200)},e.prototype.doubleClick=function(){clearTimeout(this.clickTimer),this.preventSingleClick=!0,this.toggleExpand()},e.prototype.updateViewPortPerCurrentRows=function(){this.expanded?this.currentNumberOfRowsDisplayed=this.expandedRows:this.currentNumberOfRowsDisplayed=this.nonExpandedRows,this.viewContainerMaxHeight=this.getViewPortHeightFromRowsAsString(this.currentNumberOfRowsDisplayed),this.setStyle(this.viewContainerMaxHeight),this.updateNumberOfItemsInViewport()},e.prototype.toggleShow=function(){this.hideGroup=!!this.showPeraGraphs&&!this.hideGroup,this.arrayViewService.tokenRefresh$.next(),this.showPeraGraphs||this.startRenderingPeraGraphs()},e.prototype.toggleExpand=function(){this.arrayViewService.tokenRefresh$.next(),this.expanded=!this.expanded,this.currentNumberOfRowsDisplayed=this.expanded?this.expandedRows:this.nonExpandedRows,this.updateViewPortPerCurrentRows(),this.showPeraGraphs&&!this.hideGroup||(this.hideGroup=!1,this.showPeraGraphs||this.startRenderingPeraGraphs())},e.prototype.startRenderingPeraGraphs=function(){this.showPeraGraphs=!0,this.updateViewPortPerCurrentRows(),this.ref&&this.ref.detectChanges()},e.prototype.updateNumberOfItemsInViewport=function(){this.options$.next({itemHeight:this.peraGraphHeight,itemWidth:this.peraGraphWidth,numAdditionalRows:this.getNumberOfRowsToRender()})},e.prototype.getNumberOfRowsToRender=function(){var e=this.arrayViewService.isDisplayingTiles()?100:2;return this.currentNumberOfRowsDisplayed+e},e.prototype.setStyle=function(e){this.style={maxHeight:e,width:this.scrollContainerWidth}},e.prototype.getViewPortHeightFromRowsAsString=function(e){return this.peraGraphHeight*e+"px"},e.prototype.ngOnDestroy=function(){this.ref&&(this.ref.detach(),this.ref=null),this.filterFunction=null},e.decorators=[{type:c.Component,args:[{selector:"phlib-group",template:'<div class="clickable-header">\n  <app-group-header\n    (click)="click()"\n    (dblclick)="doubleClick()"\n    [name]="groupName"\n    [numberOfPatients]="groupLength"\n    *ngIf="groupName"\n  ></app-group-header>\n</div>\n\n<od-virtualscroll class="ph-group" *ngIf="showPeraGraphs" [ngStyle]="style"\n                  mwlResizable [resizeEdges]="{bottom: true}"\n                  (resizing)="onResizing($event)" [resizeCursorPrecision]="8" [vsData]="peraGraphs$"\n                  [vsOptions]="options$" [vsEqualsFunc]="equals" [hidden]="hideGroup">\n  <ng-template let-peraGraph>\n    <phlib-pera-graph\n      [graph]="peraGraph"\n      [peraGraphHeight]="peraGraphHeight"\n      [peraGraphWidth]="peraGraphWidth">\n      >\n    </phlib-pera-graph>\n  </ng-template>\n</od-virtualscroll>\n',changeDetection:c.ChangeDetectionStrategy.OnPush,styles:["mwlResizable{box-sizing:border-box}.ph-group{margin-right:5vw;margin-left:5vw;overflow:auto;display:flex;justify-content:space-between}/deep/ .od-scroll-container{margin:0}.clickable-header{margin-right:8vw}"]}]}],e.ctorParameters=function(){return[{type:I},{type:d.FilterService},{type:W},{type:u.PeragraphApiService},{type:c.ChangeDetectorRef},{type:c.ElementRef},{type:c.Renderer2}]},e.propDecorators={showPeraGraphs:[{type:c.Input}],expanded:[{type:c.Input}],group:[{type:c.Input}],peraGraphHeight:[{type:c.Input}],peraGraphWidth:[{type:c.Input}],scrollContainerWidth:[{type:c.Input}],filteredPeraGraphs$:[{type:c.Input}]},e}(),j=function(){function e(e,t,r,i,n,a){this.graphService=e,this.arrayViewService=t,this.http=r,this.loginService=i,this.tokenApiService=n,this.arrayViewConfigService=a,this.toolTipInfoUpdated$=new l.Subject}return e.prototype.updateToolTipInfo=function(i){var n=this;this.tokenApiService.refreshToken(this.loginService.getCurrentUser()),this.http.get(this.arrayViewConfigService.getToolTipInfoEndPoint()+"/pid/"+i.patient.pid+"/visit/"+i.visitId).pipe(a.first()).subscribe(function(e){if(i.visitId===e.visitId){var t=e.numberOfOtherVisitsWithValidRi;if(i.numberVisitsWithValidRI=0<t?t:0,null!=e.diagnosis){var r=e.diagnosis.replace("^","");i.diagnosis=r.replace(/\^/g,", ")}n.toolTipInfoUpdated$.next(e)}})},e.decorators=[{type:c.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:W},{type:I},{type:i.HttpClient},{type:n.LoginService},{type:u.TokenApiService},{type:y}]},e.ngInjectableDef=c.defineInjectable({factory:function(){return new e(c.inject(W),c.inject(I),c.inject(i.HttpClient),c.inject(n.LoginService),c.inject(u.TokenApiService),c.inject(y))},token:e,providedIn:"root"}),e}(),F=function(){function e(e,t,r,i,n,a,o,s){this.service=e,this.flowsheetsApiService=t,this.priorWarningsApiService=r,this.usageService=i,this.graphService=n,this.toolTipService=a,this.http=o,this.ref=s,this.margin=10,this.isMouseOverPeraGraph=!1}return e.prototype.ngOnInit=function(){this.subscribeToPeraGraphDataFeeds(),this.subscribeToToolTipInfoEvent(),this.style={width:this.peraGraphWidth-this.margin+"px",height:this.peraGraphHeight-this.margin+"px"},this.usageService.addUsageData(this.graph,u.UsageType.Array),this.ref.detach()},e.prototype.subscribeToPeraGraphDataFeeds=function(){var t=this;this.flowSheetMap$=this.flowsheetsApiService.getFlowSheetSubject().subscribe(function(e){t.getFlowSheetsForVisit(e),t.ref&&t.ref.detectChanges()}),this.priorWarningMap$=this.priorWarningsApiService.getPriorWarningSubject().subscribe(function(e){t.getPriorWarningsForVisit(e),t.ref&&t.ref.detectChanges()})},e.prototype.subscribeToToolTipInfoEvent=function(){var t=this;this.toolTipInfoEvent$=this.toolTipService.toolTipInfoUpdated$.subscribe(function(e){t.isMouseOverPeraGraph&&e.visitId===t.graph.visitId&&(t.tooltip&&(t.graphService.tooltip=t.tooltip,t.tooltip.open()),t.ref&&t.ref.detectChanges())})},e.prototype.mouseEnterHandler=function(e){this.isMouseOverPeraGraph||e.isOpen()||(this.isMouseOverPeraGraph=!0,this.tooltip=e,this.graph&&(this.graphService.closeToolTip(),this.toolTipService.updateToolTipInfo(this.graph)))},e.prototype.mouseLeaveHandler=function(e){this.isMouseOverPeraGraph=!1,e.isOpen()&&e.close()},e.prototype.graphClicked=function(e){this.tooltip&&this.tooltip.isOpen()&&(this.tooltip.close(),this.tooltip=null),this.graphService.graphClickedEvent(e),this.service.tokenRefresh$.next()},e.prototype.isShown=function(e){this.tooltip||setTimeout(function(){return e.close()},1)},e.prototype.ngOnChanges=function(e){if(e&&e.peraGraphWidth&&e.peraGraphWidth.previousValue!==e.peraGraphWidth.currentValue&&(this.style={width:this.peraGraphWidth-this.margin+"px",height:this.peraGraphHeight-this.margin+"px"}),e&&e.graph&&e.graph.currentValue!==e.graph.previousValue&&!e.graph.firstChange&&e.graph.currentValue.visitId!==e.graph.previousValue.visitId){this.usageService.addUsageData(this.graph,u.UsageType.Array);var t=this.flowsheetsApiService.getFlowSheetSubjectValue();this.getFlowSheetsForVisit(t);var r=this.priorWarningsApiService.getPriorWarningSubjectValue();this.getPriorWarningsForVisit(r),this.ref&&this.ref.detectChanges()}},e.prototype.getFlowSheetsForVisit=function(e){if(e){var t=e[this.graph.visitId];t&&this.flowsheets!==t&&JSON.stringify(this.flowsheets)!==JSON.stringify(t)?(this.flowsheets=t,this.latestRi=t[this.flowsheets.length-1].riScore):t||null===this.flowsheets||(this.flowsheets=[],this.latestRi=null)}},e.prototype.getPriorWarningsForVisit=function(e){if(e){var t=e[this.graph.visitId];t&&t!==this.priorWarning?this.priorWarning=t:t||(this.priorWarning=null)}},e.prototype.ngOnDestroy=function(){this.ref&&(this.ref.detach(),this.ref=null),this.flowSheetMap$&&!this.flowSheetMap$.closed&&this.flowSheetMap$.unsubscribe(),this.priorWarningMap$&&!this.priorWarningMap$.closed&&this.priorWarningMap$.unsubscribe(),this.toolTipInfoEvent$&&!this.toolTipInfoEvent$.closed&&this.toolTipInfoEvent$.unsubscribe()},e.decorators=[{type:c.Component,args:[{selector:"phlib-pera-graph",template:'<div class="ph-pera-graph"\n     id="{{ graph.vnm }}"\n     (click)="graphClicked(graph)"\n     [ngStyle]="style">\n\n    <phlib-pera-graph-tile *ngIf="service.isDisplayingTiles();else displayPeraGraph" [graph]="graph"\n                           [latestRi]="latestRi" [priorWarning]="priorWarning"\n                           (mouseenter)="mouseEnterHandler(po)"\n                           (mouseleave)="mouseLeaveHandler(po)"\n                           #po="ngbPopover"\n                           class="width-adjustment"\n                           [ngbPopover]="popTemplate"\n                           [autoClose]="true"\n                           popoverTitle="Visit Info"\n                           placement="auto"\n                           triggers="manual"\n                           container=\'body\'>\n              <ng-template #popTemplate>\n                <phlib-chart-tooltip [graph]="graph"></phlib-chart-tooltip>\n              </ng-template>\n    </phlib-pera-graph-tile>\n\n    <ng-template #displayPeraGraph>\n      <phlib-pera-graph-header class="peraGraphHeader"\n                               [graph]="graph"\n                               [latestRi]="latestRi"\n                               [priorWarning]="priorWarning"></phlib-pera-graph-header>\n      <phlib-chart\n          [graph]="graph"\n          [flowsheets]="flowsheets"\n          class="width-adjustment"\n          (mouseenter)="mouseEnterHandler(po)"\n          (mouseleave)="mouseLeaveHandler(po)"\n          #po="ngbPopover"\n          [ngbPopover]="popTemplate"\n          [autoClose]="true"\n          (shown)="isShown(po)"\n          triggers="manual"\n          popoverTitle="Visit Info"\n          placement="auto"\n          container=\'body\'>\n        </phlib-chart>\n        <ng-template #popTemplate>\n          <phlib-chart-tooltip [graph]="graph"></phlib-chart-tooltip>\n        </ng-template>\n    </ng-template>\n</div>\n',changeDetection:c.ChangeDetectionStrategy.OnPush,styles:[".ph-pera-graph{border:1px solid #000;padding-top:auto;margin-right:5px;background-color:#fff!important;display:inline-flex;position:relative}.width-adjustment{width:inherit}"]}]}],e.ctorParameters=function(){return[{type:I},{type:u.FlowsheetsApiService},{type:V},{type:u.UsageApiService},{type:W},{type:j},{type:i.HttpClient},{type:c.ChangeDetectorRef}]},e.propDecorators={graph:[{type:c.Input}],peraGraphWidth:[{type:c.Input}],peraGraphHeight:[{type:c.Input}]},e}(),$=require("highcharts"),M=o,H=function(){function e(e,t,r,i){this.dateService=e,this.chartService=t,this.arrayViewService=r,this.ref=i,this.Highcharts=$,this.X_AXIS_DAYS=5,this.DAY_IN_MILLISECONDS=864e5,this.minRiScore=0,this.minRecordedDt=1e21,this.maxRecordedDt=0}return e.prototype.ngOnInit=function(){this.ref.detach(),this.series=this.getChartSeries(),this.chartOptions=this.getChartOptions(),this.ref.detectChanges()},e.prototype.ngOnChanges=function(){this.Highcharts&&this.chartOptions&&(this.series=this.getChartSeries(),this.series!==this.chartOptions.series&&(this.updateChart(),this.chartOptions=f({},this.chartOptions),this.ref&&this.ref.detectChanges()))},e.prototype.updateChart=function(){this.chartOptions.series=this.series,this.updateXAxis(),this.updateYAxis()},e.prototype.updateYAxis=function(){var e=this.chartService.getMinYAxisTick(this.minRiScore);this.chartOptions.yAxis[0].min!==e&&(this.chartOptions.yAxis[0].min=e,this.chartOptions.yAxis[0].plotLines=this.chartService.createZeroAxisLine(this.minRiScore))},e.prototype.updateXAxis=function(){this.chartOptions.xAxis=this.getXaxis()},e.prototype.getChartOptions=function(){return{chart:{type:"line",spacing:[2,0,0,0],marginLeft:18,marginRight:2,plotBackgroundColor:"white",reflow:!1,animation:!1,alignTicks:!1},tooltip:{enabled:!1,animation:!1},plotOptions:{series:{color:"#848484",turboThreshold:0,animation:!1,enableMouseTracking:!1,stickyTracking:!1,shadow:!1,dataLabels:{style:{textShadow:!1}}},line:{animation:!1,enableMouseTracking:!1,stickyTracking:!1,shadow:!1,dataLabels:{style:{textShadow:!1}}}},credits:{enabled:!1},legend:{enabled:!1},title:{text:""},xAxis:this.getXaxis(),yAxis:this.getYaxis(),series:this.series}},e.prototype.getXaxis=function(){var e=[];return e.push({type:"datetime",startOnTick:!1,endOnTick:!1,tickInterval:this.graph.isDischarged?null:this.DAY_IN_MILLISECONDS,gridLineWidth:1,plotLines:this.chartService.updateAlertPlotLine(this.graph),title:{text:" "},labels:{distance:20,style:{color:"black","font-size":".6em"},formatter:function(){return M(this.value).utcOffset(0).format("MM/DD")},step:1},min:this.getMinXAxisValue(),max:this.getMaxXAxisValue()}),e},e.prototype.getMaxXAxisValue=function(){return this.graph.discharged?null:this.dateService.translateDate(this.arrayViewService.getCurrentTimestamp(),this.graph.timeZone)},e.prototype.getMinXAxisValue=function(){return this.graph.discharged?null:this.dateService.translateDate(this.arrayViewService.getCurrentTimestamp(),this.graph.timeZone)-this.X_AXIS_DAYS*this.DAY_IN_MILLISECONDS},e.prototype.getYaxis=function(){var e=[];return e.push({title:{text:" "},labels:{style:{color:"black","font-size":".6em"},padding:1,align:"center"},offset:-12,gridLineWidth:1,min:this.chartService.getMinYAxisTick(this.minRiScore),max:100,plotLines:this.chartService.createZeroAxisLine(this.minRiScore),tickPositioner:function(e,t){for(var r=e,i=[];r<=t;)i.push(r),r+=20;return i}}),e},e.prototype.getChartSeries=function(){var e=[];return e.push({name:"",data:this.getDataPoints(this.flowsheets),showInLegend:!1,turboThreshold:0,color:{linearGradient:{x1:0,x2:1,y1:0,y2:0},stops:this.getArrayOfLocationChanges(this.flowsheets)},marker:{enabled:!(!this.flowsheets||1!==this.flowsheets.length),color:this.flowsheets&&1===this.flowsheets.length?this.chartService.getMarkerColor(this.flowsheets[0].unitType):null,radius:1.5}}),e},e.prototype.getArrayOfLocationChanges=function(e){var t=this,r=this.maxRecordedDt-this.minRecordedDt,i=[[0,"black"]],n="black",a=null,o=0;return e&&0<r&&e.forEach(function(e){e.unitType!==a&&(o=(e.key.recordedDt-t.minRecordedDt)/r,i.push([o-1e-4,n]),n=t.chartService.getMarkerColor(e.unitType),i.push([o,n]),a=e.unitType)}),i},e.prototype.getDataPoints=function(e){var t=this,r=[];return this.minRiScore=100,this.minRecordedDt=1e21,this.maxRecordedDt=0,e&&e.forEach(function(e){r.push([t.dateService.translateDate(e.key.recordedDt,t.graph.timeZone),e.riScore+Math.random()/1e3]),t.minRecordedDt=t.minRecordedDt>e.key.recordedDt?e.key.recordedDt:t.minRecordedDt,t.maxRecordedDt=t.maxRecordedDt<e.key.recordedDt?e.key.recordedDt:t.maxRecordedDt,t.minRiScore=t.minRiScore>e.riScore?e.riScore:t.minRiScore}),r},e.prototype.ngOnDestroy=function(){this.ref&&(this.ref.detach(),this.ref=null)},e.decorators=[{type:c.Component,args:[{selector:"phlib-chart",template:'<div class="ph-graph" *ngIf="!flowsheets || flowsheets.length != 0">\n  <highcharts-chart class="ph-hc"\n                    [Highcharts]="Highcharts"\n                    [options]="chartOptions"\n  ></highcharts-chart>\n</div>\n\n<div class="insufficient-data ph-hc" *ngIf="flowsheets && flowsheets.length == 0">\n  <div class="insufficient-data-text">Insufficient data received to generate RI graph\n    <div *ngIf="graph && graph.activeWarning" class="insufficient-data-text">\n      <br>\n      Warning state generated by prior visit\n    </div>\n  </div>\n</div>\n',changeDetection:c.ChangeDetectionStrategy.OnPush,styles:[".ph-graph{width:99%;height:83%;position:absolute;top:17%;left:1px;cursor:pointer}.ph-hc{width:100%!important;position:absolute!important;height:100%!important}.insufficient-data{font-size:.7em;font-weight:700;color:#60606a;padding-left:5%;padding-right:5%;padding-top:13%;display:flex;margin:auto}.insufficient-data-text{margin:auto}"]}]}],e.ctorParameters=function(){return[{type:u.DateService},{type:u.ChartService},{type:I},{type:c.ChangeDetectorRef}]},e.propDecorators={flowsheets:[{type:c.Input}],graph:[{type:c.Input}],currentTimestamp:[{type:c.Input}]},e}(),N=function(){function e(e,t,r,i){this.peraGraphService=e,this.warningService=t,this.arrayViewService=r,this.ref=i}return e.prototype.ngOnInit=function(){var e=this;this.arrayViewService.chartTitleSubject$.subscribe(function(){e.ref&&e.ref.detectChanges()})},e.prototype.ngOnChanges=function(){this.updateBackgroundColor()},e.prototype.updateBackgroundColor=function(){var e=this.graph?this.graph.activeWarning:null;this.style={backgroundColor:this.peraGraphService.getBackgroundColorByWarningAndRi(e,this.latestRi,this.graph.discharged)},this.priorWarningIndicator=this.warningService.getWarningClass(this.priorWarning)},e.decorators=[{type:c.Component,args:[{selector:"phlib-pera-graph-tile",template:'\x3c!-- Outer div establishes QA test lookup ID, other divs display over the top of each other --\x3e\n<div id="{{ arrayViewService.chartTitleSubject$.value.returnFunc(this.graph) }}" class="ph-tile">\n    <div class="inner ph-tile {{ priorWarningIndicator }}" [ngStyle]="style">\n    </div>\n    <div class="inner ph-tile-score" style="background-color: transparent">\n        {{ this.peraGraphService.getRiScoreToDisplay(this.latestRi) }}\n    </div>\n</div>\n',styles:[".inner{position:absolute}.ph-tile{width:100%;height:100%;text-align:center;cursor:pointer}.ph-tile-score{font-size:1.3em;padding-top:25%;text-align:center;text-shadow:1px 1px 3px #3b3b3b;color:#fff;width:100%;height:100%}.vh-warning{width:0;height:0;border-style:solid;border-width:0 63px 63px 0;border-color:transparent #d51c19 transparent transparent}.h-warning{width:0;height:0;border-style:solid;border-width:0 63px 63px 0;border-color:transparent #fc7134 transparent transparent}.m-warning{width:0;height:0;border-style:solid;border-width:0 63px 63px 0;border-color:transparent #fdc43a transparent transparent}"]}]}],e.ctorParameters=function(){return[{type:W},{type:u.WarningService},{type:I},{type:c.ChangeDetectorRef}]},e.propDecorators={graph:[{type:c.Input}],latestRi:[{type:c.Input}],priorWarning:[{type:c.Input}]},e}(),E=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:c.Component,args:[{selector:"app-group-header",template:'<div class="group-header">\n    <div class="info">\n        <div id=\'{{name}}\' class="dashboard-grouping-info">{{name}}</div>\n        <div id=\'{{name}}-{{numberOfPatients}}\' class="dashboard-grouping-info pull-right-info">Patients: {{numberOfPatients}}</div>\n        <hr>\n    </div>\n</div>\n',changeDetection:c.ChangeDetectionStrategy.OnPush,styles:[".group-header{margin:.7em 10px 0 3vw;display:block;cursor:pointer}.info{background-color:#f2f2f2;position:relative;z-index:6;height:2.4em}.group-header .dashboard-grouping-info.pull-right-info{font-size:.7em;color:#666;float:right;padding-right:0}.group-header .dashboard-grouping-info{display:inline-block;font-size:1.2em;color:#999;background-color:#f2f2f2;z-index:4;position:relative;padding-right:10px}hr{margin-top:.5em;margin-bottom:.5em;overflow:hidden;border-top:2px solid #898989;position:relative;top:-1.2em;z-index:0}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={numberOfPatients:[{type:c.Input}],name:[{type:c.Input}]},e}(),L=function(){function e(e,t,r,i){this.peraGraphService=e,this.warningService=t,this.arrayViewService=r,this.ref=i}return e.prototype.ngOnInit=function(){var e=this;this.arrayViewService.chartTitleSubject$.subscribe(function(){e.ref&&e.ref.detectChanges()})},e.prototype.ngOnChanges=function(e){(e.latestRi||e.graph)&&this.updateHeaderColor(),this.priorWarningIndicator=this.warningService.getWarningClass(this.priorWarning),this.priorWarningIndicatorId="priorWarningIndicator-"+this.graph.vnm},e.prototype.updateHeaderColor=function(){var e=this.graph?this.graph.activeWarning:null;this.style={backgroundColor:this.peraGraphService.getBackgroundColorByWarningAndRi(e,this.latestRi,this.graph.discharged),width:"100%"}},e.decorators=[{type:c.Component,args:[{selector:"phlib-pera-graph-header",template:'<div id="{{ arrayViewService.chartTitleSubject$.value.returnFunc(this.graph) }}" class="ph-header">\n    \x3c!-- Match the background color to the warning level--\x3e\n    <div id="headerbackground" class="inner" [ngStyle]="style">&nbsp;</div>\n    \x3c!-- Display the prior warning indicator on the right side of the header --\x3e\n    <div id="{{priorWarningIndicatorId}}}" class="inner {{priorWarningIndicator}}" style="width: 100%; background-color: transparent"></div>\n    \x3c!-- Display the graph title... could be the Patient\'s Name, the MRN, the VNM, etc--\x3e\n    <div class="inner ph-header-title" style="background-color: transparent">\n      {{ arrayViewService.chartTitleSubject$.value.returnFunc(this.graph) }}\n    </div>\n    \x3c!-- Display the Rothman Index on the right side of the header --\x3e\n    <div class="inner ph-header-score" style="background-color: transparent">\n        {{ this.peraGraphService.getRiScoreToDisplay(this.latestRi) }}\n    </div>\n</div>\n',changeDetection:c.ChangeDetectionStrategy.OnPush,styles:['.inner{position:absolute}.ph-header{color:#fff;width:100%;white-space:nowrap}.ph-header-title{text-shadow:1px 1px 3px #000;font-size:.8em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:table-cell;vertical-align:middle;padding-left:5px;padding-right:5px;padding-top:1px;width:90%}.ph-header-score{font-size:.8em;text-shadow:1px 1px 3px #000;padding-right:5px;width:100%;text-align:right;align-content:right;padding-top:1px}.hide-on-compact{display:none}div{float:left}#headerbackground{height:16%;border-bottom:1px solid #000}.m-warning{width:0;height:0;padding-left:12%;padding-top:12%;overflow:hidden;float:right}.m-warning:after{content:"";display:block;width:0;height:0;margin-left:-500px;margin-top:-500px;float:right;border-left:500px solid transparent;border-top:500px solid #f6cc5d}.h-warning{width:0;height:0;padding-left:12%;padding-top:12%;overflow:hidden;float:right}.h-warning:after{content:"";display:block;width:0;height:0;margin-left:-500px;margin-top:-500px;float:right;border-left:500px solid transparent;border-top:500px solid #ee834c}.vh-warning{width:0;height:0;padding-left:12%;padding-top:12%;overflow:hidden;float:right}.vh-warning:after{content:"";display:block;width:0;height:0;margin-left:-500px;margin-top:-500px;float:right;border-left:500px solid transparent;border-top:500px solid #d51c19}']}]}],e.ctorParameters=function(){return[{type:W},{type:u.WarningService},{type:I},{type:c.ChangeDetectorRef}]},e.propDecorators={graph:[{type:c.Input}],latestRi:[{type:c.Input}],priorWarning:[{type:c.Input}]},e}(),z=function(){function e(e){this.dateService=e}return e.prototype.getAdmitDate=function(){return this.graph&&this.graph.timeZone&&this.graph.admitDate?this.dateService.getDateFormat(this.graph.timeZone,this.graph.admitDate,"MM/DD/YY HH:mm z"):""},e.prototype.getDischargeDate=function(){return this.graph&&this.graph.timeZone&&this.graph.discharged&&this.graph.dischargeDate?this.dateService.getDateFormat(this.graph.timeZone,this.graph.dischargeDate,"MM/DD/YY HH:mm z"):""},e.prototype.isDischarged=function(){return this.graph&&this.graph.isDischarged},e.decorators=[{type:c.Component,args:[{selector:"phlib-chart-tooltip",template:'<span class="patientToolTip">\n  <b>Patient: </b><span style="text-transform: capitalize;">{{graph?.displayName.toLowerCase()}}</span><br>\n  <b>Facility: </b>{{graph?.facilityId}}<br>\n  <b>Unit Room Bed: </b>{{graph?.unitId}} {{graph?.room}} {{graph?.bed}}<br>\n  <b>DOB: </b>{{graph?.patient?.dob | date:\'MM/dd/yy\'}}<br>\n  <b>Visit: </b>{{graph?.vnm}}<br>\n  <b>MRN: </b>{{graph?.patient.medicalRecordNumber}}<br>\n  <b>Diagnosis: </b>{{graph?.diagnosis}}<br>\n  <b>Admit Date: </b>{{getAdmitDate()}}<br>\n  <span id="dischargeDate" *ngIf="isDischarged()"><b>Discharge Date: </b>{{getDischargeDate()}}<br></span>\n  <b>Provider: </b>{{ graph?.attendingProvider?.firstName}} {{graph?.attendingProvider?.lastName}}<br>\n  <b>Other Visits with RI Scores: </b>{{graph?.numberVisitsWithValidRI}}<br>\n  <span id="dischargeName"*ngIf="isDischarged()"><b>Discharge Disposition: </b>{{graph?.dischargeDispositionDisplayName}}</span>\n</span>\n',styles:[".patientToolTip{font-size:1em}"]}]}],e.ctorParameters=function(){return[{type:u.DateService}]},e.propDecorators={graph:[{type:c.Input}]},e}(),B=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[d.FilterService,d.FilterQueryRestService,d.FilterQueryConfigService]}},e.decorators=[{type:c.NgModule,args:[{imports:[r.CommonModule,s.HighchartsChartModule,p.VirtualScrollModule,h.ResizableModule,g.NgbModule],declarations:[O,k,E,F,H,N,z,L],exports:[O]}]}],e}();e.ArrayViewService=I,e.ArrayViewConfigService=y,e.PeraGraphService=W,e.PriorWarningsApiService=V,e.PriorWarningsConfigService=A,e.ArrayViewComponent=O,e.ArrayViewModule=B,e.ɵb=E,e.ɵa=k,e.ɵe=H,e.ɵh=L,e.ɵf=N,e.ɵc=F,e.ɵd=j,e.ɵg=z,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-array-view-library.umd.min.js.map