!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs","rxjs/operators","@angular/common"],t):t((e.od=e.od||{},e.od.virtualscroll={}),e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common)}(this,function(e,t,T,y,n){"use strict";var i=function(){function e(){var t=this;this._scrollWin=new T.ReplaySubject(1),this.scrollWin$=this._scrollWin.asObservable(),this.emitScrollWin=function(e){return t._scrollWin.next(e)},this._createRow=new T.Subject,this.createRow$=this._createRow.asObservable(),this.emitCreateRow=function(e){return t._createRow.next(e)},this._removeRow=new T.Subject,this.removeRow$=this._removeRow.asObservable(),this.emitRemoveRow=function(e){return t._removeRow.next(e)},this._shiftRow=new T.Subject,this.shiftRow$=this._shiftRow.asObservable(),this.emitShiftRow=function(e){return t._shiftRow.next(e)},this._createItem=new T.Subject,this.createItem$=this._createItem.asObservable(),this.emitCreateItem=function(e){return t._createItem.next(e)},this._updateItem=new T.Subject,this.updateItem$=this._updateItem.asObservable(),this.emitUpdateItem=function(e){return t._updateItem.next(e)},this._removeItem=new T.Subject,this.removeItem$=this._removeItem.asObservable(),this.emitRemoveItem=function(e){return t._removeItem.next(e)}}return e.decorators=[{type:t.Injectable}],e}(),r=function(){function e(e){this._cdr=e,this._translateY=0}return Object.defineProperty(e.prototype,"getTransform",{get:function(){return"translateY("+this._translateY+"px)"},enumerable:!0,configurable:!0}),e.prototype.addItem=function(e,t,n){return this._cdr.markForCheck(),this._viewContainer.createEmbeddedView(e,t,n)},e.prototype.setTransform=function(e){this._translateY=e},e.prototype.updateItem=function(e,t){this._cdr.markForCheck();var n=this._viewContainer.get(e);return n.context.$implicit=t,n},e.prototype.removeItem=function(e){this._cdr.markForCheck(),this._viewContainer.remove(e)},e.prototype.updateRow=function(e){for(var t=0;t<this._viewContainer.length;t++){this._viewContainer.get(t).context.row=e}this._cdr.markForCheck()},e.decorators=[{type:t.Component,args:[{changeDetection:t.ChangeDetectionStrategy.OnPush,selector:"od-virtualrow",styles:[":host { display: block; position: absolute }"],template:"<div #viewRef></div>"}]}],e.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]},e.propDecorators={_viewContainer:[{type:t.ViewChild,args:["viewRef",{read:t.ViewContainerRef}]}],getTransform:[{type:t.HostBinding,args:["style.transform"]}]},e}(),_={Noop:0,CreateRow:1,ShiftRow:2,RemoveRow:3,CreateItem:4,UpdateItem:5,RemoveItem:6};_[_.Noop]="Noop",_[_.CreateRow]="CreateRow",_[_.ShiftRow]="ShiftRow",_[_.RemoveRow]="RemoveRow",_[_.CreateItem]="CreateItem",_[_.UpdateItem]="UpdateItem",_[_.RemoveItem]="RemoveItem";var F=function(){this.cmdType=_.Noop},A=function(e,t,n){this.virtualIndex=e,this.actualIndex=t,this.initShift=n,this.cmdType=_.CreateRow},W=function(e,t){this.virtualIndex=e,this.actualIndex=t,this.cmdType=_.RemoveRow},k=function(e,t,n){this.virtualIndex=e,this.actualIndex=t,this.shift=n,this.cmdType=_.ShiftRow},V=function(e,t,n,i){this.virtualIndex=e,this.actualIndex=t,this.columnIndex=n,this.dataIndex=i,this.cmdType=_.CreateItem},H=function(e,t,n,i){this.virtualIndex=e,this.actualIndex=t,this.columnIndex=n,this.dataIndex=i,this.cmdType=_.UpdateItem},O=function(e,t,n,i){this.virtualIndex=e,this.actualIndex=t,this.columnIndex=n,this.dataIndex=i,this.cmdType=_.RemoveItem};function M(e,t,n,i){for(var o=e;o<=t;o++)i(o,o%n)}function j(e,t,n,i,o,r){for(var s=function(e){return n*i+e},u=e,a=s(u);u<=t&&a<o;a=s(++u))r(u,a)}var x=function(e,t,n){return Math.min(t,Math.max(e,n))};function E(e){return e.visibleEndRow*e.numActualColumns+e.numActualColumns-1}var D=function(e,t,n){this.$implicit=e,this.row=t,this.column=n};function U(e){return 0===Object.keys(e).length}function P(e,t){var n={};for(var i in e)void 0===t[i]&&(n[i]=e[i]);return n}var $={SetScrollTop:0,FocusRow:1,FocusItem:2};$[$.SetScrollTop]="SetScrollTop",$[$.FocusRow]="FocusRow",$[$.FocusItem]="FocusItem";var L=function(e){this.value=e,this.cmdType=$.SetScrollTop},o=function(e){this.rowIndex=e,this.cmdType=$.FocusRow},s=function(e){this.itemIndex=e,this.cmdType=$.FocusItem},u=function(){function e(e,t,n,i,o){this._elem=e,this._cdr=t,this._componentFactoryResolver=n,this._obsService=i,this._zone=o,this.vsData=T.empty(),this.vsOptions=T.empty(),this.vsResize=T.empty(),this.vsUserCmd=T.empty(),this.vsDebounceTime=0,this.vsEqualsFunc=function(e,t){return e===t},this.height=0,this.width="0px",this._rowFactory=this._componentFactoryResolver.resolveComponentFactory(r),this._subs=[]}return e.prototype.ngOnInit=function(){var S=this,e=function(){return S._elem.nativeElement.getBoundingClientRect()},t=this.vsData.pipe(y.startWith([]),y.publish()),n=t.pipe(y.map(function(e){return[(new Date).getTime(),e.length]})),i=this.vsOptions.pipe(y.startWith({itemWidth:100,itemHeight:100,numAdditionalRows:1}),y.publish()),o=T.merge(T.fromEvent(window,"resize"),this.vsResize).pipe(y.debounceTime(this.vsDebounceTime,T.animationFrameScheduler),y.map(function(){return e()}),y.startWith(e()),y.map(function(e){return{width:e.width,height:e.height}})),r=new T.Subject;this._zone.runOutsideAngular(function(){S._subs.push(T.fromEvent(S._elem.nativeElement,"scroll").pipe(y.debounceTime(S.vsDebounceTime,T.animationFrameScheduler)).subscribe(function(){S._zone.run(function(){return r.next()})}))});var s=r.pipe(y.map(function(){return S._elem.nativeElement.scrollTop}),y.startWith(0)),u=T.combineLatest(o,i).pipe(y.map(function(e){var t,n,i,o,r=e[0],s=e[1];return t=r,n=s,i=Math.ceil(t.height/n.itemHeight),o=void 0!==n.itemWidth?Math.floor(t.width/n.itemWidth):0,{containerHeight:t.height,containerWidth:t.width,itemHeight:n.itemHeight,itemWidth:n.itemWidth,numPossibleColumns:o,numPossibleItems:i*o,numPossibleRows:i}}),y.publish()),a=T.combineLatest(s,u,n,i).pipe(y.map(function(e){var t,n,i,o,r,s,u,a,m,c,l,h,p,d,f=e[0],v=e[1],w=e[2],I=w[0],R=w[1],C=e[3];return t=f,n=v,i=I,r=R,s=void 0!==(o=C).numLimitColumns?o.numLimitColumns:n.numPossibleColumns,u=Math.min(r,s),a=Math.ceil(r/Math.max(1,u)),m=a*n.itemHeight,c=void 0!==o.numAdditionalRows?o.numAdditionalRows:1,l=n.numPossibleRows+c,h=0<u?Math.min(l,a):0,p=h*n.itemHeight,d=0<u&&0<h?x(0,a-1,Math.floor((t+p)/n.itemHeight)-1):-1,{actualHeight:p,containerHeight:n.containerHeight,containerWidth:n.containerWidth,dataTimestamp:i,itemHeight:n.itemHeight,itemWidth:n.itemWidth,numActualColumns:u,numActualItems:Math.min(h*u,r),numActualRows:h,numAdditionalRows:c,numVirtualItems:r,numVirtualRows:a,scrollPercentage:x(0,100,t/(m-n.containerHeight)),scrollTop:t,virtualHeight:m,visibleEndRow:d,visibleStartRow:-1!==d?Math.max(0,d-h+1):-1}}),y.distinctUntilChanged(function(e,t){return e.visibleStartRow===t.visibleStartRow&&e.visibleEndRow===t.visibleEndRow&&e.numActualColumns===t.numActualColumns&&e.numVirtualItems===t.numVirtualItems&&e.dataTimestamp===t.dataTimestamp}),y.publish()),m=a.pipe(y.pairwise()).pipe(y.concatMap(function(e){var r=e[0],s=e[1],t=T.of(new F),n=T.of(new F),i={},o={};M(Math.abs(r.visibleStartRow),r.visibleEndRow,r.numActualRows,function(e,t){i[t]=e}),M(Math.abs(s.visibleStartRow),s.visibleEndRow,s.numActualRows,function(e,t){o[t]=e});var u=P(i,o),a=P(o,i);if(U(u)){if(!U(a)){var m=[],c=[],l=function(e){var n=parseInt(e,10),i=a[e];m.push(new A(i,n,i*s.itemHeight)),j(0,s.numActualColumns-1,i,s.numActualColumns,s.numVirtualItems,function(e,t){c.push(new V(i,n,e,t))})};for(var h in a)l(h);t=T.concat(T.from(m),T.from(c))}}else{var p=[],d=[],f=function(e){var n=parseInt(e,10),i=u[e];p.push(new W(i,n)),j(0,r.numActualColumns-1,i,r.numActualColumns,r.numVirtualItems,function(e,t){d.push(new O(i,n,e,t))})};for(var h in u)f(h);t=T.concat(T.from(d.reverse()),T.from(p))}var v=function(e,t){var n={};for(var i in e)void 0!==t[i]&&(n[i]={left:e[i],right:t[i]});return n}(i,o);if(!U(v)){var w=[],I=[],R=[],C=[],b=[],g=[],y=Math.min(r.numActualColumns,s.numActualColumns),_=s.numActualColumns-r.numActualColumns,x=function(e){var i=parseInt(e,10),n=v[e].left,o=v[e].right;o!==n&&w.push(new k(o,i,o*s.itemHeight)),(o!==n||0!==_||r.numVirtualItems<=E(r)||s.numVirtualItems<=E(s)||r.dataTimestamp!==s.dataTimestamp)&&function(e,t,n,i,o,r,s){for(var u=e;u<=t;u++)s(u,n*i+u,o*r+u)}(0,y-1,o,s.numActualColumns,n,r.numActualColumns,function(e,t,n){t>=s.numVirtualItems&&n<r.numVirtualItems?R.push(new O(o,i,e,n)):t<s.numVirtualItems&&n>=r.numVirtualItems?I.push(new V(o,i,e,t)):t<s.numVirtualItems&&n<r.numVirtualItems&&!S.vsEqualsFunc(n,t)&&C.push(new H(o,i,e,t))}),0<_?j(y,s.numActualColumns-1,o,s.numActualColumns,s.numVirtualItems,function(e,t){b.push(new V(o,i,e,t))}):_<0&&j(y,r.numActualColumns-1,n,r.numActualColumns,r.numVirtualItems,function(e,t){g.push(new O(n,i,e,t))})};for(var h in v)x(h);n=T.concat(T.merge(T.from(R.reverse()),T.from(I),T.from(C),T.from(w)),T.merge(T.from(g.reverse()),T.from(b)))}return T.merge(t,n)}),y.publish()),c=a.pipe(y.map(function(t){return function(e){return e.scrollWindow=t,S._obsService.emitScrollWin([t]),e.needsCheck=!0,e}})),l=m.pipe(y.filter(function(e){return e.cmdType===_.CreateRow}),y.map(function(n){return function(e){var t=S._viewContainer.createComponent(S._rowFactory);return t.instance.setTransform(n.initShift),e.rows[n.actualIndex]=t,S._obsService.emitCreateRow([n,t]),e.needsCheck=!1,e}})),h=m.pipe(y.filter(function(e){return e.cmdType===_.RemoveRow}),y.map(function(n){return function(e){var t=e.rows[n.actualIndex];return t.destroy(),delete e.rows[n.actualIndex],S._obsService.emitRemoveRow([n,t]),e.needsCheck=!1,e}})),p=m.pipe(y.filter(function(e){return e.cmdType===_.ShiftRow}),y.map(function(i){return function(e){var t=i,n=e.rows[t.actualIndex];return n.instance.updateRow(t.virtualIndex),n.instance.setTransform(t.shift),S._obsService.emitShiftRow([t,n]),e.needsCheck=!1,e}})),d=m.pipe(y.filter(function(e){return e.cmdType===_.CreateItem}),y.withLatestFrom(t),y.map(function(e){var o=e[0],r=e[1];return function(e){var t=o,n=new D(r[t.dataIndex],t.virtualIndex,t.columnIndex),i=e.rows[t.actualIndex].instance.addItem(S._templateRef,n);return S._obsService.emitCreateItem([t,n,i]),e.needsCheck=!1,e}})),f=m.pipe(y.filter(function(e){return e.cmdType===_.UpdateItem}),y.withLatestFrom(t),y.map(function(e){var o=e[0],r=e[1];return function(e){var t=o,n=r[t.dataIndex],i=e.rows[t.actualIndex].instance.updateItem(t.columnIndex,n);return S._obsService.emitUpdateItem([t,n,i]),e.needsCheck=!1,e}})),v=m.pipe(y.filter(function(e){return e.cmdType===_.RemoveItem}),y.map(function(t){return function(e){return e.rows[t.actualIndex].instance.removeItem(t.columnIndex),S._obsService.emitRemoveItem([t]),e.needsCheck=!1,e}})),w=this.vsUserCmd.pipe(y.publish()),I=w.pipe(y.filter(function(e){return e.cmdType===$.SetScrollTop})),R=w.pipe(y.filter(function(e){return e.cmdType===$.FocusRow}),y.withLatestFrom(a),y.map(function(e){var t=e[0],n=e[1];return new L(t.rowIndex*n.itemHeight)})),C=w.pipe(y.filter(function(e){return e.cmdType===$.FocusItem}),y.withLatestFrom(a),y.map(function(e){var t=e[0],n=e[1],i=t;return new L(Math.floor(i.itemIndex/n.numActualColumns)*n.itemHeight)})),b=T.merge(I,R,C).pipe(y.map(function(n){return function(e){var t;return t=n.value,S._elem.nativeElement.scrollTop=t,e.needsCheck=!1,e}})),g=T.merge(l,h,p,d,v,f,c,b).pipe(y.scan(function(e,t){return t(e)},{measurement:null,scrollWindow:null,rows:{},needsCheck:!1}));this._subs.push(g.pipe(y.filter(function(e){return e.needsCheck&&null!==e.scrollWindow})).subscribe(function(e){S.height=e.scrollWindow.virtualHeight,void 0===e.scrollWindow.itemWidth?S.width="100%":S.width=e.scrollWindow.itemWidth*e.scrollWindow.numActualColumns+"px",S._cdr.markForCheck()})),this._subs.push(w.connect()),this._subs.push(m.connect()),this._subs.push(a.connect()),this._subs.push(u.connect()),this._subs.push(i.connect()),this._subs.push(t.connect())},e.prototype.ngOnDestroy=function(){this._subs.forEach(function(e){return e.unsubscribe()})},e.decorators=[{type:t.Component,args:[{changeDetection:t.ChangeDetectionStrategy.OnPush,selector:"od-virtualscroll",styles:["\n    :host {\n      display: block;\n      height: 100%;\n      overflow-y: scroll;\n    }\n\n    .od-scroll-container {\n      position: relative;\n      width: 100%;\n    }\n  "],template:'\n    <div class="od-scroll-container" [style.width]="width" [style.height.px]="height">\n      <div #viewRef><div>\n    </div>'}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.ChangeDetectorRef},{type:t.ComponentFactoryResolver},{type:i},{type:t.NgZone}]},e.propDecorators={_templateRef:[{type:t.ContentChild,args:[t.TemplateRef]}],_viewContainer:[{type:t.ViewChild,args:["viewRef",{read:t.ViewContainerRef}]}],vsData:[{type:t.Input}],vsOptions:[{type:t.Input}],vsResize:[{type:t.Input}],vsUserCmd:[{type:t.Input}],vsDebounceTime:[{type:t.Input}],vsEqualsFunc:[{type:t.Input}]},e}(),a=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[r,u],entryComponents:[r],exports:[u],imports:[n.CommonModule],providers:[i]}]}],e}();e.VirtualScrollModule=a,e.ScrollObservableService=i,e.VirtualRowComponent=r,e.ScrollItem=D,e.CreateRowCmd=A,e.RemoveRowCmd=W,e.ShiftRowCmd=k,e.CreateItemCmd=V,e.UpdateItemCmd=H,e.RemoveItemCmd=O,e.CmdOption=_,e.FocusItemCmd=s,e.FocusRowCmd=o,e.SetScrollTopCmd=L,e.UserCmdOption=$,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=od-virtualscroll.min.umd.js.map
