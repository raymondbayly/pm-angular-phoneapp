/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { SortChoices } from './SortEnum';
import * as i0 from "@angular/core";
var SortService = /** @class */ (function () {
    function SortService() {
        this.activeSortFunction = null;
        this._stagedSortFunction = null;
        this.activeSortName = null;
        this.stagedSortName = null;
        this.nonStandardSortFunctionActive = false;
        this.nonStandardSortFunction = null;
        // options of dropdown
        this.choices = [
            {
                value: {
                    sortName: SortChoices.DisplayName, transformer: function (peragraph) {
                        return peragraph.displayName;
                    }
                }, description: 'Patient Name', tooltip: 'Alphabetical sort by patient last name'
            },
            {
                value: {
                    sortName: SortChoices.MedicalRecordNumber, transformer: function (peragraph) {
                        return peragraph.patient.medicalRecordNumber;
                    }
                }, description: 'MRN', tooltip: 'Sort graphs by the medical record number of the patient'
            },
            {
                value: {
                    sortName: SortChoices.VisitNumber, transformer: function (peragraph) {
                        return peragraph.vnm;
                    }
                }, description: 'Visit Number', tooltip: 'Sort graphs by the visit number of the patient'
            },
            {
                value: {
                    sortName: SortChoices.RIScore, transformer: function (peragraph) {
                        return peragraph.latestRi;
                    }
                }, description: 'RI Score', tooltip: 'Sort by Rothman Index score value'
            },
            {
                value: {
                    sortName: SortChoices.HospitalLOS, transformer: function (peragraph) {
                        return peragraph.admitDate;
                    }
                }, description: 'Hospital LOS', tooltip: 'Sort by hospital length of stay'
            },
            {
                value: {
                    sortName: SortChoices.WarningSeverity, transformer: function (peragraph) {
                        if (peragraph.activeWarning) {
                            /** @type {?} */
                            var category = peragraph.activeWarning.category;
                            if (category === 'V') {
                                return 4;
                            }
                            else if (category === 'H') {
                                return 3;
                            }
                            else if (category === 'M') {
                                return 2;
                            }
                            else {
                                return 1;
                            }
                        }
                        return null;
                    }
                }, description: 'Warning Severity', tooltip: 'Sort by the severity of patient warnings'
            },
            {
                value: {
                    sortName: SortChoices.WarningDuration, transformer: function (peragraph) {
                        if (peragraph.activeWarning) {
                            return peragraph.activeWarning.createdDate;
                        }
                        return null;
                    }
                }, description: 'Warning Created Time', tooltip: 'Sort by warning created time'
            }
        ];
        this.stageSortFunction(this.choices[0].value.transformer, 1, this.choices[0].value.sortName);
        // set staged sort to active
        this.activeSortFunction = this.getStagedSortFunction();
        this.activeSortName = this.stagedSortName;
    }
    /**
     * @return {?}
     */
    SortService.prototype.getStagedSortFunction = /**
     * @return {?}
     */
    function () {
        return this._stagedSortFunction;
    };
    /**
     * what to do if sidebar is destroyed
     */
    /**
     * what to do if sidebar is destroyed
     * @return {?}
     */
    SortService.prototype.clearSort = /**
     * what to do if sidebar is destroyed
     * @return {?}
     */
    function () {
        this.activeSortName = null;
        this.activeSortFunction = null;
        this.stagedSortName = null;
        this._stagedSortFunction = null;
    };
    /**
     * stage sort function for application
     */
    /**
     * stage sort function for application
     * @param {?} transformer
     * @param {?} direction
     * @param {?} sortName
     * @return {?}
     */
    SortService.prototype.stageSortFunction = /**
     * stage sort function for application
     * @param {?} transformer
     * @param {?} direction
     * @param {?} sortName
     * @return {?}
     */
    function (transformer, direction, sortName) {
        this.stagedSortName = sortName;
        this._stagedSortFunction = this.createSortFunction(transformer, direction);
    };
    /**
     * generates sort function from transformer function, direction, and sortName
     * @param transformer - function to take peraGraph and return primitive value for sorting
     * @param direction - direction of sort
     */
    /**
     * generates sort function from transformer function, direction, and sortName
     * @param {?} transformer - function to take peraGraph and return primitive value for sorting
     * @param {?} direction - direction of sort
     * @return {?}
     */
    SortService.prototype.createSortFunction = /**
     * generates sort function from transformer function, direction, and sortName
     * @param {?} transformer - function to take peraGraph and return primitive value for sorting
     * @param {?} direction - direction of sort
     * @return {?}
     */
    function (transformer, direction) {
        return function (peraGraphA, peraGraphB) {
            /** @type {?} */
            var valueA = transformer(peraGraphA);
            /** @type {?} */
            var valueB = transformer(peraGraphB);
            /** @type {?} */
            var comparison = 0;
            // compare values and return
            if (valueA && valueB) {
                if (valueA > valueB) {
                    comparison = 1;
                }
                if (valueA < valueB) {
                    comparison = -1;
                }
            }
            else {
                if (valueA && !valueB) {
                    comparison = 1;
                }
                else if (valueB && !valueA) {
                    comparison = -1;
                }
            }
            return comparison * direction;
        };
    };
    SortService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    SortService.ctorParameters = function () { return []; };
    /** @nocollapse */ SortService.ngInjectableDef = i0.defineInjectable({ factory: function SortService_Factory() { return new SortService(); }, token: SortService, providedIn: "root" });
    return SortService;
}());
export { SortService };
if (false) {
    /** @type {?} */
    SortService.prototype.activeSortFunction;
    /** @type {?} */
    SortService.prototype._stagedSortFunction;
    /** @type {?} */
    SortService.prototype.activeSortName;
    /** @type {?} */
    SortService.prototype.stagedSortName;
    /** @type {?} */
    SortService.prototype.nonStandardSortFunctionActive;
    /** @type {?} */
    SortService.prototype.nonStandardSortFunction;
    /** @type {?} */
    SortService.prototype.choices;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctZmlsdGVycy1saWJyYXJ5LyIsInNvdXJjZXMiOlsibGliL3NvcnQvc29ydC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxZQUFZLENBQUM7OztJQXdGckM7a0NBakZ3RixJQUFJO21DQUdGLElBQUk7OEJBRXJFLElBQUk7OEJBRUosSUFBSTs2Q0FFRyxLQUFLO3VDQUVpRCxJQUFJOzt1QkFHcUM7WUFDN0g7Z0JBQ0UsS0FBSyxFQUFFO29CQUNMLFFBQVEsRUFBRSxXQUFXLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxVQUFDLFNBQW9CO3dCQUNuRSxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQztxQkFDOUI7aUJBQ0YsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSx3Q0FBd0M7YUFDbEY7WUFDRDtnQkFDRSxLQUFLLEVBQUU7b0JBQ0wsUUFBUSxFQUFFLFdBQVcsQ0FBQyxtQkFBbUIsRUFBRSxXQUFXLEVBQUUsVUFBQyxTQUFvQjt3QkFDM0UsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUM7cUJBQzlDO2lCQUNGLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUseURBQXlEO2FBQzFGO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFO29CQUNMLFFBQVEsRUFBRSxXQUFXLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxVQUFDLFNBQW9CO3dCQUNuRSxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQztxQkFDdEI7aUJBQ0YsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxnREFBZ0Q7YUFDMUY7WUFDRDtnQkFDRSxLQUFLLEVBQUU7b0JBQ0wsUUFBUSxFQUFFLFdBQVcsQ0FBQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQUMsU0FBb0I7d0JBQy9ELE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO3FCQUMzQjtpQkFDRixFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLG1DQUFtQzthQUN6RTtZQUNEO2dCQUNFLEtBQUssRUFBRTtvQkFDTCxRQUFRLEVBQUUsV0FBVyxDQUFDLFdBQVcsRUFBRSxXQUFXLEVBQUUsVUFBQyxTQUFvQjt3QkFDbkUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7cUJBQzVCO2lCQUNGLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxPQUFPLEVBQUUsaUNBQWlDO2FBQzNFO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFO29CQUNMLFFBQVEsRUFBRSxXQUFXLENBQUMsZUFBZSxFQUFFLFdBQVcsRUFBRSxVQUFDLFNBQW9CO3dCQUN2RSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQzs7NEJBQzVCLElBQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDOzRCQUNsRCxFQUFFLENBQUMsQ0FBQyxRQUFRLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztnQ0FDckIsTUFBTSxDQUFDLENBQUMsQ0FBQzs2QkFDVjs0QkFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0NBQzVCLE1BQU0sQ0FBQyxDQUFDLENBQUM7NkJBQ1Y7NEJBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dDQUM1QixNQUFNLENBQUMsQ0FBQyxDQUFDOzZCQUNWOzRCQUFDLElBQUksQ0FBQyxDQUFDO2dDQUNOLE1BQU0sQ0FBQyxDQUFDLENBQUM7NkJBQ1Y7eUJBQ0Y7d0JBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztxQkFDYjtpQkFDRixFQUFFLFdBQVcsRUFBRSxrQkFBa0IsRUFBRSxPQUFPLEVBQUUsMENBQTBDO2FBQ3hGO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFO29CQUNMLFFBQVEsRUFBRSxXQUFXLENBQUMsZUFBZSxFQUFFLFdBQVcsRUFBRSxVQUFDLFNBQW9CO3dCQUN2RSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQzs0QkFDNUIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDO3lCQUM1Qzt3QkFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO3FCQUNiO2lCQUNGLEVBQUUsV0FBVyxFQUFFLHNCQUFzQixFQUFFLE9BQU8sRUFBRSw4QkFBOEI7YUFDaEY7U0FDRjtRQUdDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDOztRQUU3RixJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDdkQsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO0tBQzNDOzs7O0lBR0QsMkNBQXFCOzs7SUFBckI7UUFDRSxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDO0tBQ2pDO0lBRUQ7O09BRUc7Ozs7O0lBQ0gsK0JBQVM7Ozs7SUFBVDtRQUNFLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1FBQzNCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUM7UUFDL0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7UUFDM0IsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztLQUNqQztJQUVEOztPQUVHOzs7Ozs7OztJQUNILHVDQUFpQjs7Ozs7OztJQUFqQixVQUFrQixXQUEyQyxFQUFFLFNBQWlCLEVBQUUsUUFBZ0I7UUFDaEcsSUFBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUM7UUFDL0IsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7S0FDNUU7SUFFRDs7OztPQUlHOzs7Ozs7O0lBQ0gsd0NBQWtCOzs7Ozs7SUFBbEIsVUFBbUIsV0FBMkMsRUFBRSxTQUFpQjtRQUMvRSxNQUFNLENBQUMsVUFBVSxVQUFxQixFQUFFLFVBQXFCOztZQUUzRCxJQUFNLE1BQU0sR0FBRyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7O1lBQ3ZDLElBQU0sTUFBTSxHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQzs7WUFDdkMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDOztZQUVuQixFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDckIsRUFBRSxDQUFDLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7b0JBQ3BCLFVBQVUsR0FBRyxDQUFDLENBQUM7aUJBQ2hCO2dCQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUN0QixVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7aUJBQ2pCO2FBQ0Y7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUN0QixVQUFVLEdBQUcsQ0FBQyxDQUFDO2lCQUNoQjtnQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDN0IsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO2lCQUNqQjthQUNGO1lBQ0QsTUFBTSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7U0FDL0IsQ0FBQztLQUNIOztnQkEvSUYsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7Ozs7c0JBTkQ7O1NBT2EsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1BlcmFHcmFwaH0gZnJvbSAnbmctY29tbW9uLWxpYnJhcnknO1xuaW1wb3J0IHtTb3J0Q2hvaWNlc30gZnJvbSAnLi9Tb3J0RW51bSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFNvcnRTZXJ2aWNlIHtcbiAgLy8gc29ydCBjdXJyZW50bHkgYXBwbGllZCB0byBhcnJheSB2aWV3XG4gIHB1YmxpYyBhY3RpdmVTb3J0RnVuY3Rpb246ICgocGVyYUdyYXBoQTogUGVyYUdyYXBoLCBQZXJhR3JhcGhCOiBQZXJhR3JhcGgpID0+IG51bWJlcikgPSBudWxsO1xuXG4gIC8vIHNvcnQgZnVuY3Rpb24gaW4gc2lkZWJhciAtPiBub3QgY3VycmVudGx5IGFjdGl2ZSBpbiBhcnJheSB2aWV3XG4gIHByaXZhdGUgX3N0YWdlZFNvcnRGdW5jdGlvbjogKChwZXJhR3JhcGhBOiBQZXJhR3JhcGgsIFBlcmFHcmFwaEI6IFBlcmFHcmFwaCkgPT4gbnVtYmVyKSA9IG51bGw7XG5cbiAgYWN0aXZlU29ydE5hbWU6IHN0cmluZyA9IG51bGw7XG5cbiAgc3RhZ2VkU29ydE5hbWU6IHN0cmluZyA9IG51bGw7XG5cbiAgbm9uU3RhbmRhcmRTb3J0RnVuY3Rpb25BY3RpdmUgPSBmYWxzZTtcblxuICBub25TdGFuZGFyZFNvcnRGdW5jdGlvbjogKChwZXJhR3JhcGhBOiBQZXJhR3JhcGgsIFBlcmFHcmFwaEI6IFBlcmFHcmFwaCkgPT4gbnVtYmVyKSA9IG51bGw7XG5cbiAgLy8gb3B0aW9ucyBvZiBkcm9wZG93blxuICBjaG9pY2VzOiB7IHZhbHVlOiB7IHNvcnROYW1lOiBzdHJpbmcsIHRyYW5zZm9ybWVyOiAocGVyYWdyYXBoOiBQZXJhR3JhcGgpID0+IGFueSB9LCBkZXNjcmlwdGlvbjogc3RyaW5nLCB0b29sdGlwOiBzdHJpbmcgfVtdID0gW1xuICAgIHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIHNvcnROYW1lOiBTb3J0Q2hvaWNlcy5EaXNwbGF5TmFtZSwgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwZXJhZ3JhcGguZGlzcGxheU5hbWU7XG4gICAgICAgIH1cbiAgICAgIH0sIGRlc2NyaXB0aW9uOiAnUGF0aWVudCBOYW1lJywgdG9vbHRpcDogJ0FscGhhYmV0aWNhbCBzb3J0IGJ5IHBhdGllbnQgbGFzdCBuYW1lJ1xuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc29ydE5hbWU6IFNvcnRDaG9pY2VzLk1lZGljYWxSZWNvcmROdW1iZXIsIHRyYW5zZm9ybWVyOiAocGVyYWdyYXBoOiBQZXJhR3JhcGgpID0+IHtcbiAgICAgICAgICByZXR1cm4gcGVyYWdyYXBoLnBhdGllbnQubWVkaWNhbFJlY29yZE51bWJlcjtcbiAgICAgICAgfVxuICAgICAgfSwgZGVzY3JpcHRpb246ICdNUk4nLCB0b29sdGlwOiAnU29ydCBncmFwaHMgYnkgdGhlIG1lZGljYWwgcmVjb3JkIG51bWJlciBvZiB0aGUgcGF0aWVudCdcbiAgICB9LFxuICAgIHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIHNvcnROYW1lOiBTb3J0Q2hvaWNlcy5WaXNpdE51bWJlciwgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwZXJhZ3JhcGgudm5tO1xuICAgICAgICB9XG4gICAgICB9LCBkZXNjcmlwdGlvbjogJ1Zpc2l0IE51bWJlcicsIHRvb2x0aXA6ICdTb3J0IGdyYXBocyBieSB0aGUgdmlzaXQgbnVtYmVyIG9mIHRoZSBwYXRpZW50J1xuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc29ydE5hbWU6IFNvcnRDaG9pY2VzLlJJU2NvcmUsIHRyYW5zZm9ybWVyOiAocGVyYWdyYXBoOiBQZXJhR3JhcGgpID0+IHtcbiAgICAgICAgICByZXR1cm4gcGVyYWdyYXBoLmxhdGVzdFJpO1xuICAgICAgICB9XG4gICAgICB9LCBkZXNjcmlwdGlvbjogJ1JJIFNjb3JlJywgdG9vbHRpcDogJ1NvcnQgYnkgUm90aG1hbiBJbmRleCBzY29yZSB2YWx1ZSdcbiAgICB9LFxuICAgIHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIHNvcnROYW1lOiBTb3J0Q2hvaWNlcy5Ib3NwaXRhbExPUywgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwZXJhZ3JhcGguYWRtaXREYXRlO1xuICAgICAgICB9XG4gICAgICB9LCBkZXNjcmlwdGlvbjogJ0hvc3BpdGFsIExPUycsIHRvb2x0aXA6ICdTb3J0IGJ5IGhvc3BpdGFsIGxlbmd0aCBvZiBzdGF5J1xuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc29ydE5hbWU6IFNvcnRDaG9pY2VzLldhcm5pbmdTZXZlcml0eSwgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4ge1xuICAgICAgICAgIGlmIChwZXJhZ3JhcGguYWN0aXZlV2FybmluZykge1xuICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSBwZXJhZ3JhcGguYWN0aXZlV2FybmluZy5jYXRlZ29yeTtcbiAgICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ1YnKSB7XG4gICAgICAgICAgICAgIHJldHVybiA0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjYXRlZ29yeSA9PT0gJ0gnKSB7XG4gICAgICAgICAgICAgIHJldHVybiAzO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjYXRlZ29yeSA9PT0gJ00nKSB7XG4gICAgICAgICAgICAgIHJldHVybiAyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9LCBkZXNjcmlwdGlvbjogJ1dhcm5pbmcgU2V2ZXJpdHknLCB0b29sdGlwOiAnU29ydCBieSB0aGUgc2V2ZXJpdHkgb2YgcGF0aWVudCB3YXJuaW5ncydcbiAgICB9LFxuICAgIHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIHNvcnROYW1lOiBTb3J0Q2hvaWNlcy5XYXJuaW5nRHVyYXRpb24sIHRyYW5zZm9ybWVyOiAocGVyYWdyYXBoOiBQZXJhR3JhcGgpID0+IHtcbiAgICAgICAgICBpZiAocGVyYWdyYXBoLmFjdGl2ZVdhcm5pbmcpIHtcbiAgICAgICAgICAgIHJldHVybiBwZXJhZ3JhcGguYWN0aXZlV2FybmluZy5jcmVhdGVkRGF0ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0sIGRlc2NyaXB0aW9uOiAnV2FybmluZyBDcmVhdGVkIFRpbWUnLCB0b29sdGlwOiAnU29ydCBieSB3YXJuaW5nIGNyZWF0ZWQgdGltZSdcbiAgICB9XG4gIF07XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zdGFnZVNvcnRGdW5jdGlvbih0aGlzLmNob2ljZXNbMF0udmFsdWUudHJhbnNmb3JtZXIsIDEsIHRoaXMuY2hvaWNlc1swXS52YWx1ZS5zb3J0TmFtZSk7XG4gICAgLy8gc2V0IHN0YWdlZCBzb3J0IHRvIGFjdGl2ZVxuICAgIHRoaXMuYWN0aXZlU29ydEZ1bmN0aW9uID0gdGhpcy5nZXRTdGFnZWRTb3J0RnVuY3Rpb24oKTtcbiAgICB0aGlzLmFjdGl2ZVNvcnROYW1lID0gdGhpcy5zdGFnZWRTb3J0TmFtZTtcbiAgfVxuXG5cbiAgZ2V0U3RhZ2VkU29ydEZ1bmN0aW9uKCk6IChwZXJhR3JhcGhBOiBQZXJhR3JhcGgsIFBlcmFHcmFwaEI6IFBlcmFHcmFwaCkgPT4gbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fc3RhZ2VkU29ydEZ1bmN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIHdoYXQgdG8gZG8gaWYgc2lkZWJhciBpcyBkZXN0cm95ZWRcbiAgICovXG4gIGNsZWFyU29ydCgpIHtcbiAgICB0aGlzLmFjdGl2ZVNvcnROYW1lID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2ZVNvcnRGdW5jdGlvbiA9IG51bGw7XG4gICAgdGhpcy5zdGFnZWRTb3J0TmFtZSA9IG51bGw7XG4gICAgdGhpcy5fc3RhZ2VkU29ydEZ1bmN0aW9uID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBzdGFnZSBzb3J0IGZ1bmN0aW9uIGZvciBhcHBsaWNhdGlvblxuICAgKi9cbiAgc3RhZ2VTb3J0RnVuY3Rpb24odHJhbnNmb3JtZXI6IChwZXJhR3JhcGhBOiBQZXJhR3JhcGgpID0+IGFueSwgZGlyZWN0aW9uOiBudW1iZXIsIHNvcnROYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLnN0YWdlZFNvcnROYW1lID0gc29ydE5hbWU7XG4gICAgdGhpcy5fc3RhZ2VkU29ydEZ1bmN0aW9uID0gdGhpcy5jcmVhdGVTb3J0RnVuY3Rpb24odHJhbnNmb3JtZXIsIGRpcmVjdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogZ2VuZXJhdGVzIHNvcnQgZnVuY3Rpb24gZnJvbSB0cmFuc2Zvcm1lciBmdW5jdGlvbiwgZGlyZWN0aW9uLCBhbmQgc29ydE5hbWVcbiAgICogQHBhcmFtIHRyYW5zZm9ybWVyIC0gZnVuY3Rpb24gdG8gdGFrZSBwZXJhR3JhcGggYW5kIHJldHVybiBwcmltaXRpdmUgdmFsdWUgZm9yIHNvcnRpbmdcbiAgICogQHBhcmFtIGRpcmVjdGlvbiAtIGRpcmVjdGlvbiBvZiBzb3J0XG4gICAqL1xuICBjcmVhdGVTb3J0RnVuY3Rpb24odHJhbnNmb3JtZXI6IChwZXJhR3JhcGhBOiBQZXJhR3JhcGgpID0+IGFueSwgZGlyZWN0aW9uOiBudW1iZXIpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHBlcmFHcmFwaEE6IFBlcmFHcmFwaCwgcGVyYUdyYXBoQjogUGVyYUdyYXBoKTogbnVtYmVyIHtcbiAgICAgIC8vIGdldCBjb21wYXJhYmxlIHZhbHVlcyBmcm9tIHBlcmFncmFwaHMgdG8gc29ydCBieVxuICAgICAgY29uc3QgdmFsdWVBID0gdHJhbnNmb3JtZXIocGVyYUdyYXBoQSk7XG4gICAgICBjb25zdCB2YWx1ZUIgPSB0cmFuc2Zvcm1lcihwZXJhR3JhcGhCKTtcbiAgICAgIGxldCBjb21wYXJpc29uID0gMDtcbiAgICAgIC8vIGNvbXBhcmUgdmFsdWVzIGFuZCByZXR1cm5cbiAgICAgIGlmICh2YWx1ZUEgJiYgdmFsdWVCKSB7XG4gICAgICAgIGlmICh2YWx1ZUEgPiB2YWx1ZUIpIHtcbiAgICAgICAgICBjb21wYXJpc29uID0gMTtcbiAgICAgICAgfSBpZiAodmFsdWVBIDwgdmFsdWVCKSB7XG4gICAgICAgICAgY29tcGFyaXNvbiA9IC0xO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodmFsdWVBICYmICF2YWx1ZUIpIHtcbiAgICAgICAgICBjb21wYXJpc29uID0gMTtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZUIgJiYgIXZhbHVlQSkge1xuICAgICAgICAgIGNvbXBhcmlzb24gPSAtMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbXBhcmlzb24gKiBkaXJlY3Rpb247XG4gICAgfTtcbiAgfVxufVxuIl19