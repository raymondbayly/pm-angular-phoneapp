/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { SortChoices } from './SortEnum';
import * as i0 from "@angular/core";
export class SortService {
    constructor() {
        this.activeSortFunction = null;
        this._stagedSortFunction = null;
        this.activeSortName = null;
        this.stagedSortName = null;
        this.nonStandardSortFunctionActive = false;
        this.nonStandardSortFunction = null;
        // options of dropdown
        this.choices = [
            {
                value: {
                    sortName: SortChoices.DisplayName, transformer: (peragraph) => {
                        return peragraph.displayName;
                    }
                }, description: 'Patient Name', tooltip: 'Alphabetical sort by patient last name'
            },
            {
                value: {
                    sortName: SortChoices.MedicalRecordNumber, transformer: (peragraph) => {
                        return peragraph.patient.medicalRecordNumber;
                    }
                }, description: 'MRN', tooltip: 'Sort graphs by the medical record number of the patient'
            },
            {
                value: {
                    sortName: SortChoices.VisitNumber, transformer: (peragraph) => {
                        return peragraph.vnm;
                    }
                }, description: 'Visit Number', tooltip: 'Sort graphs by the visit number of the patient'
            },
            {
                value: {
                    sortName: SortChoices.RIScore, transformer: (peragraph) => {
                        return peragraph.latestRi;
                    }
                }, description: 'RI Score', tooltip: 'Sort by Rothman Index score value'
            },
            {
                value: {
                    sortName: SortChoices.HospitalLOS, transformer: (peragraph) => {
                        return peragraph.admitDate;
                    }
                }, description: 'Hospital LOS', tooltip: 'Sort by hospital length of stay'
            },
            {
                value: {
                    sortName: SortChoices.WarningSeverity, transformer: (peragraph) => {
                        if (peragraph.activeWarning) {
                            /** @type {?} */
                            const category = peragraph.activeWarning.category;
                            if (category === 'V') {
                                return 4;
                            }
                            else if (category === 'H') {
                                return 3;
                            }
                            else if (category === 'M') {
                                return 2;
                            }
                            else {
                                return 1;
                            }
                        }
                        return null;
                    }
                }, description: 'Warning Severity', tooltip: 'Sort by the severity of patient warnings'
            },
            {
                value: {
                    sortName: SortChoices.WarningDuration, transformer: (peragraph) => {
                        if (peragraph.activeWarning) {
                            return peragraph.activeWarning.createdDate;
                        }
                        return null;
                    }
                }, description: 'Warning Created Time', tooltip: 'Sort by warning created time'
            }
        ];
        this.stageSortFunction(this.choices[0].value.transformer, 1, this.choices[0].value.sortName);
        // set staged sort to active
        this.activeSortFunction = this.getStagedSortFunction();
        this.activeSortName = this.stagedSortName;
    }
    /**
     * @return {?}
     */
    getStagedSortFunction() {
        return this._stagedSortFunction;
    }
    /**
     * what to do if sidebar is destroyed
     * @return {?}
     */
    clearSort() {
        this.activeSortName = null;
        this.activeSortFunction = null;
        this.stagedSortName = null;
        this._stagedSortFunction = null;
    }
    /**
     * stage sort function for application
     * @param {?} transformer
     * @param {?} direction
     * @param {?} sortName
     * @return {?}
     */
    stageSortFunction(transformer, direction, sortName) {
        this.stagedSortName = sortName;
        this._stagedSortFunction = this.createSortFunction(transformer, direction);
    }
    /**
     * generates sort function from transformer function, direction, and sortName
     * @param {?} transformer - function to take peraGraph and return primitive value for sorting
     * @param {?} direction - direction of sort
     * @return {?}
     */
    createSortFunction(transformer, direction) {
        return function (peraGraphA, peraGraphB) {
            /** @type {?} */
            const valueA = transformer(peraGraphA);
            /** @type {?} */
            const valueB = transformer(peraGraphB);
            /** @type {?} */
            let comparison = 0;
            // compare values and return
            if (valueA && valueB) {
                if (valueA > valueB) {
                    comparison = 1;
                }
                if (valueA < valueB) {
                    comparison = -1;
                }
            }
            else {
                if (valueA && !valueB) {
                    comparison = 1;
                }
                else if (valueB && !valueA) {
                    comparison = -1;
                }
            }
            return comparison * direction;
        };
    }
}
SortService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
SortService.ctorParameters = () => [];
/** @nocollapse */ SortService.ngInjectableDef = i0.defineInjectable({ factory: function SortService_Factory() { return new SortService(); }, token: SortService, providedIn: "root" });
if (false) {
    /** @type {?} */
    SortService.prototype.activeSortFunction;
    /** @type {?} */
    SortService.prototype._stagedSortFunction;
    /** @type {?} */
    SortService.prototype.activeSortName;
    /** @type {?} */
    SortService.prototype.stagedSortName;
    /** @type {?} */
    SortService.prototype.nonStandardSortFunctionActive;
    /** @type {?} */
    SortService.prototype.nonStandardSortFunction;
    /** @type {?} */
    SortService.prototype.choices;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctZmlsdGVycy1saWJyYXJ5LyIsInNvdXJjZXMiOlsibGliL3NvcnQvc29ydC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxZQUFZLENBQUM7O0FBS3ZDLE1BQU07SUFtRko7a0NBakZ3RixJQUFJO21DQUdGLElBQUk7OEJBRXJFLElBQUk7OEJBRUosSUFBSTs2Q0FFRyxLQUFLO3VDQUVpRCxJQUFJOzt1QkFHcUM7WUFDN0g7Z0JBQ0UsS0FBSyxFQUFFO29CQUNMLFFBQVEsRUFBRSxXQUFXLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxDQUFDLFNBQW9CLEVBQUUsRUFBRTt3QkFDdkUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUM7cUJBQzlCO2lCQUNGLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxPQUFPLEVBQUUsd0NBQXdDO2FBQ2xGO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFO29CQUNMLFFBQVEsRUFBRSxXQUFXLENBQUMsbUJBQW1CLEVBQUUsV0FBVyxFQUFFLENBQUMsU0FBb0IsRUFBRSxFQUFFO3dCQUMvRSxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztxQkFDOUM7aUJBQ0YsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSx5REFBeUQ7YUFDMUY7WUFDRDtnQkFDRSxLQUFLLEVBQUU7b0JBQ0wsUUFBUSxFQUFFLFdBQVcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLENBQUMsU0FBb0IsRUFBRSxFQUFFO3dCQUN2RSxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQztxQkFDdEI7aUJBQ0YsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxnREFBZ0Q7YUFDMUY7WUFDRDtn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IHtJbmplY3RhYmxlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7UGVyYUdyYXBofSBmcm9tICduZy1jb21tb24tbGlicmFyeSc7XG5pbXBvcnQge1NvcnRDaG9pY2VzfSBmcm9tICcuL1NvcnRFbnVtJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgU29ydFNlcnZpY2Uge1xuICAvLyBzb3J0IGN1cnJlbnRseSBhcHBsaWVkIHRvIGFycmF5IHZpZXdcbiAgcHVibGljIGFjdGl2ZVNvcnRGdW5jdGlvbjogKChwZXJhR3JhcGhBOiBQZXJhR3JhcGgsIFBlcmFHcmFwaEI6IFBlcmFHcmFwaCkgPT4gbnVtYmVyKSA9IG51bGw7XG5cbiAgLy8gc29ydCBmdW5jdGlvbiBpbiBzaWRlYmFyIC0+IG5vdCBjdXJyZW50bHkgYWN0aXZlIGluIGFycmF5IHZpZXdcbiAgcHJpdmF0ZSBfc3RhZ2VkU29ydEZ1bmN0aW9uOiAoKHBlcmFHcmFwaEE6IFBlcmFHcmFwaCwgUGVyYUdyYXBoQjogUGVyYUdyYXBoKSA9PiBudW1iZXIpID0gbnVsbDtcblxuICBhY3RpdmVTb3J0TmFtZTogc3RyaW5nID0gbnVsbDtcblxuICBzdGFnZWRTb3J0TmFtZTogc3RyaW5nID0gbnVsbDtcblxuICBub25TdGFuZGFyZFNvcnRGdW5jdGlvbkFjdGl2ZSA9IGZhbHNlO1xuXG4gIG5vblN0YW5kYXJkU29ydEZ1bmN0aW9uOiAoKHBlcmFHcmFwaEE6IFBlcmFHcmFwaCwgUGVyYUdyYXBoQjogUGVyYUdyYXBoKSA9PiBudW1iZXIpID0gbnVsbDtcblxuICAvLyBvcHRpb25zIG9mIGRyb3Bkb3duXG4gIGNob2ljZXM6IHsgdmFsdWU6IHsgc29ydE5hbWU6IHN0cmluZywgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4gYW55IH0sIGRlc2NyaXB0aW9uOiBzdHJpbmcsIHRvb2x0aXA6IHN0cmluZyB9W10gPSBbXG4gICAge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc29ydE5hbWU6IFNvcnRDaG9pY2VzLkRpc3BsYXlOYW1lLCB0cmFuc2Zvcm1lcjogKHBlcmFncmFwaDogUGVyYUdyYXBoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHBlcmFncmFwaC5kaXNwbGF5TmFtZTtcbiAgICAgICAgfVxuICAgICAgfSwgZGVzY3JpcHRpb246ICdQYXRpZW50IE5hbWUnLCB0b29sdGlwOiAnQWxwaGFiZXRpY2FsIHNvcnQgYnkgcGF0aWVudCBsYXN0IG5hbWUnXG4gICAgfSxcbiAgICB7XG4gICAgICB2YWx1ZToge1xuICAgICAgICBzb3J0TmFtZTogU29ydENob2ljZXMuTWVkaWNhbFJlY29yZE51bWJlciwgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwZXJhZ3JhcGgucGF0aWVudC5tZWRpY2FsUmVjb3JkTnVtYmVyO1xuICAgICAgICB9XG4gICAgICB9LCBkZXNjcmlwdGlvbjogJ01STicsIHRvb2x0aXA6ICdTb3J0IGdyYXBocyBieSB0aGUgbWVkaWNhbCByZWNvcmQgbnVtYmVyIG9mIHRoZSBwYXRpZW50J1xuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc29ydE5hbWU6IFNvcnRDaG9pY2VzLlZpc2l0TnVtYmVyLCB0cmFuc2Zvcm1lcjogKHBlcmFncmFwaDogUGVyYUdyYXBoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHBlcmFncmFwaC52bm07XG4gICAgICAgIH1cbiAgICAgIH0sIGRlc2NyaXB0aW9uOiAnVmlzaXQgTnVtYmVyJywgdG9vbHRpcDogJ1NvcnQgZ3JhcGhzIGJ5IHRoZSB2aXNpdCBudW1iZXIgb2YgdGhlIHBhdGllbnQnXG4gICAgfSxcbiAgICB7XG4gICAgICB2YWx1ZToge1xuICAgICAgICBzb3J0TmFtZTogU29ydENob2ljZXMuUklTY29yZSwgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwZXJhZ3JhcGgubGF0ZXN0Umk7XG4gICAgICAgIH1cbiAgICAgIH0sIGRlc2NyaXB0aW9uOiAnUkkgU2NvcmUnLCB0b29sdGlwOiAnU29ydCBieSBSb3RobWFuIEluZGV4IHNjb3JlIHZhbHVlJ1xuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc29ydE5hbWU6IFNvcnRDaG9pY2VzLkhvc3BpdGFsTE9TLCB0cmFuc2Zvcm1lcjogKHBlcmFncmFwaDogUGVyYUdyYXBoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHBlcmFncmFwaC5hZG1pdERhdGU7XG4gICAgICAgIH1cbiAgICAgIH0sIGRlc2NyaXB0aW9uOiAnSG9zcGl0YWwgTE9TJywgdG9vbHRpcDogJ1NvcnQgYnkgaG9zcGl0YWwgbGVuZ3RoIG9mIHN0YXknXG4gICAgfSxcbiAgICB7XG4gICAgICB2YWx1ZToge1xuICAgICAgICBzb3J0TmFtZTogU29ydENob2ljZXMuV2FybmluZ1NldmVyaXR5LCB0cmFuc2Zvcm1lcjogKHBlcmFncmFwaDogUGVyYUdyYXBoKSA9PiB7XG4gICAgICAgICAgaWYgKHBlcmFncmFwaC5hY3RpdmVXYXJuaW5nKSB7XG4gICAgICAgICAgICBjb25zdCBjYXRlZ29yeSA9IHBlcmFncmFwaC5hY3RpdmVXYXJuaW5nLmNhdGVnb3J5O1xuICAgICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnVicpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIDQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNhdGVnb3J5ID09PSAnSCcpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIDM7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNhdGVnb3J5ID09PSAnTScpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIDI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0sIGRlc2NyaXB0aW9uOiAnV2FybmluZyBTZXZlcml0eScsIHRvb2x0aXA6ICdTb3J0IGJ5IHRoZSBzZXZlcml0eSBvZiBwYXRpZW50IHdhcm5pbmdzJ1xuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc29ydE5hbWU6IFNvcnRDaG9pY2VzLldhcm5pbmdEdXJhdGlvbiwgdHJhbnNmb3JtZXI6IChwZXJhZ3JhcGg6IFBlcmFHcmFwaCkgPT4ge1xuICAgICAgICAgIGlmIChwZXJhZ3JhcGguYWN0aXZlV2FybmluZykge1xuICAgICAgICAgICAgcmV0dXJuIHBlcmFncmFwaC5hY3RpdmVXYXJuaW5nLmNyZWF0ZWREYXRlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSwgZGVzY3JpcHRpb246ICdXYXJuaW5nIENyZWF0ZWQgVGltZScsIHRvb2x0aXA6ICdTb3J0IGJ5IHdhcm5pbmcgY3JlYXRlZCB0aW1lJ1xuICAgIH1cbiAgXTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnN0YWdlU29ydEZ1bmN0aW9uKHRoaXMuY2hvaWNlc1swXS52YWx1ZS50cmFuc2Zvcm1lciwgMSwgdGhpcy5jaG9pY2VzWzBdLnZhbHVlLnNvcnROYW1lKTtcbiAgICAvLyBzZXQgc3RhZ2VkIHNvcnQgdG8gYWN0aXZlXG4gICAgdGhpcy5hY3RpdmVTb3J0RnVuY3Rpb24gPSB0aGlzLmdldFN0YWdlZFNvcnRGdW5jdGlvbigpO1xuICAgIHRoaXMuYWN0aXZlU29ydE5hbWUgPSB0aGlzLnN0YWdlZFNvcnROYW1lO1xuICB9XG5cblxuICBnZXRTdGFnZWRTb3J0RnVuY3Rpb24oKTogKHBlcmFHcmFwaEE6IFBlcmFHcmFwaCwgUGVyYUdyYXBoQjogUGVyYUdyYXBoKSA9PiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9zdGFnZWRTb3J0RnVuY3Rpb247XG4gIH1cblxuICAvKipcbiAgICogd2hhdCB0byBkbyBpZiBzaWRlYmFyIGlzIGRlc3Ryb3llZFxuICAgKi9cbiAgY2xlYXJTb3J0KCkge1xuICAgIHRoaXMuYWN0aXZlU29ydE5hbWUgPSBudWxsO1xuICAgIHRoaXMuYWN0aXZlU29ydEZ1bmN0aW9uID0gbnVsbDtcbiAgICB0aGlzLnN0YWdlZFNvcnROYW1lID0gbnVsbDtcbiAgICB0aGlzLl9zdGFnZWRTb3J0RnVuY3Rpb24gPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIHN0YWdlIHNvcnQgZnVuY3Rpb24gZm9yIGFwcGxpY2F0aW9uXG4gICAqL1xuICBzdGFnZVNvcnRGdW5jdGlvbih0cmFuc2Zvcm1lcjogKHBlcmFHcmFwaEE6IFBlcmFHcmFwaCkgPT4gYW55LCBkaXJlY3Rpb246IG51bWJlciwgc29ydE5hbWU6IHN0cmluZykge1xuICAgIHRoaXMuc3RhZ2VkU29ydE5hbWUgPSBzb3J0TmFtZTtcbiAgICB0aGlzLl9zdGFnZWRTb3J0RnVuY3Rpb24gPSB0aGlzLmNyZWF0ZVNvcnRGdW5jdGlvbih0cmFuc2Zvcm1lciwgZGlyZWN0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBnZW5lcmF0ZXMgc29ydCBmdW5jdGlvbiBmcm9tIHRyYW5zZm9ybWVyIGZ1bmN0aW9uLCBkaXJlY3Rpb24sIGFuZCBzb3J0TmFtZVxuICAgKiBAcGFyYW0gdHJhbnNmb3JtZXIgLSBmdW5jdGlvbiB0byB0YWtlIHBlcmFHcmFwaCBhbmQgcmV0dXJuIHByaW1pdGl2ZSB2YWx1ZSBmb3Igc29ydGluZ1xuICAgKiBAcGFyYW0gZGlyZWN0aW9uIC0gZGlyZWN0aW9uIG9mIHNvcnRcbiAgICovXG4gIGNyZWF0ZVNvcnRGdW5jdGlvbih0cmFuc2Zvcm1lcjogKHBlcmFHcmFwaEE6IFBlcmFHcmFwaCkgPT4gYW55LCBkaXJlY3Rpb246IG51bWJlcikge1xuICAgIHJldHVybiBmdW5jdGlvbiAocGVyYUdyYXBoQTogUGVyYUdyYXBoLCBwZXJhR3JhcGhCOiBQZXJhR3JhcGgpOiBudW1iZXIge1xuICAgICAgLy8gZ2V0IGNvbXBhcmFibGUgdmFsdWVzIGZyb20gcGVyYWdyYXBocyB0byBzb3J0IGJ5XG4gICAgICBjb25zdCB2YWx1ZUEgPSB0cmFuc2Zvcm1lcihwZXJhR3JhcGhBKTtcbiAgICAgIGNvbnN0IHZhbHVlQiA9IHRyYW5zZm9ybWVyKHBlcmFHcmFwaEIpO1xuICAgICAgbGV0IGNvbXBhcmlzb24gPSAwO1xuICAgICAgLy8gY29tcGFyZSB2YWx1ZXMgYW5kIHJldHVyblxuICAgICAgaWYgKHZhbHVlQSAmJiB2YWx1ZUIpIHtcbiAgICAgICAgaWYgKHZhbHVlQSA+IHZhbHVlQikge1xuICAgICAgICAgIGNvbXBhcmlzb24gPSAxO1xuICAgICAgICB9IGlmICh2YWx1ZUEgPCB2YWx1ZUIpIHtcbiAgICAgICAgICBjb21wYXJpc29uID0gLTE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh2YWx1ZUEgJiYgIXZhbHVlQikge1xuICAgICAgICAgIGNvbXBhcmlzb24gPSAxO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlQiAmJiAhdmFsdWVBKSB7XG4gICAgICAgICAgY29tcGFyaXNvbiA9IC0xO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gY29tcGFyaXNvbiAqIGRpcmVjdGlvbjtcbiAgICB9O1xuICB9XG59XG4iXX0=